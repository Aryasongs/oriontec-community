<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrioBuzz - Advanced Social Media Platform</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getDatabase, ref, set, get, push, onValue, update, remove, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB2XeuTfHZ7FYKLoYb4epKp3upmVqG0fzE",
            authDomain: "pulse-17f40.firebaseapp.com",
            databaseURL: "https://pulse-17f40-default-rtdb.firebaseio.com",
            projectId: "pulse-17f40",
            storageBucket: "pulse-17f40.firebasestorage.app",
            messagingSenderId: "259780854138",
            appId: "1:259780854138:web:89c265fd22a34a7f1fd6c3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const provider = new GoogleAuthProvider();

        window.auth = auth;
        window.database = database;
        window.provider = provider;
        window.signInWithPopup = signInWithPopup;
        window.onAuthStateChanged = onAuthStateChanged;
        window.signOut = signOut;
        window.ref = ref;
        window.set = set;
        window.get = get;
        window.push = push;
        window.onValue = onValue;
        window.update = update;
        window.remove = remove;
        window.query = query;
        window.orderByChild = orderByChild;
        window.limitToLast = limitToLast;
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            background: white;
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .logo {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .tagline {
            color: #666;
            margin-bottom: 40px;
            font-size: 18px;
        }

        .google-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }

        .google-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(66, 133, 244, 0.3);
        }

        .main-app {
            display: none;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .navbar {
            background: white;
            padding: 15px 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-logo {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .nav-item {
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item:hover, .nav-item.active {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }

        .search-container {
            position: relative;
            margin: 0 20px;
        }

        .search-input {
            width: 300px;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #657786;
            font-size: 18px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e1e8ed;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .content-area {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 30px;
        }

        .sidebar, .right-sidebar {
            background: white;
            border-radius: 20px;
            padding: 25px;
            height: fit-content;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .profile-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .username {
            font-weight: bold;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .verified-tick {
            width: 20px;
            height: 20px;
            background: #e91e63;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e8ed;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-weight: bold;
            font-size: 20px;
            color: #667eea;
        }

        .stat-label {
            color: #657786;
            font-size: 14px;
            margin-top: 5px;
        }

        .buzz-composer {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e1e8ed;
        }

        .composer-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .composer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            overflow: hidden;
        }

        .composer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .buzz-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 18px;
            resize: none;
            min-height: 120px;
            font-family: inherit;
            outline: none;
        }

        .buzz-input::placeholder {
            color: #657786;
        }

        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e8ed;
        }

        .action-icons {
            display: flex;
            gap: 20px;
        }

        .action-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .action-icon:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .buzz-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .buzz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .buzz-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .buzz-post {
            border-bottom: 1px solid #e1e8ed;
            padding: 25px 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .buzz-post:hover {
            background: #f8f9fa;
            margin: 0 -30px;
            padding: 25px 30px;
            border-radius: 15px;
        }

        .buzz-post:last-child {
            border-bottom: none;
        }

        .buzz-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .buzz-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            overflow: hidden;
        }

        .buzz-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .buzz-user-info {
            flex: 1;
        }

        .buzz-username {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 3px;
        }

        .buzz-time {
            color: #657786;
            font-size: 14px;
        }

        .buzz-content {
            margin: 15px 0;
            line-height: 1.6;
            font-size: 16px;
        }

        .hashtag {
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }

        .hashtag:hover {
            text-decoration: underline;
        }

        .mention {
            color: #e91e63;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }

        .mention:hover {
            text-decoration: underline;
        }

        .buzz-image {
            max-width: 100%;
            border-radius: 15px;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .buzz-actions {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e1e8ed;
        }

        .buzz-action {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: none;
            border: none;
            color: #657786;
            font-size: 14px;
            font-weight: 500;
        }

        .buzz-action:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .buzz-action.liked {
            color: #e91e63;
            background: rgba(233, 30, 99, 0.1);
        }

        .buzz-action.shared {
            color: #1da1f2;
            background: rgba(29, 161, 242, 0.1);
        }

        .trending-section {
            margin-top: 30px;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .trending-item {
            padding: 15px 0;
            border-bottom: 1px solid #e1e8ed;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trending-item:hover {
            background: #f8f9fa;
            margin: 0 -25px;
            padding: 15px 25px;
            border-radius: 10px;
        }

        .trending-topic {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .trending-count {
            color: #657786;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
        }

        .close-modal {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: #e0e0e0;
            transform: scale(1.1);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .premium-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .boost-indicator {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .algorithm-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }

        .interest-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .interest-tag {
            background: #f0f0f0;
            color: #667eea;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interest-tag:hover, .interest-tag.active {
            background: #667eea;
            color: white;
        }

        .file-input {
            display: none;
        }

        .hidden {
            display: none !important;
        }

        .boost-modal {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .boost-options {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .boost-option {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .boost-option:hover, .boost-option.selected {
            background: rgba(255, 255, 255, 0.2);
            border-color: white;
            transform: translateY(-2px);
        }

        .boost-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .boost-description {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .boost-price {
            font-weight: bold;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .content-area {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px 15px;
            }
            
            .sidebar, .right-sidebar {
                display: none;
            }
            
            .nav-menu {
                gap: 15px;
            }
            
            .nav-item {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .search-input {
                width: 200px;
            }
            
            .buzz-composer {
                padding: 20px;
            }
            
            .main-content {
                padding: 20px;
            }
        }

        .analytics-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .analytics-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .analytics-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .recommendation-reason {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="authSection" class="auth-container">
        <div class="auth-card">
            <div class="logo">OrioBuzz</div>
            <p class="tagline">Advanced Social Intelligence Platform</p>
            <button class="google-btn" onclick="signInWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
                Continue with Google
            </button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <nav class="navbar">
            <div class="nav-content">
                <div class="nav-logo">OrioBuzz</div>
                <div class="search-container">
                    <div class="search-icon">üîç</div>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search users, hashtags, keywords..." onkeyup="performSearch()" onfocus="showSearchResults()" onblur="hideSearchResults()">
                    <div class="search-results" id="searchResults"></div>
                </div>
                <div class="nav-menu">
                    <div class="nav-item active" onclick="showPage('feed')">
                        üè† Feed
                    </div>
                    <div class="nav-item" onclick="showPage('profile')">
                        üë§ Profile
                    </div>
                    <div class="nav-item" onclick="showPage('analytics')">
                        üìä Analytics
                    </div>
                    <div class="nav-item" onclick="showPage('trending')">
                        üî• Trending
                    </div>
                    <div class="nav-item" onclick="showPage('settings')">
                        ‚öôÔ∏è Settings
                    </div>
                    <div class="nav-item" onclick="logoutUser()">
                        üö™ Logout
                    </div>
                </div>
            </div>
        </nav>

        <div class="content-area">
            <!-- Left Sidebar -->
            <div class="sidebar">
                <div class="profile-section">
                    <div class="profile-avatar" id="sidebarAvatar">
                        <img src="" alt="Profile" id="sidebarAvatarImg">
                    </div>
                    <div class="username" id="sidebarUsername">
                        Username
                        <span class="verified-tick hidden" id="sidebarVerified">‚úì</span>
                    </div>
                    <div class="profile-stats">
                        <div class="stat">
                            <div class="stat-number" id="followersCount">0</div>
                            <div class="stat-label">Followers</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="followingCount">0</div>
                            <div class="stat-label">Following</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="buzzCount">0</div>
                            <div class="stat-label">Buzzes</div>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">üéØ Your Interests</div>
                <div class="interest-tags" id="userInterests"></div>
                
                <button class="btn" onclick="openModal('profileModal')" style="margin-top: 20px;">‚úèÔ∏è Edit Profile</button>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Feed Page -->
                <div id="feedPage">
                    <div class="buzz-composer">
                        <div class="composer-header">
                            <div class="composer-avatar" id="composerAvatar">
                                <img src="" alt="Your Avatar" id="composerAvatarImg">
                            </div>
                            <textarea class="buzz-input" id="buzzContent" placeholder="What's buzzing in your mind? Use #hashtags and @mentions"></textarea>
                        </div>
                        <div class="composer-actions">
                            <div class="action-icons">
                                <div class="action-icon" onclick="document.getElementById('imageInput').click()">
                                    üì∑
                                </div>
                                <div class="action-icon" onclick="addEmoji()">
                                    üòä
                                </div>
                                <div class="action-icon" onclick="addHashtag()">
                                    #Ô∏è‚É£
                                </div>
                                <div class="action-icon" onclick="addMention()">
                                    @
                                </div>
                            </div>
                            <button class="buzz-btn" onclick="createBuzz()" id="buzzButton">
                                üöÄ Buzz It!
                            </button>
                        </div>
                        <input type="file" id="imageInput" class="file-input" accept="image/*" onchange="handleImageUpload(this)">
                    </div>
                    <div id="buzzFeed"></div>
                </div>

                <!-- Profile Page -->
                <div id="profilePage" class="hidden">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <div class="profile-avatar" id="profileAvatar" style="width: 120px; height: 120px; margin: 0 auto 20px;">
                            <img src="" alt="Profile" id="profileAvatarImg">
                        </div>
                        <h2 class="username" id="profileUsername">
                            Username
                            <span class="verified-tick hidden" id="profileVerified">‚úì</span>
                        </h2>
                        <p id="profileBio" style="color: #657786; margin: 15px 0; font-size: 16px;">Bio not set</p>
                        <p id="profileLocation" style="color: #657786; margin: 10px 0;">üìç Location not set</p>
                        <p id="profileContact" style="color: #657786; margin: 10px 0;">üìû Contact not set</p>
                        <div class="profile-stats" style="margin-top: 30px; justify-content: center; gap: 40px;">
                            <div class="stat">
                                <div class="stat-number" id="profileFollowers">0</div>
                                <div class="stat-label">Followers</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="profileFollowing">0</div>
                                <div class="stat-label">Following</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="profileBuzzes">0</div>
                                <div class="stat-label">Buzzes</div>
                            </div>
                        </div>
                    </div>
                    <div id="userBuzzFeed"></div>
                </div>

                <!-- Analytics Page -->
                <div id="analyticsPage" class="hidden">
                    <div class="analytics-section">
                        <h2>üìä Your OrioBuzz Analytics</h2>
                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <div class="analytics-number" id="totalViews">0</div>
                                <div class="analytics-label">Total Views</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-number" id="totalLikes">0</div>
                                <div class="analytics-label">Total Likes</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-number" id="engagementRate">0%</div>
                                <div class="analytics-label">Engagement Rate</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-number" id="reachScore">0</div>
                                <div class="analytics-label">Reach Score</div>
                            </div>
                        </div>
                    </div>
                    <div id="analyticsDetails"></div>
                </div>

                <!-- Trending Page -->
                <div id="trendingPage" class="hidden">
                    <h2 style="margin-bottom: 30px;">üî• Trending on OrioBuzz</h2>
                    <div id="trendingContent"></div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" class="hidden">
                    <h2 style="margin-bottom: 30px;">‚öôÔ∏è Settings & Privacy</h2>
                    <div style="display: grid; gap: 20px;">
                        <div class="community-item">
                            <div class="community-name">Algorithm Preferences</div>
                            <div class="community-description">Customize your feed algorithm and content recommendations</div>
                            <button class="join-btn" onclick="openModal('algorithmModal')">Customize Algorithm</button>
                        </div>
                        <div class="community-item">
                            <div class="community-name">Boost Settings</div>
                            <div class="community-description">Manage your boost preferences and payment methods</div>
                            <button class="join-btn" onclick="openModal('boostSettingsModal')">Boost Settings</button>
                        </div>
                        <div class="community-item">
                            <div class="community-name">Privacy & Safety</div>
                            <div class="community-description">Control who can see your content and interact with you</div>
                            <button class="join-btn" onclick="openModal('privacyModal')">Privacy Settings</button>
                        </div>
                        <div class="community-item">
                            <div class="community-name">Premium Features</div>
                            <div class="community-description">Unlock exclusive features with OrioBuzz Premium</div>
                            <button class="join-btn" onclick="showPremiumFeatures()">View Premium</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="right-sidebar">
                <div class="section-title">üî• Trending Now</div>
                <div class="trending-section" id="trendingHashtags"></div>

                <div class="section-title" style="margin-top: 30px;">üéØ Recommended</div>
                <div id="recommendedUsers"></div>

                <div class="section-title" style="margin-top: 30px;">üìà Algorithm Insights</div>
                <div id="algorithmInsights"></div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Profile</div>
                <button class="close-modal" onclick="closeModal('profileModal')">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-input" id="editUsername" placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label class="form-label">Bio</label>
                <textarea class="form-input form-textarea" id="editBio" placeholder="Tell us about yourself"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Location</label>
                <input type="text" class="form-input" id="editLocation" placeholder="Your location">
            </div>
            <div class="form-group">
                <label class="form-label">Contact Number</label>
                <input type="tel" class="form-input" id="editContact" placeholder="Your phone number">
            </div>
            <div class="form-group">
                <label class="form-label">Interests (comma separated)</label>
                <input type="text" class="form-input" id="editInterests" placeholder="technology, sports, music, art">
            </div>
            <button class="btn" onclick="updateProfile()">üíæ Save Changes</button>
        </div>
    </div>

    <div id="boostModal" class="modal">
        <div class="modal-content boost-modal">
            <div class="modal-header">
                <div class="modal-title">üöÄ Boost Your Buzz</div>
                <button class="close-modal" onclick="closeModal('boostModal')">√ó</button>
            </div>
            <p style="margin-bottom: 20px; opacity: 0.9;">Choose how you want to boost your buzz to reach more users:</p>
            <div class="boost-options">
                <div class="boost-option" onclick="selectBoostOption(this, 'basic')">
                    <div class="boost-title">üéØ Basic Boost</div>
                    <div class="boost-description">Reach 2x more users in your network</div>
                    <div class="boost-price">$2.99</div>
                </div>
                <div class="boost-option" onclick="selectBoostOption(this, 'premium')">
                    <div class="boost-title">üöÄ Premium Boost</div>
                    <div class="boost-description">Reach 5x more users + trending placement</div>
                    <div class="boost-price">$9.99</div>
                </div>
                <div class="boost-option" onclick="selectBoostOption(this, 'viral')">
                    <div class="boost-title">üí• Viral Boost</div>
                    <div class="boost-description">Maximum reach + featured placement</div>
                    <div class="boost-price">$19.99</div>
                </div>
            </div>
            <button class="btn" onclick="confirmBoost()" id="confirmBoostBtn" style="margin-top: 20px; background: white; color: #ff6b6b;">
                üöÄ Confirm Boost
            </button>
        </div>
    </div>

    <div id="algorithmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üéØ Algorithm Preferences</div>
                <button class="close-modal" onclick="closeModal('algorithmModal')">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Content Priority</label>
                <select class="form-input" id="contentPriority">
                    <option value="recent">Most Recent</option>
                    <option value="popular">Most Popular</option>
                    <option value="personalized">Personalized Mix</option>
                    <option value="following">Following Only</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Interest Weight</label>
                <input type="range" class="form-input" id="interestWeight" min="0" max="100" value="70">
                <p style="font-size: 14px; color: #657786;">How much should your interests influence your feed?</p>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="showBoosted"> Show Boosted Content
                </label>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="diverseContent"> Diverse Content Discovery
                </label>
            </div>
            <button class="btn" onclick="updateAlgorithmPreferences()">üíæ Save Preferences</button>
        </div>
    </div>

    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üîí Privacy Settings</div>
                <button class="close-modal" onclick="closeModal('privacyModal')">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="privateAccount"> Private Account
                </label>
                <p style="color: #657786; font-size: 14px; margin-top: 5px;">Only approved followers can see your buzzes</p>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="allowMentions"> Allow Mentions
                </label>
                <p style="color: #657786; font-size: 14px; margin-top: 5px;">Let anyone mention you in their buzzes</p>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="showInSearch"> Show in Search Results
                </label>
                <p style="color: #657786; font-size: 14px; margin-top: 5px;">Allow others to find you through search</p>
            </div>
            <button class="btn" onclick="updatePrivacySettings()">üíæ Save Settings</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let selectedImageBase64 = null;
        let allUsers = [];
        let allBuzzes = [];
        let userInteractions = {};
        let selectedBoostType = null;
        let currentBuzzToBoost = null;

        // Verified emails
        const verifiedEmails = [
            'sgursharn076@gmail.com',
            'sdozera@gmail.com',
            'orionbuzz771@gmail.com'
        ];

        // Premium eligible users
        const premiumEligible = [
            'sgursharn076@gmail.com',
            'sdozera@gmail.com',
            'orionbuzz771@gmail.com'
        ];

        // Auto-create accounts
        const autoAccounts = {
            'sgursharn076@gmail.com': { username: 'Gursharn Arya', bio: 'Tech Entrepreneur & Innovator' },
            'sdozera@gmail.com': { username: 'Dozera Group', bio: 'Leading Business Solutions' },
            'orionbuzz771@gmail.com': { username: 'OrioBuzz', bio: 'Official OrioBuzz Account' }
        };

        // Advanced Algorithm System
        class OrioBuzzAlgorithm {
            constructor() {
                this.userInterests = new Map();
                this.contentScores = new Map();
                this.engagementHistory = new Map();
                this.trendingTopics = new Map();
            }

            // Track user interactions for personalization
            trackInteraction(userId, buzzId, interactionType, content) {
                if (!this.engagementHistory.has(userId)) {
                    this.engagementHistory.set(userId, []);
                }
                
                const interaction = {
                    buzzId,
                    type: interactionType, // 'like', 'share', 'comment', 'view', 'dwell_time'
                    content,
                    timestamp: Date.now(),
                    hashtags: this.extractHashtags(content),
                    keywords: this.extractKeywords(content)
                };
                
                this.engagementHistory.get(userId).push(interaction);
                this.updateUserInterests(userId, interaction);
                this.updateTrendingTopics(interaction);
            }

            // Extract hashtags from content
            extractHashtags(content) {
                const hashtagRegex = /#[\w]+/g;
                return content.match(hashtagRegex) || [];
            }

            // Extract mentions from content
            extractMentions(content) {
                const mentionRegex = /@[\w]+/g;
                return content.match(mentionRegex) || [];
            }

            // Extract keywords using simple NLP
            extractKeywords(content) {
                const stopWords = ['the', 'is', 'at', 'which', 'on', 'and', 'a', 'to', 'are', 'as', 'was', 'will', 'be'];
                const words = content.toLowerCase()
                    .replace(/[^\w\s]/g, '')
                    .split(/\s+/)
                    .filter(word => word.length > 2 && !stopWords.includes(word));
                
                const wordFreq = {};
                words.forEach(word => {
                    wordFreq[word] = (wordFreq[word] || 0) + 1;
                });
                
                return Object.keys(wordFreq)
                    .sort((a, b) => wordFreq[b] - wordFreq[a])
                    .slice(0, 5);
            }

            // Update user interests based on interactions
            updateUserInterests(userId, interaction) {
                if (!this.userInterests.has(userId)) {
                    this.userInterests.set(userId, {});
                }
                
                const interests = this.userInterests.get(userId);
                const weight = this.getInteractionWeight(interaction.type);
                
                // Update hashtag interests
                interaction.hashtags.forEach(hashtag => {
                    interests[hashtag] = (interests[hashtag] || 0) + weight;
                });
                
                // Update keyword interests
                interaction.keywords.forEach(keyword => {
                    interests[keyword] = (interests[keyword] || 0) + weight * 0.5;
                });
            }

            // Get interaction weight for different types
            getInteractionWeight(type) {
                const weights = {
                    'view': 1,
                    'like': 3,
                    'share': 5,
                    'comment': 7,
                    'dwell_time': 2
                };
                return weights[type] || 1;
            }

            // Update trending topics
            updateTrendingTopics(interaction) {
                interaction.hashtags.forEach(hashtag => {
                    if (!this.trendingTopics.has(hashtag)) {
                        this.trendingTopics.set(hashtag, { count: 0, score: 0, lastUpdate: Date.now() });
                    }
                    
                    const topic = this.trendingTopics.get(hashtag);
                    topic.count++;
                    topic.score += this.getInteractionWeight(interaction.type);
                    topic.lastUpdate = Date.now();
                });
            }

            // Calculate content relevance score for a user
            calculateRelevanceScore(userId, buzz) {
                let score = 0;
                const userInterests = this.userInterests.get(userId) || {};
                
                // Base recency score
                const ageHours = (Date.now() - buzz.timestamp) / (1000 * 60 * 60);
                score += Math.max(0, 100 - ageHours * 2); // Decay over time
                
                // Interest matching
                const buzzHashtags = this.extractHashtags(buzz.content || '');
                const buzzKeywords = this.extractKeywords(buzz.content || '');
                
                buzzHashtags.forEach(hashtag => {
                    if (userInterests[hashtag]) {
                        score += userInterests[hashtag] * 10;
                    }
                });
                
                buzzKeywords.forEach(keyword => {
                    if (userInterests[keyword]) {
                        score += userInterests[keyword] * 5;
                    }
                });
                
                // Engagement boost
                const likes = buzz.likes ? Object.keys(buzz.likes).length : 0;
                const shares = buzz.shares || 0;
                score += likes * 2 + shares * 5;
                
                // Boost multiplier
                if (buzz.boosted) {
                    score *= buzz.boostMultiplier || 2;
                }
                
                // Following bonus
                const userHistory = this.engagementHistory.get(userId) || [];
                const hasInteractedWithAuthor = userHistory.some(h => h.authorId === buzz.uid);
                if (hasInteractedWithAuthor) {
                    score *= 1.5;
                }
                
                return score;
            }

            // Get personalized feed for user
            getPersonalizedFeed(userId, buzzes, limit = 20) {
                const scoredBuzzes = buzzes.map(buzz => ({
                    ...buzz,
                    relevanceScore: this.calculateRelevanceScore(userId, buzz)
                }));
                
                return scoredBuzzes
                    .sort((a, b) => b.relevanceScore - a.relevanceScore)
                    .slice(0, limit);
            }

            // Get trending hashtags
            getTrendingHashtags(limit = 10) {
                const now = Date.now();
                const dayMs = 24 * 60 * 60 * 1000;
                
                return Array.from(this.trendingTopics.entries())
                    .filter(([hashtag, data]) => now - data.lastUpdate < dayMs)
                    .sort((a, b) => b[1].score - a[1].score)
                    .slice(0, limit)
                    .map(([hashtag, data]) => ({ hashtag, ...data }));
            }

            // Get content recommendations
            getRecommendations(userId, allUsers, limit = 5) {
                const userInterests = this.userInterests.get(userId) || {};
                const userKeywords = Object.keys(userInterests);
                
                return allUsers
                    .filter(user => user.uid !== userId)
                    .map(user => {
                        let score = 0;
                        const userBio = (user.bio || '').toLowerCase();
                        
                        userKeywords.forEach(keyword => {
                            if (userBio.includes(keyword.replace('#', ''))) {
                                score += userInterests[keyword];
                            }
                        });
                        
                        return { ...user, recommendationScore: score };
                    })
                    .filter(user => user.recommendationScore > 0)
                    .sort((a, b) => b.recommendationScore - a.recommendationScore)
                    .slice(0, limit);
            }
        }

        // Initialize algorithm
        const algorithm = new OrioBuzzAlgorithm();

        // Authentication
        async function signInWithGoogle() {
            try {
                const result = await signInWithPopup(auth, provider);
                currentUser = result.user;
                
                // Check if user profile exists
                const userRef = ref(database, `users/${currentUser.uid}`);
                const snapshot = await get(userRef);
                
                if (!snapshot.exists()) {
                    await createUserProfile();
                }
                
                showMainApp();
            } catch (error) {
                console.error('Sign in failed:', error);
                alert('Sign in failed. Please try again.');
            }
        }

        async function createUserProfile() {
            const isVerified = verifiedEmails.includes(currentUser.email);
            const autoAccount = autoAccounts[currentUser.email];
            
            const userProfile = {
                uid: currentUser.uid,
                email: currentUser.email,
                username: autoAccount ? autoAccount.username : currentUser.displayName || currentUser.email.split('@')[0],
                bio: autoAccount ? autoAccount.bio : '',
                location: '',
                contact: '',
                photoURL: currentUser.photoURL || '',
                verified: isVerified,
                premium: premiumEligible.includes(currentUser.email),
                followers: {},
                following: {},
                buzzCount: 0,
                interests: autoAccount ? ['technology', 'business', 'innovation'] : [],
                algorithmPrefs: {
                    contentPriority: 'personalized',
                    interestWeight: 70,
                    showBoosted: true,
                    diverseContent: true
                },
                createdAt: Date.now()
            };

            await set(ref(database, `users/${currentUser.uid}`), userProfile);
        }

        function logoutUser() {
            if (confirm('Are you sure you want to logout?')) {
                signOut(auth);
            }
        }

        // App initialization
        function showMainApp() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadUserProfile();
            loadAllData();
        }

        async function loadAllData() {
            await Promise.all([
                loadBuzzFeed(),
                loadAllUsers(),
                loadTrendingHashtags(),
                loadRecommendedUsers(),
                loadUserInterests(),
                loadAnalytics()
            ]);
        }

        async function loadUserProfile() {
            if (!currentUser) return;

            const userRef = ref(database, `users/${currentUser.uid}`);
            const snapshot = await get(userRef);
            const userData = snapshot.val();

            if (userData) {
                // Update sidebar
                document.getElementById('sidebarAvatarImg').src = userData.photoURL || 'https://via.placeholder.com/80';
                document.getElementById('sidebarUsername').innerHTML = `
                    ${userData.username}
                    ${userData.verified ? '<span class="verified-tick">‚úì</span>' : ''}
                    ${userData.premium ? '<span class="premium-badge">PREMIUM</span>' : ''}
                `;

                // Update composer
                document.getElementById('composerAvatarImg').src = userData.photoURL || 'https://via.placeholder.com/50';

                // Update profile page
                document.getElementById('profileAvatarImg').src = userData.photoURL || 'https://via.placeholder.com/120';
                document.getElementById('profileUsername').innerHTML = `
                    ${userData.username}
                    ${userData.verified ? '<span class="verified-tick">‚úì</span>' : ''}
                    ${userData.premium ? '<span class="premium-badge">PREMIUM</span>' : ''}
                `;
                document.getElementById('profileBio').textContent = userData.bio || 'Bio not set';
                document.getElementById('profileLocation').textContent = userData.location ? `üìç ${userData.location}` : 'üìç Location not set';
                document.getElementById('profileContact').textContent = userData.contact ? `üìû ${userData.contact}` : 'üìû Contact not set';

                // Update stats
                const followersCount = userData.followers ? Object.keys(userData.followers).length : 0;
                const followingCount = userData.following ? Object.keys(userData.following).length : 0;
                const buzzCount = userData.buzzCount || 0;

                document.getElementById('followersCount').textContent = followersCount;
                document.getElementById('followingCount').textContent = followingCount;
                document.getElementById('buzzCount').textContent = buzzCount;
                document.getElementById('profileFollowers').textContent = followersCount;
                document.getElementById('profileFollowing').textContent = followingCount;
                document.getElementById('profileBuzzes').textContent = buzzCount;

                // Show verified badges
                if (userData.verified) {
                    document.getElementById('sidebarVerified').classList.remove('hidden');
                    document.getElementById('profileVerified').classList.remove('hidden');
                }
            }
        }

        // Navigation
        function showPage(page) {
            // Hide all pages
            document.querySelectorAll('#feedPage, #profilePage, #analyticsPage, #trendingPage, #settingsPage').forEach(p => {
                p.classList.add('hidden');
            });

            // Remove active class from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected page
            document.getElementById(page + 'Page').classList.remove('hidden');
            event.target.classList.add('active');

            // Load page-specific content
            if (page === 'profile') {
                loadUserBuzzes();
            } else if (page === 'analytics') {
                loadAnalytics();
            } else if (page === 'trending') {
                loadTrendingContent();
            }
        }

        // Search functionality
        let searchTimeout;
        function performSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = document.getElementById('searchInput').value.trim().toLowerCase();
                if (query.length < 2) {
                    hideSearchResults();
                    return;
                }

                const results = [];
                
                // Search users
                allUsers.forEach(user => {
                    if (user.username.toLowerCase().includes(query) || 
                        user.email.toLowerCase().includes(query) ||
                        (user.bio && user.bio.toLowerCase().includes(query))) {
                        results.push({
                            type: 'user',
                            data: user,
                            relevance: calculateSearchRelevance(query, user.username + ' ' + user.bio)
                        });
                    }
                });

                // Search hashtags
                const hashtagQuery = query.startsWith('#') ? query : '#' + query;
                allBuzzes.forEach(buzz => {
                    const hashtags = algorithm.extractHashtags(buzz.content || '');
                    hashtags.forEach(hashtag => {
                        if (hashtag.toLowerCase().includes(hashtagQuery.toLowerCase())) {
                            results.push({
                                type: 'hashtag',
                                data: { hashtag, buzz },
                                relevance: calculateSearchRelevance(hashtagQuery, hashtag)
                            });
                        }
                    });
                });

                // Search content
                allBuzzes.forEach(buzz => {
                    if (buzz.content && buzz.content.toLowerCase().includes(query)) {
                        results.push({
                            type: 'content',
                            data: buzz,
                            relevance: calculateSearchRelevance(query, buzz.content)
                        });
                    }
                });

                displaySearchResults(results.sort((a, b) => b.relevance - a.relevance).slice(0, 10));
            }, 300);
        }

        function calculateSearchRelevance(query, text) {
            const queryWords = query.toLowerCase().split(' ');
            const textWords = text.toLowerCase().split(' ');
            let score = 0;
            
            queryWords.forEach(qWord => {
                textWords.forEach(tWord => {
                    if (tWord.includes(qWord)) {
                        score += qWord.length / tWord.length;
                    }
                });
            });
            
            return score;
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            container.innerHTML = '';
            
            if (results.length === 0) {
                container.innerHTML = '<div class="search-result-item">No results found</div>';
            } else {
                results.forEach(result => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    
                    if (result.type === 'user') {
                        item.innerHTML = `
                            <strong>üë§ ${result.data.username}</strong>
                            ${result.data.verified ? '<span class="verified-tick">‚úì</span>' : ''}
                            <br><small>${result.data.email}</small>
                        `;
                        item.onclick = () => viewUserProfile(result.data.uid);
                    } else if (result.type === 'hashtag') {
                        item.innerHTML = `
                            <strong>üè∑Ô∏è ${result.data.hashtag}</strong>
                            <br><small>Trending hashtag</small>
                        `;
                        item.onclick = () => searchHashtag(result.data.hashtag);
                    } else if (result.type === 'content') {
                        item.innerHTML = `
                            <strong>üìù Content</strong>
                            <br><small>${result.data.content.substring(0, 100)}...</small>
                        `;
                        item.onclick = () => viewBuzz(result.data.id);
                    }
                    
                    container.appendChild(item);
                });
            }
            
            container.style.display = 'block';
        }

        function showSearchResults() {
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                document.getElementById('searchResults').style.display = 'block';
            }
        }

        function hideSearchResults() {
            setTimeout(() => {
                document.getElementById('searchResults').style.display = 'none';
            }, 200);
        }

        // Buzz creation with hashtags and mentions
        function handleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('Image size should be less than 5MB');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedImageBase64 = e.target.result;
                    // Show preview
                    const preview = document.createElement('div');
                    preview.innerHTML = `<img src="${selectedImageBase64}" style="max-width: 200px; border-radius: 10px; margin-top: 10px;">`;
                    document.querySelector('.buzz-composer').appendChild(preview);
                };
                reader.readAsDataURL(file);
            }
        }

        function addEmoji() {
            const emojis = ['üòä', 'üòÇ', '‚ù§Ô∏è', 'üëç', 'üî•', 'üíØ', 'üöÄ', '‚ú®', 'üéâ', 'üí™'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            const textarea = document.getElementById('buzzContent');
            textarea.value += randomEmoji;
            textarea.focus();
        }

        function addHashtag() {
            const hashtags = ['#OrioBuzz', '#TechNews', '#Innovation', '#Business', '#Trending', '#AI', '#Future'];
            const randomHashtag = hashtags[Math.floor(Math.random() * hashtags.length)];
            const textarea = document.getElementById('buzzContent');
            textarea.value += ' ' + randomHashtag;
            textarea.focus();
        }

        function addMention() {
            if (allUsers.length > 0) {
                const randomUser = allUsers[Math.floor(Math.random() * allUsers.length)];
                const textarea = document.getElementById('buzzContent');
                textarea.value += ' @' + randomUser.username.replace(/\s+/g, '');
                textarea.focus();
            }
        }

        async function createBuzz() {
            const content = document.getElementById('buzzContent').value.trim();
            
            if (!content && !selectedImageBase64) {
                alert('Please enter some content or select an image');
                return;
            }

            if (!currentUser) return;

            const hashtags = algorithm.extractHashtags(content);
            const mentions = algorithm.extractMentions(content);
            const keywords = algorithm.extractKeywords(content);

            const buzzData = {
                uid: currentUser.uid,
                content: content,
                image: selectedImageBase64 || null,
                hashtags: hashtags,
                mentions: mentions,
                keywords: keywords,
                timestamp: Date.now(),
                likes: {},
                comments: {},
                shares: 0,
                views: 0,
                boosted: false,
                boostMultiplier: 1,
                boostExpiry: null
            };

            try {
                // Add buzz to database
                const buzzRef = await push(ref(database, 'buzzes'), buzzData);
                
                // Track interaction for algorithm
                algorithm.trackInteraction(currentUser.uid, buzzRef.key, 'create', content);
                
                // Update user's buzz count
                const userRef = ref(database, `users/${currentUser.uid}`);
                const snapshot = await get(userRef);
                const userData = snapshot.val();
                await update(userRef, { buzzCount: (userData.buzzCount || 0) + 1 });

                // Process mentions (notify mentioned users)
                mentions.forEach(mention => {
                    const username = mention.replace('@', '');
                    // In a real app, this would send notifications
                    console.log(`Mentioned user: ${username}`);
                });

                // Clear form
                document.getElementById('buzzContent').value = '';
                document.getElementById('imageInput').value = '';
                selectedImageBase64 = null;
                
                // Remove preview if exists
                const preview = document.querySelector('.buzz-composer img');
                if (preview) {
                    preview.parentElement.remove();
                }

                loadBuzzFeed();
                loadUserProfile();
                loadTrendingHashtags();
            } catch (error) {
                console.error('Failed to create buzz:', error);
                alert('Failed to create buzz. Please try again.');
            }
        }

        // Advanced feed loading with algorithm
        async function loadBuzzFeed() {
            const buzzesRef = ref(database, 'buzzes');
            const snapshot = await get(buzzesRef);
            allBuzzes = [];

            if (snapshot.exists()) {
                snapshot.forEach(childSnapshot => {
                    const buzz = childSnapshot.val();
                    buzz.id = childSnapshot.key;
                    allBuzzes.push(buzz);
                });
            }

            // Get personalized feed using algorithm
            const personalizedBuzzes = currentUser ? 
                algorithm.getPersonalizedFeed(currentUser.uid, allBuzzes) : 
                allBuzzes.sort((a, b) => b.timestamp - a.timestamp);

            const buzzFeed = document.getElementById('buzzFeed');
            buzzFeed.innerHTML = '';

            for (const buzz of personalizedBuzzes) {
                const userSnapshot = await get(ref(database, `users/${buzz.uid}`));
                const userData = userSnapshot.val();
                
                if (userData) {
                    const buzzElement = createBuzzElement(buzz, userData);
                    buzzFeed.appendChild(buzzElement);
                    
                    // Track view interaction
                    if (currentUser && buzz.uid !== currentUser.uid) {
                        algorithm.trackInteraction(currentUser.uid, buzz.id, 'view', buzz.content);
                        
                        // Update view count in database
                        const viewRef = ref(database, `buzzes/${buzz.id}/views`);
                        const viewSnapshot = await get(viewRef);
                        const currentViews = viewSnapshot.val() || 0;
                        await set(viewRef, currentViews + 1);
                    }
                }
            }
        }

        function createBuzzElement(buzz, userData) {
            const buzzDiv = document.createElement('div');
            buzzDiv.className = 'buzz-post';
            
            const likesCount = buzz.likes ? Object.keys(buzz.likes).length : 0;
            const commentsCount = buzz.comments ? Object.keys(buzz.comments).length : 0;
            const viewsCount = buzz.views || 0;
            const isLiked = buzz.likes && currentUser && buzz.likes[currentUser.uid];
            const isShared = buzz.shares && currentUser && buzz.shares[currentUser.uid];
            
            // Process content for hashtags and mentions
            let processedContent = buzz.content || '';
            
            // Make hashtags clickable
            processedContent = processedContent.replace(/#[\w]+/g, (hashtag) => {
                return `<span class="hashtag" onclick="searchHashtag('${hashtag}')">${hashtag}</span>`;
            });
            
            // Make mentions clickable
            processedContent = processedContent.replace(/@[\w]+/g, (mention) => {
                return `<span class="mention" onclick="searchMention('${mention}')">${mention}</span>`;
            });

            // Determine recommendation reason
            let recommendationReason = '';
            if (currentUser && buzz.uid !== currentUser.uid) {
                const userInterests = algorithm.userInterests.get(currentUser.uid) || {};
                const buzzHashtags = algorithm.extractHashtags(buzz.content || '');
                const matchedInterests = buzzHashtags.filter(tag => userInterests[tag]);
                
                if (matchedInterests.length > 0) {
                    recommendationReason = `Recommended based on your interest in ${matchedInterests[0]}`;
                } else if (buzz.boosted) {
                    recommendationReason = 'Promoted content';
                } else {
                    recommendationReason = 'Popular in your network';
                }
            }
            
            buzzDiv.innerHTML = `
                ${buzz.boosted ? '<div class="boost-indicator">üöÄ Boosted Post - Reaching More Users</div>' : ''}
                ${recommendationReason ? `<div class="recommendation-reason">${recommendationReason}</div>` : ''}
                <div class="buzz-header">
                    <div class="buzz-avatar">
                        <img src="${userData.photoURL || 'https://via.placeholder.com/50'}" alt="${userData.username}">
                    </div>
                    <div class="buzz-user-info">
                        <div class="buzz-username">
                            ${userData.username}
                            ${userData.verified ? '<span class="verified-tick">‚úì</span>' : ''}
                            ${userData.premium ? '<span class="premium-badge">PREMIUM</span>' : ''}
                        </div>
                        <div class="buzz-time">${formatTime(buzz.timestamp)} ‚Ä¢ ${viewsCount} views</div>
                    </div>
                </div>
                <div class="buzz-content">${processedContent}</div>
                ${buzz.image ? `<img src="${buzz.image}" class="buzz-image" alt="Buzz image">` : ''}
                <div class="buzz-actions">
                    <button class="buzz-action ${isLiked ? 'liked' : ''}" onclick="toggleLike('${buzz.id}')">
                        ‚ù§Ô∏è ${likesCount}
                    </button>
                    <button class="buzz-action" onclick="showComments('${buzz.id}')">
                        üí¨ ${commentsCount}
                    </button>
                    <button class="buzz-action ${isShared ? 'shared' : ''}" onclick="shareBuzz('${buzz.id}')">
                        üîÑ ${buzz.shares || 0}
                    </button>
                    ${userData.premium && buzz.uid === currentUser?.uid ? 
                        `<button class="buzz-action" onclick="openBoostModal('${buzz.id}')">üöÄ Boost</button>` : ''}
                </div>
                ${buzz.relevanceScore ? `<div class="algorithm-indicator">Score: ${Math.round(buzz.relevanceScore)}</div>` : ''}
            `;

            return buzzDiv;
        }

        async function toggleLike(buzzId) {
            if (!currentUser) return;

            const likeRef = ref(database, `buzzes/${buzzId}/likes/${currentUser.uid}`);
            const snapshot = await get(likeRef);
            const buzzRef = ref(database, `buzzes/${buzzId}`);
            const buzzSnapshot = await get(buzzRef);
            const buzzData = buzzSnapshot.val();

            if (snapshot.exists()) {
                await remove(likeRef);
            } else {
                await set(likeRef, true);
                // Track like interaction for algorithm
                algorithm.trackInteraction(currentUser.uid, buzzId, 'like', buzzData.content);
            }

            loadBuzzFeed();
        }

        async function shareBuzz(buzzId) {
            if (!currentUser) return;

            const shareRef = ref(database, `buzzes/${buzzId}/shares`);
            const snapshot = await get(shareRef);
            const currentShares = snapshot.val() || 0;
            const buzzRef = ref(database, `buzzes/${buzzId}`);
            const buzzSnapshot = await get(buzzRef);
            const buzzData = buzzSnapshot.val();

            await set(shareRef, currentShares + 1);
            
            // Track share interaction for algorithm
            algorithm.trackInteraction(currentUser.uid, buzzId, 'share', buzzData.content);
            
            loadBuzzFeed();
            alert('Buzz shared! üîÑ This helps our algorithm understand your preferences.');
        }

        // Advanced boost system
        function openBoostModal(buzzId) {
            currentBuzzToBoost = buzzId;
            openModal('boostModal');
        }

        function selectBoostOption(element, type) {
            document.querySelectorAll('.boost-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedBoostType = type;
        }

        async function confirmBoost() {
            if (!selectedBoostType || !currentBuzzToBoost) {
                alert('Please select a boost option');
                return;
            }

            const boostMultipliers = {
                'basic': 2,
                'premium': 5,
                'viral': 10
            };

            const boostDurations = {
                'basic': 24 * 60 * 60 * 1000, // 24 hours
                'premium': 72 * 60 * 60 * 1000, // 72 hours
                'viral': 168 * 60 * 60 * 1000 // 1 week
            };

            try {
                const buzzRef = ref(database, `buzzes/${currentBuzzToBoost}`);
                await update(buzzRef, {
                    boosted: true,
                    boostType: selectedBoostType,
                    boostMultiplier: boostMultipliers[selectedBoostType],
                    boostExpiry: Date.now() + boostDurations[selectedBoostType],
                    boostTimestamp: Date.now()
                });

                closeModal('boostModal');
                loadBuzzFeed();
                
                alert(`üöÄ Buzz boosted successfully! Your content will now reach ${boostMultipliers[selectedBoostType]}x more users and appear higher in feeds.`);
                
                selectedBoostType = null;
                currentBuzzToBoost = null;
            } catch (error) {
                console.error('Failed to boost buzz:', error);
                alert('Failed to boost buzz. Please try again.');
            }
        }

        // Hashtag and mention search
        function searchHashtag(hashtag) {
            const buzzFeed = document.getElementById('buzzFeed');
            buzzFeed.innerHTML = '<h3>üè∑Ô∏è Posts with ' + hashtag + '</h3>';
            
            const filteredBuzzes = allBuzzes.filter(buzz => 
                buzz.content && buzz.content.includes(hashtag)
            );
            
            filteredBuzzes.forEach(async (buzz) => {
                const userSnapshot = await get(ref(database, `users/${buzz.uid}`));
                const userData = userSnapshot.val();
                if (userData) {
                    const buzzElement = createBuzzElement(buzz, userData);
                    buzzFeed.appendChild(buzzElement);
                }
            });
            
            // Track hashtag interest
            if (currentUser) {
                algorithm.trackInteraction(currentUser.uid, 'hashtag_search', 'view', hashtag);
            }
        }

        function searchMention(mention) {
            const username = mention.replace('@', '');
            const user = allUsers.find(u => u.username.replace(/\s+/g, '').toLowerCase() === username.toLowerCase());
            if (user) {
                viewUserProfile(user.uid);
            }
        }

        // Load trending hashtags
        async function loadTrendingHashtags() {
            const trending = algorithm.getTrendingHashtags();
            const container = document.getElementById('trendingHashtags');
            container.innerHTML = '';
            
            trending.forEach(item => {
                const trendingDiv = document.createElement('div');
                trendingDiv.className = 'trending-item';
                trendingDiv.innerHTML = `
                    <div class="trending-topic">${item.hashtag}</div>
                    <div class="trending-count">${item.count} buzzes</div>
                `;
                trendingDiv.onclick = () => searchHashtag(item.hashtag);
                container.appendChild(trendingDiv);
            });
        }

        // Load recommended users
        async function loadRecommendedUsers() {
            if (!currentUser) return;
            
            const recommendations = algorithm.getRecommendations(currentUser.uid, allUsers);
            const container = document.getElementById('recommendedUsers');
            container.innerHTML = '';
            
            recommendations.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-list-item';
                userDiv.innerHTML = `
                    <div class="user-list-avatar">
                        <img src="${user.photoURL || 'https://via.placeholder.com/50'}" alt="${user.username}">
                    </div>
                    <div class="user-list-info">
                        <div class="user-list-name">
                            ${user.username}
                            ${user.verified ? '<span class="verified-tick">‚úì</span>' : ''}
                        </div>
                        <div class="user-list-email">Recommended for you</div>
                    </div>
                `;
                userDiv.onclick = () => viewUserProfile(user.uid);
                container.appendChild(userDiv);
            });
        }

        // Load user interests
        async function loadUserInterests() {
            if (!currentUser) return;
            
            const userRef = ref(database, `users/${currentUser.uid}`);
            const snapshot = await get(userRef);
            const userData = snapshot.val();
            
            if (userData && userData.interests) {
                const container = document.getElementById('userInterests');
                container.innerHTML = '';
                
                userData.interests.forEach(interest => {
                    const tag = document.createElement('div');
                    tag.className = 'interest-tag';
                    tag.textContent = interest;
                    tag.onclick = () => searchHashtag('#' + interest);
                    container.appendChild(tag);
                });
            }
        }

        // Analytics
        async function loadAnalytics() {
            if (!currentUser) return;
            
            const userBuzzes = allBuzzes.filter(buzz => buzz.uid === currentUser.uid);
            
            let totalViews = 0;
            let totalLikes = 0;
            let totalShares = 0;
            
            userBuzzes.forEach(buzz => {
                totalViews += buzz.views || 0;
                totalLikes += buzz.likes ? Object.keys(buzz.likes).length : 0;
                totalShares += buzz.shares || 0;
            });
            
            const engagementRate = totalViews > 0 ? ((totalLikes + totalShares) / totalViews * 100).toFixed(1) : 0;
            const reachScore = Math.min(100, Math.floor((totalViews + totalLikes * 5 + totalShares * 10) / 10));
            
            document.getElementById('totalViews').textContent = totalViews.toLocaleString();
            document.getElementById('totalLikes').textContent = totalLikes.toLocaleString();
            document.getElementById('engagementRate').textContent = engagementRate + '%';
            document.getElementById('reachScore').textContent = reachScore;
        }

        // Load all users
        async function loadAllUsers() {
            const usersRef = ref(database, 'users');
            const snapshot = await get(usersRef);
            allUsers = [];

            if (snapshot.exists()) {
                snapshot.forEach(childSnapshot => {
                    const user = childSnapshot.val();
                    if (user.uid !== currentUser?.uid) {
                        allUsers.push(user);
                    }
                });
            }
        }

        // Utility functions
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h';
            return Math.floor(diff / 86400000) + 'd';
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            if (modalId === 'profileModal') {
                loadCurrentUserData();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function loadCurrentUserData() {
            if (!currentUser) return;

            const userRef = ref(database, `users/${currentUser.uid}`);
            const snapshot = await get(userRef);
            const userData = snapshot.val();

            if (userData) {
                document.getElementById('editUsername').value = userData.username || '';
                document.getElementById('editBio').value = userData.bio || '';
                document.getElementById('editLocation').value = userData.location || '';
                document.getElementById('editContact').value = userData.contact || '';
                document.getElementById('editInterests').value = (userData.interests || []).join(', ');
            }
        }

        async function updateProfile() {
            if (!currentUser) return;

            const username = document.getElementById('editUsername').value.trim();
            const bio = document.getElementById('editBio').value.trim();
            const location = document.getElementById('editLocation').value.trim();
            const contact = document.getElementById('editContact').value.trim();
            const interests = document.getElementById('editInterests').value.split(',').map(i => i.trim()).filter(i => i);

            if (!username) {
                alert('Username is required');
                return;
            }

            const updates = {
                username: username,
                bio: bio,
                location: location,
                contact: contact,
                interests: interests
            };

            try {
                await update(ref(database, `users/${currentUser.uid}`), updates);
                closeModal('profileModal');
                loadUserProfile();
                loadUserInterests();
                alert('Profile updated successfully! ‚úÖ');
            } catch (error) {
                console.error('Failed to update profile:', error);
                alert('Failed to update profile. Please try again.');
            }
        }

        function showPremiumFeatures() {
            const userRef = ref(database, `users/${currentUser.uid}`);
            get(userRef).then(snapshot => {
                const userData = snapshot.val();
                if (userData.premium) {
                    alert('üéâ You already have Premium access!\n\n‚ú® Features you can use:\nüöÄ Boost your buzzes\nüìä Advanced analytics\nüéØ Algorithm customization\nüí¨ Priority support\nüîç Advanced search');
                } else {
                    alert('üíé OrioBuzz Premium Features:\n\nüöÄ Boost your buzzes for maximum reach\nüìä Detailed analytics and insights\nüéØ Customize your feed algorithm\nüí¨ Priority customer support\nüîç Advanced search and filters\n‚ú® Exclusive premium badges\n\nUpgrade to Premium for just $9.99/month!');
                }
            });
        }

        function showComments(buzzId) {
            alert('üí¨ Advanced commenting system coming soon! This will include threaded replies, reactions, and smart moderation.');
        }

        function viewUserProfile(userId) {
            alert(`üë§ User profile viewer coming soon! This will show detailed user information and their buzz history.`);
        }

        function viewBuzz(buzzId) {
            alert(`üìù Individual buzz viewer coming soon! This will show the buzz with all comments and interactions.`);
        }

        // Initialize app
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                showMainApp();
            } else {
                currentUser = null;
                document.getElementById('authSection').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Handle search input events
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'977b2c4261a89cd7',t:'MTc1NjYyOTEwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
