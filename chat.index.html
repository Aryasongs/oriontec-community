<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Oriontec Chat â€“ WhatsApp Style</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --brand:#075e54;
  --mine:#dcf8c6;
  --other:#fff;
  --bg:#e5ddd5;
  --avatar:#34b7f1;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:system-ui,sans-serif;background:var(--bg)}
header{
  background:var(--brand);color:#fff;padding:12px 16px;font-weight:600;
  display:flex;align-items:center;gap:8px;font-size:18px
}
header span.logo{
  display:inline-block;width:32px;height:32px;background:#fff3;border-radius:50%;
}
#chat{height:calc(100% - 136px);overflow-y:auto;padding:8px 10px}
.bubble{max-width:75%;padding:8px 10px;border-radius:8px 8px 8px 0;margin:6px 0;font-size:15px;
        position:relative;word-wrap:break-word;white-space:pre-wrap;line-height:1.35}
.mine{background:var(--mine);margin-left:auto;border-radius:8px 0 8px 8px}
.other{background:var(--other);margin-right:auto;border-radius:0 8px 8px 8px}
.bubble img{max-width:160px;border-radius:6px;margin-top:4px;display:block}
.time{font-size:11px;color:#555;margin-top:2px;text-align:right}
#inputBar{
  height:80px;background:#fff;padding:8px;border-top:1px solid #ccc;
  display:flex;gap:6px
}
#message{flex:1;padding:10px 8px;font-size:15px;border:1px solid #ccc;border-radius:6px}
#file{display:none}
button, label.upload{
  background:var(--brand);color:#fff;border:none;border-radius:6px;padding:0 14px;font-size:15px;
  display:flex;align-items:center;justify-content:center;cursor:pointer
}
label.upload{padding:0 10px;background:#25d366}
input[readonly]{background:#f0f0f0}
a{color:#0066cc;text-decoration:underline}
</style>
</head>
<body>

<header><span class="logo"></span> Oriontec Community</header>
<div id="chat"></div>

<div id="inputBar">
  <label class="upload" for="file">ðŸ“Ž</label>
  <input id="file" type="file" accept="image/*">
  <input id="message" placeholder="Type a message">
  <button onclick="sendMessage()">âž¤</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL }
        from "https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";

const firebaseConfig = {
  apiKey:"AIzaSyAl8eI-_8Ew9va0KPV8p4D2hc9WUTGiwuI",
  authDomain:"chat-d647c.firebaseapp.com",
  databaseURL:"https://chat-d647c-default-rtdb.firebaseio.com",
  projectId:"chat-d647c",
  storageBucket:"chat-d647c.appspot.com",
  messagingSenderId:"1001806177737",
  appId:"1:1001806177737:web:7248a0983dcf0d45a87418"
};
const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);
const st  = getStorage(app);
const msgRef = ref(db,"messages");

const chatDiv = document.getElementById("chat");
const nameInput=document.getElementById("name")||(()=>{const n=document.createElement('input');n.style.display='none';return n})();
const saved=localStorage.getItem("oriontecName");
if(saved){nameInput.value=saved;nameInput.readOnly=true;}

const banned=["bakwaas","spoilerboy","madarchod","badguy123"].map(x=>x.toLowerCase());

onChildAdded(msgRef,snap=>{
  const {name,text,img,ts}=snap.val();
  const me=(saved||"").toLowerCase()===name.toLowerCase();
  const bubble=document.createElement('div');
  bubble.className=`bubble ${me?'mine':'other'}`;
  const linked=text.replace(/(https?:\/\/[^\s]+)/g,u=>`<a href="${u}" target="_blank">${u}</a>`);
  bubble.innerHTML=`${linked}${img?`<br><a href="${img}" target="_blank"><img src="${img}"></a>`:''}
                    <div class="time">${new Date(ts).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>`;
  chatDiv.appendChild(bubble);
  chatDiv.scrollTop=chatDiv.scrollHeight;
});

window.sendMessage=async()=>{
  const name=saved||prompt("Enter your name").trim();
  if(!name)return;
  if(!saved){localStorage.setItem("oriontecName",name);}
  if(banned.includes(name.toLowerCase())){alert("ðŸš« You are banned.");return;}

  const text=document.getElementById("message").value.trim();
  const file=document.getElementById("file").files[0];
  if(!text && !file)return;

  let imgURL="";
  if(file){
    if(file.size>2*1024*1024){alert("Image > 2 MB");return;}
    const ext=file.name.split('.').pop();
    const path=`chatPics/${Date.now()}_${name}.${ext}`;
    const sref=sRef(st,path);
    await uploadBytes(sref,file);
    imgURL=await getDownloadURL(sref);
  }

  push(msgRef,{name,text,img:imgURL,ts:Date.now()});
  document.getElementById("message").value="";
  document.getElementById("file").value="";
};
</script>
</body>
</html>
