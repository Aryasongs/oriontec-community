<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OrioPlay Reels</title>
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box;}
    html, body {
      height: 100%; overflow: hidden;
      background: #000; color: white;
      font-family: Arial, sans-serif;
    }
    .reel-container {
      height: 100vh; width: 100vw;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
    }
    .reel {
      height: 100vh; width: 100%;
      position: relative;
      scroll-snap-align: start;
      display: flex; justify-content: center; align-items: center;
    }
    video {
      height: 100%; width: 100%;
      object-fit: cover;
    }
    .overlay {
      position: absolute; bottom: 20px; left: 20px; z-index: 10;
    }
    .overlay h4 {margin-bottom: 5px;}
    .actions {
      position: absolute; right: 20px; bottom: 100px; z-index: 10;
      display: flex; flex-direction: column; align-items: center;
    }
    .actions div {
      margin: 10px 0; cursor: pointer;
      text-align: center;
    }
    .comments {
      position: absolute; bottom: 0; left: 0;
      width: 100%; background: rgba(0,0,0,0.7); padding: 10px;
    }
    .comments input {
      width: 70%; padding: 8px; border: none; border-radius: 4px;
    }
    .comments button {
      padding: 8px 12px; margin-left: 8px;
      background: #2196f3; color: white; border: none; border-radius: 4px;
    }
    .comments-list {
      max-height: 100px; overflow-y: auto;
      font-size: 14px; margin-top: 5px;
    }
  </style>
</head>
<body>

<div class="reel-container" id="reelContainer"></div>

<script type="module">
  // ✅ Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getFirestore, doc, getDoc, updateDoc,
    increment, collection, getDocs, setDoc
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  // ✅ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCVY2IUiijgzRPcOKWQl0MVlBQz0_N__sE",
    authDomain: "reels-bb234.firebaseapp.com",
    projectId: "reels-bb234",
    storageBucket: "reels-bb234.firebasestorage.app",
    messagingSenderId: "752485971097",
    appId: "1:752485971097:web:7132cccccb41f050ba3408"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const videos = [
    "AQMz7l-cbcOcNYT-F98p0tPeXpKNjd1C90HzaL4k-_e1HlXEMOXyJcmLTRXgsR85xblB-KEK6L-cfmKZTn1ne3LU43Pp6y1-r0FpoAA",
    "AQO8Id8yrvrtLFsQ3em-7eGeNKC0SWYQDCnGgPe6fRKWPRzc2jNrSiS6_6hfXzCbCiMhg-4fMBBPdZnw7I4FFDcKc8aSiNuvkHIpklY",
    "AQNI48SC1msBhQKuxyjeRYSo_3KKBsZ7sJU7evYodvwwNkKzx15RpfQD6bmIws9SqkKXumHfmm1_Zpse3sGfTN12qbr_LAAtNihZCj8",
    "AQNbGZpSZMrNlMTvlvyPCOFT_O19Oo77mPkwY_xmkp_Uijj5mB77PX0yNXv5ziWG93v_xBuK9vhgms6h1c6-XZhP5P_ziDJmnz1DkIU",
    "AQM-uzNKIG53Qn8OIE6C8ke-zbxFn4kS-LWhPln2JkRe0TV1-XKRidGM_MX5xoafOo3CftfOJmU--d93RSDAMZbJEvCuvVOtWe_7-6g",
    "AQMfYCk6cglI-EYVM_ikXiPDHu6AI0G5n63OfIlOlGB1mPStMS9-S3p4GZUMqKe7tHnS_y2LZU4We9ZFos7lwyAyTKZ2y9KHK7fwqDg",
    "AQNmookkwQ4zcFJa6WmnPpWtwPlAAhAs1NqUv4OO81rHqj4_-2rNmKYQL9EoUflZFM9CUJdKNCjX3JeXqCFHxky9YG-r85gHXVuFqDM",
    "AQOJk_n-zCbInDwXSaeQhdHKZswXi5iUwDsE6961Vk4leC0kjU5Ji2oYoNojQy-ehbSi0oiB86CU15kBD0SdlvpI8NsrIw2Vo5ne0AY",
    "AQOrFzZWJ0gGJbq2LbuH2rKMSQPkaEvLT2Tm5zpY3A3aP7vTvC13rcGDFjNbqYiqPRykI409W56EOGlFfrA-InKAu0sjC_rUlhgbUo4",
    "AQPWkxDUFBKHmU2AEfEnlO5uIDVpO3p6891VU_juxmxWWajnveqqJLGQr6Vrl1AlIIUezUV54LCSA5xIVBMKHF7joccNrY7HbTIBwfg"
  ];

  const usernames = ["@reelking98", "@aussieTrend", "@nyc.vibes", "@desiSwag", "@travelQueen", "@orionGuy", "@LA_drifter", "@punjabibae", "@australia.one", "@musicmoodz"];

  const reelContainer = document.getElementById("reelContainer");

  videos.forEach(async (vid, index) => {
    const videoId = `video_${index}`;
    const user = usernames[Math.floor(Math.random() * usernames.length)];
    const videoUrl = `https://community.oriontec.xyz/${vid}.mp4`;

    const docRef = doc(db, "Oriontec", videoId);
    const docSnap = await getDoc(docRef);

    if (!docSnap.exists()) {
      await setDoc(docRef, {
        likes: Math.floor(Math.random() * 10000) + 1000,
        comments: [],
        user: user,
        videoUrl: videoUrl
      });
    }

    const reelDiv = document.createElement("div");
    reelDiv.className = "reel";
    reelDiv.innerHTML = `
      <video src="${videoUrl}" muted loop playsinline></video>
      <div class="overlay">
        <h4>${user}</h4>
      </div>
      <div class="actions">
        <div class="likeBtn">❤️ <span id="like-${videoId}">0</span></div>
      </div>
      <div class="comments">
        <input placeholder="Your name" id="name-${videoId}" />
        <input placeholder="Add comment..." id="comment-${videoId}" />
        <button onclick="postComment('${videoId}')">Post</button>
        <div class="comments-list" id="clist-${videoId}"></div>
      </div>
    `;
    reelContainer.appendChild(reelDiv);

    const video = reelDiv.querySelector("video");
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          entry.isIntersecting ? video.play() : video.pause();
        });
      },
      { threshold: 0.7 }
    );
    observer.observe(video);

    const updateLikes = async () => {
      const snap = await getDoc(docRef);
      document.getElementById(`like-${videoId}`).innerText = snap.data().likes;
      const clist = snap.data().comments || [];
      document.getElementById(`clist-${videoId}`).innerHTML = clist.map(c => `<div><b>${c.name}:</b> ${c.text}</div>`).join("");
    };

    updateLikes();

    reelDiv.querySelector(".likeBtn").onclick = async () => {
      await updateDoc(docRef, { likes: increment(1) });
      updateLikes();
    };
  });

  window.postComment = async (id) => {
    const name = document.getElementById(`name-${id}`).value;
    const text = document.getElementById(`comment-${id}`).value;
    if (!name || !text) return alert("Fill both fields!");

    const ref = doc(db, "Oriontec", id);
    const snap = await getDoc(ref);
    const data = snap.data();
    const comments = data.comments || [];
    comments.push({ name, text });
    await updateDoc(ref, { comments });
    document.getElementById(`comment-${id}`).value = "";
    const clist = document.getElementById(`clist-${id}`);
    clist.innerHTML += `<div><b>${name}:</b> ${text}</div>`;
  };
</script>
</body>
</html>
