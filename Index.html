<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Oriontec Chat Room</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:sans-serif;background:#f5f5f5;padding:20px}
#top{margin-bottom:10px}
#chat{height:70vh;overflow-y:auto;background:#fff;border:1px solid #ccc;
      padding:10px;border-radius:6px}
.msg{margin:6px 0}
.msg span{font-weight:bold;color:#0077cc}
.msg small{color:#666;font-size:12px}
a{color:#0077cc;text-decoration:underline;word-break:break-all}
#entry{display:flex;gap:6px;margin-top:10px}
#message{flex:1;padding:8px;font-size:15px}
button{padding:8px 16px;font-size:15px}
</style>
</head>
<body>

<div id="top">
  <button id="gLogin">Sign in with Google</button>
  <span id="uInfo" style="display:none"></span>
</div>

<div id="chat"></div>

<div id="entry">
  <input id="message" placeholder="Type a message" disabled>
  <button id="sendBtn" onclick="send()" disabled>Send</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded }
        from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged }
        from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

/* Firebase config */
const firebaseConfig = {
  apiKey:"AIzaSyAl8eI-_8Ew9va0KPV8p4D2hc9WUTGiwuI",
  authDomain:"community.oriontec.xyz",
  databaseURL:"https://chat-d647c-default-rtdb.firebaseio.com",
  projectId:"chat-d647c",
  storageBucket:"chat-d647c.appspot.com",
  messagingSenderId:"1001806177737",
  appId:"1:1001806177737:web:7248a0983dcf0d45a87418"
};

const app  = initializeApp(firebaseConfig);
const db   = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const msgs = ref(db,"messages");

/* DOM shortcuts */
const loginBtn = document.getElementById("gLogin");
const userSpan = document.getElementById("uInfo");
const msgIn    = document.getElementById("message");
const sendBtn  = document.getElementById("sendBtn");
const chatDiv  = document.getElementById("chat");

/* Ban list (displayName lower-case) */
const banned = ["bakwaas","spoilerboy","madarchod","badguy123"];

/* ---------- Auth flow ---------- */
loginBtn.onclick = () => signInWithPopup(auth, provider).catch(alert);

onAuthStateChanged(auth, user=>{
  const logged = !!user;
  msgIn.disabled = sendBtn.disabled = !logged;
  loginBtn.style.display = logged ? "none" : "inline-block";
  userSpan.style.display = logged ? "inline-block" : "none";
  if (logged) userSpan.textContent = "ðŸ‘¤ "+user.displayName;
});

/* ---------- Render messages ---------- */
onChildAdded(msgs, snap=>{
  const {name,text,ts} = snap.val();
  const div = document.createElement("div");
  div.className="msg";
  const time = new Date(ts).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  const linked = text.replace(/(https?:\/\/[^\s]+)/g,
                 u=>`<a href="${u}" target="_blank">${u}</a>`);
  div.innerHTML = `<span>${name}</span> <small>${time}</small>: ${linked}`;
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
});

/* ---------- Send message ---------- */
window.send = () => {
  const user = auth.currentUser;
  if(!user) return;
  const name = user.displayName;
  if(banned.includes(name.toLowerCase())){alert("ðŸš« You are banned.");return;}

  const text = msgIn.value.trim();
  if(!text) return;
  push(msgs, {name,text,ts:Date.now()});
  msgIn.value="";
};
</script>
</body>
</html>
