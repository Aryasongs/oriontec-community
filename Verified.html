<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Get Verified</title>
  <style>
    * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'San Francisco', Roboto, sans-serif; }
    body { background: #f4f4f8; margin: 0; padding: 20px; }
    .form-container {
      max-width: 500px;
      background: white;
      margin: 0 auto;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      animation: fadeIn 1s ease;
    }
    h2 { text-align: center; color: #333; }
    label { font-weight: 600; display: block; margin-top: 15px; }
    input, textarea, select {
      width: 100%; padding: 10px; margin-top: 6px; border-radius: 10px;
      border: 1px solid #ddd; font-size: 14px;
    }
    button {
      margin-top: 20px; width: 100%; padding: 12px;
      background: #007aff; color: white; border: none;
      border-radius: 12px; font-size: 16px;
      transition: background 0.3s ease;
    }
    button:hover { background: #005fcc; }
    .success-message { color: green; text-align: center; font-weight: bold; margin-top: 15px; }
    @keyframes fadeIn { from {opacity: 0} to {opacity: 1} }
  </style>
</head>
<body>

<div class="form-container">
  <h2>Get Verified ‚úÖ</h2>
  <form id="verifyForm">
    <label>Full Name*</label>
    <input type="text" name="fullName" required />

    <label>Username / Handle*</label>
    <input type="text" name="username" required />

    <label>Email ID*</label>
    <input type="email" name="email" required />

    <label>Mobile Number (+country code)</label>
    <input type="text" name="phone" />

    <label>Article or Content URL*</label>
    <input type="url" name="articleUrl" required onblur="fetchTitle()" />

    <div id="articleTitle" style="margin-top:10px;color:#444;font-weight:500;"></div>

    <label>Reliable Proof URLs (Optional)</label>
    <textarea name="proofs" placeholder="Add multiple URLs separated by commas..."></textarea>

    <label>Platform Name</label>
    <input type="text" name="platform" />

    <label>Why you want verification?*</label>
    <textarea name="reason" required maxlength="500"></textarea>

    <label>Country</label>
    <input type="text" name="country" id="country" />

    <label><input type="checkbox" required /> I agree to terms and allow review of provided content.</label>

    <button type="submit">üîç Submit for Review</button>
    <div class="success-message" id="msg"></div>
  </form>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDf484oAB2abMTTeDd3Asxv3jac6yf3D8A",
    authDomain: "getverified-dd955.firebaseapp.com",
    projectId: "getverified-dd955",
    storageBucket: "getverified-dd955.appspot.com",
    messagingSenderId: "638952876965",
    appId: "1:638952876965:web:96b344ec32524c1301964c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  emailjs.init("QI1aOpAqKdm9d4BkT");
</script>

<!-- Logic -->
<script>
document.getElementById("verifyForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const form = e.target;
  const data = {
    fullName: form.fullName.value,
    username: form.username.value.toLowerCase(),
    email: form.email.value,
    phone: form.phone.value,
    articleUrl: form.articleUrl.value,
    title: document.getElementById("articleTitle").textContent,
    proofs: form.proofs.value,
    platform: form.platform.value,
    reason: form.reason.value,
    country: form.country.value || "Unknown",
    createdAt: new Date().toISOString()
  };

  try {
    // Firestore Save
    await db.collection("verifications").doc(data.username).set(data);

    // Email Send
    await emailjs.send("service_z3x1v6e", "template_yl4fwyg", {
      to_name: data.fullName,
      message: `Hi ${data.fullName},\n\nThanks for submitting your verification request.\nYou can track it here:\nhttps://www.oriontec.xyz/verified/${data.username}`
    });

    document.getElementById("msg").innerText = `Thanks! We‚Äôve received your request. Track at /verified/${data.username}`;
    form.reset();
    document.getElementById("articleTitle").textContent = "";
  } catch (err) {
    alert("Error submitting form. Try again later.\n" + err.message);
  }
});

function fetchTitle(){
  const url = document.querySelector("[name='articleUrl']").value;
  if (!url) return;
  fetch("https://textance.herokuapp.com/title/" + encodeURIComponent(url))
    .then(res => res.text())
    .then(title => {
      document.getElementById("articleTitle").textContent = "üîñ Title: " + title;
    }).catch(() => {
      document.getElementById("articleTitle").textContent = "Could not fetch title.";
    });
}

// Auto Country from IP
fetch('https://ipapi.co/json/')
  .then(res => res.json())
  .then(data => {
    document.getElementById("country").value = data.country_name;
  });
</script>
</body>
</html>
