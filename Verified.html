<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Get Verified on Our Platform</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'San Francisco', Roboto, Helvetica;
      background: #f2f2f7;
      padding: 30px;
    }
    .form-box {
      background: white;
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      animation: fadeIn 1s ease;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    input, textarea, select {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 12px;
      font-size: 16px;
    }
    button {
      background: #007aff;
      color: white;
      border: none;
      padding: 15px;
      width: 100%;
      border-radius: 12px;
      font-weight: bold;
      margin-top: 20px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #0051d4;
    }
    .success {
      color: green;
      text-align: center;
      font-weight: bold;
      padding-top: 20px;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
  </style>
</head>
<body>
  <div class="form-box">
    <h2>‚úÖ Get Verified on Our Platform</h2>
    <p>Submit your article or content URL and get a Verified Tick on your profile.</p>
    <form id="verifyForm">
      <input type="text" id="name" placeholder="Full Name" required>
      <input type="text" id="username" placeholder="Username / Handle" required>
      <input type="email" id="email" placeholder="Email ID" required>
      <input type="text" id="mobile" placeholder="Mobile (+91...)">
      <input type="url" id="articleUrl" placeholder="Article / Content URL" required>
      <input type="text" id="articleTitle" placeholder="Fetching title..." disabled>
      <textarea id="proofUrls" placeholder="Optional Proof URLs (LinkedIn, Twitter, Press Links)..."></textarea>
      <input type="text" id="platform" placeholder="Platform Name (e.g. Blogger)">
      <textarea id="reason" maxlength="500" placeholder="Why you want verification?" required></textarea>
      <select id="country"></select>
      <label><input type="checkbox" id="terms" required> I agree to terms and review</label>
      <button type="submit">üöÄ Submit Request</button>
    </form>
    <div class="success" id="successMsg"></div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDf484oAB2abMTTeDd3Asxv3jac6yf3D8A",
      authDomain: "getverified-dd955.firebaseapp.com",
      projectId: "getverified-dd955",
      storageBucket: "getverified-dd955.appspot.com",
      messagingSenderId: "638952876965",
      appId: "1:638952876965:web:96b344ec32524c1301964c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    emailjs.init("QI1aOpAqKdm9d4BkT");

    // Auto detect country
    fetch("https://ipapi.co/json/")
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("country");
        select.innerHTML = `<option value="${data.country_name}">${data.country_name}</option>`;
      });

    // Fetch title from URL
    document.getElementById("articleUrl").addEventListener("blur", async function () {
      let url = this.value;
      if (!url) return;
      try {
        const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(url));
        const text = await res.text();
        const titleMatch = text.match(/<title>(.*?)<\/title>/i);
        document.getElementById("articleTitle").value = titleMatch ? titleMatch[1] : "Title not found";
      } catch {
        document.getElementById("articleTitle").value = "Error fetching title";
      }
    });

    // Form Submission
    document.getElementById("verifyForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const username = document.getElementById("username").value;
      const data = {
        name: document.getElementById("name").value,
        username,
        email,
        mobile: document.getElementById("mobile").value,
        articleUrl: document.getElementById("articleUrl").value,
        articleTitle: document.getElementById("articleTitle").value,
        proofUrls: document.getElementById("proofUrls").value,
        platform: document.getElementById("platform").value,
        reason: document.getElementById("reason").value,
        country: document.getElementById("country").value,
        timestamp: new Date().toISOString()
      };

      try {
        await db.collection("verifications").doc(username).set(data);

        await emailjs.send("service_z3x1v6e", "template_yl4fwyg", {
          to_email: email,
          username: username,
          article_title: data.articleTitle,
          article_url: data.articleUrl,
        });

        document.getElementById("successMsg").innerText =
          `üéâ Thanks! We‚Äôve received your verification request.\nTrack at: https://www.oriontec.xyz/verified/${username}`;
        document.getElementById("verifyForm").reset();
      } catch (err) {
        alert("‚ùå Error submitting form. Try again later.\n" + err.message);
      }
    });
  </script>
</body>
</html>
