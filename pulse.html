<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse - Advanced Chat Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .premium-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .pulse-gradient {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        
        .verified-badge {
            background: #1DA1F2;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            margin-left: 4px;
        }
        
        .premium-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            margin-left: 4px;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }
        
        .story-ring {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            padding: 3px;
            border-radius: 50%;
        }
        
        .story-inner {
            background: #1f2937;
            border-radius: 50%;
            padding: 2px;
        }
        
        .reaction-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 8px 16px;
            display: flex;
            gap: 8px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .reaction-popup.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .reaction-btn {
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .reaction-btn:hover {
            transform: scale(1.3);
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid #374151;
            padding: 12px 0;
            z-index: 40;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            color: #3B82F6;
        }
        
        .nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .nav-item span {
            font-size: 10px;
        }
        
        .country-flag {
            width: 20px;
            height: 15px;
            border-radius: 2px;
            margin-right: 8px;
        }
        
        .voice-player {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
            min-width: 150px;
        }
        
        .play-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #3B82F6;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .wave-animation {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .wave-bar {
            width: 3px;
            height: 12px;
            background: #3B82F6;
            border-radius: 2px;
            animation: wave 1.5s ease-in-out infinite;
        }
        
        .wave-bar:nth-child(2) { animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes wave {
            0%, 100% { height: 8px; }
            50% { height: 20px; }
        }
        
        .story-viewer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: black;
            z-index: 60;
            display: none;
        }
        
        .story-progress {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .story-progress-bar {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .message-animation {
            animation: slideInUp 0.3s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .pulse-official {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        
        .premium-glow {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding-bottom: 80px;
            }
        }
    </style>
</head>
<body class="bg-black text-white overflow-hidden">
    <!-- Main Container -->
    <div class="flex h-screen">
        <!-- Sidebar (Desktop) -->
        <div class="hidden md:flex w-80 bg-gray-900 border-r border-gray-800 flex-col">
            <!-- Header -->
            <div class="p-4 border-b border-gray-800">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Pulse</h1>
                    <div class="flex space-x-2">
                        <button id="newChatBtn" class="p-2 rounded-full bg-gray-800 hover:bg-gray-700">
                            <i class="fas fa-plus text-sm"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Search -->
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" placeholder="Search chats..." class="w-full bg-gray-800 rounded-full py-2 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            
            <!-- Chat List -->
            <div class="flex-1 overflow-y-auto" id="chatList">
                <!-- Chats will be populated here -->
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col main-content">
            <!-- Current View Container -->
            <div id="viewContainer" class="flex-1">
                <!-- Home View -->
                <div id="homeView" class="h-full flex flex-col">
                    <!-- Welcome/Login Screen -->
                    <div id="welcomeScreen" class="flex-1 flex items-center justify-center bg-gradient-to-br from-gray-900 to-black">
                        <div class="text-center max-w-md mx-auto p-6">
                            <div class="w-32 h-32 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-comments text-4xl"></i>
                            </div>
                            <h2 class="text-3xl font-bold mb-4">Welcome to Pulse</h2>
                            <p class="text-gray-400 mb-8">Connect with friends and discover amazing features</p>
                            <button id="loginBtn" class="bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-full font-medium transition-colors">
                                <i class="fab fa-google mr-2"></i>Sign in with Google
                            </button>
                        </div>
                    </div>
                    
                    <!-- Chat Interface -->
                    <div id="chatInterface" class="flex-1 flex flex-col hidden">
                        <!-- Chat Header -->
                        <div class="p-4 border-b border-gray-800 bg-gray-900/80 backdrop-blur">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3" id="chatHeader">
                                    <!-- Will be populated dynamically -->
                                </div>
                                <div class="flex space-x-2">
                                    <button class="p-2 rounded-full bg-gray-800 hover:bg-gray-700">
                                        <i class="fas fa-video text-sm"></i>
                                    </button>
                                    <button class="p-2 rounded-full bg-gray-800 hover:bg-gray-700">
                                        <i class="fas fa-phone text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Messages Area -->
                        <div class="flex-1 overflow-y-auto p-4 space-y-4" id="messagesArea">
                            <!-- Messages will be populated here -->
                        </div>
                        
                        <!-- Message Input -->
                        <div class="p-4 border-t border-gray-800 bg-gray-900/80 backdrop-blur">
                            <div class="flex items-center space-x-3">
                                <button id="attachBtn" class="p-2 rounded-full bg-gray-800 hover:bg-gray-700">
                                    <i class="fas fa-paperclip text-sm"></i>
                                </button>
                                <div class="flex-1 relative">
                                    <input type="text" id="messageInput" placeholder="Type a message..." class="w-full bg-gray-800 rounded-full py-3 px-4 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button id="emojiBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 p-2 rounded-full bg-gray-700 hover:bg-gray-600">
                                        <i class="fas fa-smile text-sm"></i>
                                    </button>
                                </div>
                                <button id="sendBtn" class="p-3 rounded-full bg-blue-600 hover:bg-blue-700">
                                    <i class="fas fa-paper-plane text-sm"></i>
                                </button>
                                <button id="voiceBtn" class="p-2 rounded-full bg-gray-800 hover:bg-gray-700">
                                    <i class="fas fa-microphone text-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stories View -->
                <div id="storiesView" class="h-full bg-gray-900 hidden">
                    <div class="p-4 border-b border-gray-800">
                        <h2 class="text-xl font-bold">Stories</h2>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="storiesGrid">
                            <!-- Stories will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Profile View -->
                <div id="profileView" class="h-full bg-gray-900 hidden overflow-y-auto">
                    <div id="profileContent">
                        <!-- Profile content will be populated here -->
                    </div>
                </div>
                
                <!-- Settings View -->
                <div id="settingsView" class="h-full bg-gray-900 hidden overflow-y-auto">
                    <div class="p-4 border-b border-gray-800">
                        <h2 class="text-xl font-bold">Settings</h2>
                    </div>
                    <div class="p-4 space-y-6" id="settingsContent">
                        <!-- Settings content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation (Mobile) -->
    <div class="bottom-nav md:hidden">
        <div class="flex">
            <div class="nav-item active" data-view="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" data-view="stories">
                <i class="fas fa-circle-play"></i>
                <span>Stories</span>
            </div>
            <div class="nav-item" data-view="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
            <div class="nav-item" data-view="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </div>
    </div>
    
    <!-- Story Viewer -->
    <div id="storyViewer" class="story-viewer">
        <div class="story-progress">
            <div class="story-progress-bar"></div>
        </div>
        <div class="absolute top-16 left-4 right-4 flex items-center justify-between text-white">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-gray-600"></div>
                <div>
                    <div class="font-medium" id="storyUserName"></div>
                    <div class="text-sm text-gray-300" id="storyTime"></div>
                </div>
            </div>
            <button id="closeStory" class="p-2 rounded-full bg-black/30">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="flex items-center justify-center h-full">
            <div id="storyContent" class="max-w-md w-full"></div>
        </div>
        <div class="absolute bottom-20 left-4 right-4">
            <div id="storyViewers" class="text-white text-sm mb-4"></div>
            <div class="flex space-x-4">
                <button class="flex-1 bg-gray-800/50 rounded-full py-2 px-4 text-center">
                    <i class="fas fa-heart mr-2"></i>Like
                </button>
                <button class="flex-1 bg-gray-800/50 rounded-full py-2 px-4 text-center">
                    <i class="fas fa-share mr-2"></i>Share
                </button>
            </div>
        </div>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-2xl p-8 w-96 max-w-md mx-4">
            <h2 class="text-2xl font-bold mb-6 text-center">Welcome to Pulse</h2>
            <div class="space-y-4">
                <input type="email" id="emailInput" placeholder="Email" class="w-full bg-gray-800 rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="nameInput" placeholder="Full Name" class="w-full bg-gray-800 rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <button id="googleSignInBtn" class="w-full bg-white text-black py-3 px-4 rounded-xl font-medium mt-6 hover:bg-gray-100 transition-colors">
                <i class="fab fa-google mr-2"></i>Continue with Google
            </button>
        </div>
    </div>
    
    <!-- Premium Modal -->
    <div id="premiumModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-2xl p-8 w-96 max-w-md mx-4 premium-glow">
            <div class="text-center">
                <div class="w-20 h-20 premium-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-crown text-2xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold mb-2">Pulse Premium</h2>
                <div class="text-4xl font-bold text-yellow-400 mb-4">$130</div>
                <div class="space-y-3 text-left mb-6">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-check text-green-400"></i>
                        <span>Edit sent messages</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-check text-green-400"></i>
                        <span>View deleted messages</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-check text-green-400"></i>
                        <span>Premium verified badge</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-check text-green-400"></i>
                        <span>Advanced privacy controls</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-check text-green-400"></i>
                        <span>Priority support</span>
                    </div>
                </div>
                <button id="upgradePremium" class="w-full premium-gradient text-white py-3 px-4 rounded-xl font-medium">
                    Upgrade to Premium
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hidden File Inputs -->
    <input type="file" id="photoInput" accept="image/*" class="hidden">
    <input type="file" id="videoInput" accept="video/*" class="hidden">

    <script>
        // Global Variables
        let currentUser = null;
        let currentChat = null;
        let currentView = 'home';
        let userCountry = 'Unknown';
        let isRecording = false;
        let mediaRecorder = null;
        
        // Predefined Users
        const predefinedUsers = {
            'pulse_official': {
                uid: 'pulse_official',
                name: 'Pulse',
                email: 'official@pulse.com',
                profilePic: null,
                status: 'Online',
                country: 'United States',
                countryCode: 'US',
                verified: true,
                premium: false,
                accountType: 'official',
                bio: 'Official Pulse account - Your gateway to seamless communication',
                lastSeen: Date.now(),
                isOfficial: true
            },
            'sgursharn076@gmail.com': {
                uid: 'gursharn_arya',
                name: 'Gursharn Arya',
                email: 'sgursharn076@gmail.com',
                profilePic: null,
                status: 'Online',
                country: 'India',
                countryCode: 'IN',
                verified: true,
                premium: true,
                accountType: 'premium',
                bio: 'CEO & Founder at Dozera Group | Premium Pulse User',
                company: 'Dozera Group',
                lastSeen: Date.now(),
                isPremium: true
            }
        };
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            detectUserCountry();
            setupEventListeners();
            loadPredefinedChats();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('pulseUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                initializeApp(currentUser);
            }
        });
        
        // Detect User Country
        async function detectUserCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                userCountry = data.country_name || 'Unknown';
            } catch (error) {
                console.log('Could not detect country');
            }
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            // Login
            document.getElementById('loginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').classList.remove('hidden');
            });
            
            document.getElementById('googleSignInBtn').addEventListener('click', handleLogin);
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => switchView(item.dataset.view));
            });
            
            // Message sending
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Voice recording
            document.getElementById('voiceBtn').addEventListener('click', toggleVoiceRecording);
            
            // File attachments
            document.getElementById('attachBtn').addEventListener('click', () => {
                document.getElementById('photoInput').click();
            });
            
            document.getElementById('photoInput').addEventListener('change', handleFileUpload);
            
            // Close modals
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('fixed')) {
                    e.target.classList.add('hidden');
                }
            });
        }
        
        // Handle Login
        function handleLogin() {
            const email = document.getElementById('emailInput').value;
            const name = document.getElementById('nameInput').value;
            
            if (!email || !name) {
                alert('Please fill in all fields');
                return;
            }
            
            // Check if it's a predefined user
            let userData;
            if (predefinedUsers[email]) {
                userData = { ...predefinedUsers[email] };
            } else {
                userData = {
                    uid: 'user_' + Date.now(),
                    name: name,
                    email: email,
                    profilePic: null,
                    status: 'Online',
                    country: userCountry,
                    countryCode: getCountryCode(userCountry),
                    verified: false,
                    premium: false,
                    accountType: 'personal',
                    bio: '',
                    lastSeen: Date.now()
                };
            }
            
            currentUser = userData;
            localStorage.setItem('pulseUser', JSON.stringify(userData));
            
            document.getElementById('loginModal').classList.add('hidden');
            initializeApp(userData);
        }
        
        // Initialize App
        function initializeApp(user) {
            currentUser = user;
            document.getElementById('welcomeScreen').classList.add('hidden');
            loadChats();
            
            // Send welcome message from Pulse official
            if (user.email !== 'official@pulse.com') {
                setTimeout(() => {
                    sendWelcomeMessage();
                }, 1000);
            }
        }
        
        // Send Welcome Message
        function sendWelcomeMessage() {
            const welcomeMessages = [
                `Welcome to Pulse, ${currentUser.name}! 🎉`,
                "Discover amazing new features and connect with friends like never before!",
                "🔥 New Update: Voice messages, stories, and premium features are now available!",
                "💎 Upgrade to Pulse Premium for exclusive features and verified badge!"
            ];
            
            welcomeMessages.forEach((msg, index) => {
                setTimeout(() => {
                    addMessageToChat('pulse_official', {
                        id: 'welcome_' + index,
                        sender: 'pulse_official',
                        text: msg,
                        timestamp: Date.now(),
                        type: 'text'
                    });
                }, index * 2000);
            });
        }
        
        // Load Predefined Chats
        function loadPredefinedChats() {
            const chatListElement = document.getElementById('chatList');
            if (!chatListElement) return;
            
            Object.values(predefinedUsers).forEach(user => {
                if (user.uid !== currentUser?.uid) {
                    const chatElement = createChatElement(user);
                    chatListElement.appendChild(chatElement);
                }
            });
        }
        
        // Load Chats
        function loadChats() {
            const chatListElement = document.getElementById('chatList');
            if (!chatListElement) return;
            
            chatListElement.innerHTML = '';
            
            // Add Pulse official chat
            if (currentUser.email !== 'official@pulse.com') {
                const pulseChat = createChatElement(predefinedUsers.pulse_official);
                chatListElement.appendChild(pulseChat);
            }
            
            // Add other users
            Object.values(predefinedUsers).forEach(user => {
                if (user.uid !== currentUser.uid && user.uid !== 'pulse_official') {
                    const chatElement = createChatElement(user);
                    chatListElement.appendChild(chatElement);
                }
            });
        }
        
        // Create Chat Element
        function createChatElement(user) {
            const div = document.createElement('div');
            div.className = 'flex items-center p-3 rounded-xl hover:bg-gray-800 cursor-pointer transition-colors border-l-4 border-transparent hover:border-blue-500';
            div.onclick = () => openChat(user);
            
            const profileClass = user.isOfficial ? 'pulse-official' : 
                                user.isPremium ? 'premium-gradient' : 
                                'bg-gradient-to-r from-blue-500 to-purple-600';
            
            div.innerHTML = `
                <div class="relative">
                    <div class="w-12 h-12 rounded-full ${profileClass} flex items-center justify-center text-white font-bold">
                        ${user.profilePic ? `<img src="${user.profilePic}" class="w-full h-full rounded-full object-cover">` : user.name.charAt(0)}
                    </div>
                    <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-900"></div>
                </div>
                <div class="flex-1 ml-3">
                    <div class="flex items-center">
                        <span class="font-medium">${user.name}</span>
                        ${user.verified ? '<div class="verified-badge"><i class="fas fa-check"></i></div>' : ''}
                        ${user.premium ? '<div class="premium-badge"><i class="fas fa-crown"></i></div>' : ''}
                    </div>
                    <div class="flex items-center text-sm text-gray-400">
                        <img src="https://flagcdn.com/w20/${user.countryCode.toLowerCase()}.png" class="country-flag" alt="${user.country}">
                        <span>${user.country}</span>
                    </div>
                    <div class="text-sm text-gray-400 truncate">${user.bio || 'Available'}</div>
                </div>
            `;
            
            return div;
        }
        
        // Open Chat
        function openChat(user) {
            currentChat = user;
            document.getElementById('chatInterface').classList.remove('hidden');
            
            // Update chat header
            const chatHeader = document.getElementById('chatHeader');
            const profileClass = user.isOfficial ? 'pulse-official' : 
                                user.isPremium ? 'premium-gradient' : 
                                'bg-gradient-to-r from-blue-500 to-purple-600';
            
            chatHeader.innerHTML = `
                <div class="w-10 h-10 rounded-full ${profileClass} flex items-center justify-center text-white font-bold">
                    ${user.profilePic ? `<img src="${user.profilePic}" class="w-full h-full rounded-full object-cover">` : user.name.charAt(0)}
                </div>
                <div>
                    <div class="flex items-center">
                        <span class="font-medium">${user.name}</span>
                        ${user.verified ? '<div class="verified-badge"><i class="fas fa-check"></i></div>' : ''}
                        ${user.premium ? '<div class="premium-badge"><i class="fas fa-crown"></i></div>' : ''}
                    </div>
                    <div class="flex items-center text-sm text-gray-400">
                        <img src="https://flagcdn.com/w20/${user.countryCode.toLowerCase()}.png" class="country-flag" alt="${user.country}">
                        <span>${user.status}</span>
                    </div>
                </div>
            `;
            
            loadMessages(user.uid);
        }
        
        // Load Messages
        function loadMessages(chatId) {
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.innerHTML = '';
            
            // Load existing messages from localStorage
            const messages = JSON.parse(localStorage.getItem(`chat_${chatId}`) || '[]');
            messages.forEach(message => {
                const messageElement = createMessageElement(message);
                messagesArea.appendChild(messageElement);
            });
            
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }
        
        // Create Message Element
        function createMessageElement(message) {
            const div = document.createElement('div');
            div.className = `flex ${message.sender === currentUser?.uid ? 'justify-end' : 'justify-start'} message-animation`;
            
            const isOwn = message.sender === currentUser?.uid;
            const bubble = document.createElement('div');
            bubble.className = `max-w-xs lg:max-w-md px-4 py-2 rounded-2xl relative group cursor-pointer ${
                isOwn 
                    ? 'bg-blue-600 text-white rounded-br-md' 
                    : 'bg-gray-800 text-white rounded-bl-md'
            }`;
            
            // Add long press for reactions
            let pressTimer;
            bubble.addEventListener('mousedown', () => {
                pressTimer = setTimeout(() => showReactionPopup(bubble), 500);
            });
            bubble.addEventListener('mouseup', () => clearTimeout(pressTimer));
            bubble.addEventListener('mouseleave', () => clearTimeout(pressTimer));
            
            let content = '';
            
            if (message.type === 'voice') {
                content = `
                    <div class="voice-player">
                        <div class="play-btn" onclick="playVoiceMessage('${message.id}')">
                            <i class="fas fa-play text-sm"></i>
                        </div>
                        <div class="wave-animation">
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                        </div>
                        <span class="text-xs">0:${message.duration || '05'}</span>
                    </div>
                `;
            } else if (message.type === 'image') {
                content = `<img src="${message.content}" class="max-w-full rounded-lg mb-2">`;
            } else {
                content = `<div class="text-sm">${message.text}</div>`;
            }
            
            bubble.innerHTML = `
                ${content}
                <div class="flex items-center justify-end mt-1 space-x-1">
                    <span class="text-xs opacity-70">${formatTime(message.timestamp)}</span>
                    ${isOwn ? `<i class="fas fa-check-double text-xs text-blue-300"></i>` : ''}
                </div>
                ${message.reactions ? `
                    <div class="flex space-x-1 mt-1">
                        ${Object.entries(message.reactions).map(([emoji, count]) => 
                            `<span class="text-xs bg-gray-700 rounded-full px-2 py-1">${emoji} ${count}</span>`
                        ).join('')}
                    </div>
                ` : ''}
            `;
            
            div.appendChild(bubble);
            return div;
        }
        
        // Show Reaction Popup
        function showReactionPopup(messageElement) {
            const popup = document.createElement('div');
            popup.className = 'reaction-popup show';
            popup.innerHTML = `
                <span class="reaction-btn" onclick="addReaction('😂')">😂</span>
                <span class="reaction-btn" onclick="addReaction('❤️')">❤️</span>
                <span class="reaction-btn" onclick="addReaction('😡')">😡</span>
                <span class="reaction-btn" onclick="addReaction('🥺')">🥺</span>
                <span class="reaction-btn" onclick="addReaction('😭')">😭</span>
                <span class="reaction-btn" onclick="addReaction('😎')">😎</span>
                <span class="reaction-btn" onclick="addReaction('🔥')">🔥</span>
            `;
            
            messageElement.appendChild(popup);
            
            setTimeout(() => {
                popup.remove();
            }, 3000);
        }
        
        // Add Reaction
        function addReaction(emoji) {
            // Implementation for adding reactions
            console.log('Added reaction:', emoji);
        }
        
        // Send Message
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentChat) return;
            
            const message = {
                id: 'msg_' + Date.now(),
                sender: currentUser.uid,
                text: text,
                timestamp: Date.now(),
                type: 'text'
            };
            
            addMessageToChat(currentChat.uid, message);
            input.value = '';
            
            // Auto-reply from Pulse official
            if (currentChat.uid === 'pulse_official') {
                setTimeout(() => {
                    const reply = {
                        id: 'reply_' + Date.now(),
                        sender: 'pulse_official',
                        text: getPulseReply(text),
                        timestamp: Date.now(),
                        type: 'text'
                    };
                    addMessageToChat('pulse_official', reply);
                }, 1500);
            }
        }
        
        // Get Pulse Reply
        function getPulseReply(userMessage) {
            const replies = [
                "Thanks for your message! 🚀",
                "We're constantly improving Pulse for you! ✨",
                "Have you tried our new premium features? 💎",
                "Your feedback helps us make Pulse better! 🙏",
                "Stay tuned for exciting updates! 🔥"
            ];
            
            if (userMessage.toLowerCase().includes('premium')) {
                return "Upgrade to Pulse Premium for exclusive features! Only $130 for advanced capabilities. 👑";
            }
            
            return replies[Math.floor(Math.random() * replies.length)];
        }
        
        // Add Message to Chat
        function addMessageToChat(chatId, message) {
            const messages = JSON.parse(localStorage.getItem(`chat_${chatId}`) || '[]');
            messages.push(message);
            localStorage.setItem(`chat_${chatId}`, JSON.stringify(messages));
            
            if (currentChat && currentChat.uid === chatId) {
                const messageElement = createMessageElement(message);
                document.getElementById('messagesArea').appendChild(messageElement);
                document.getElementById('messagesArea').scrollTop = document.getElementById('messagesArea').scrollHeight;
            }
        }
        
        // Toggle Voice Recording
        function toggleVoiceRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }
        
        // Start Recording
        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    const audioChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const message = {
                                id: 'voice_' + Date.now(),
                                sender: currentUser.uid,
                                content: e.target.result,
                                timestamp: Date.now(),
                                type: 'voice',
                                duration: '05'
                            };
                            addMessageToChat(currentChat.uid, message);
                        };
                        reader.readAsDataURL(audioBlob);
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    document.getElementById('voiceBtn').innerHTML = '<i class="fas fa-stop text-sm text-red-400"></i>';
                    
                    // Auto-stop after 60 seconds
                    setTimeout(() => {
                        if (isRecording) stopRecording();
                    }, 60000);
                })
                .catch(err => {
                    alert('Could not access microphone');
                });
        }
        
        // Stop Recording
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('voiceBtn').innerHTML = '<i class="fas fa-microphone text-sm"></i>';
            }
        }
        
        // Play Voice Message
        function playVoiceMessage(messageId) {
            // Implementation for playing voice messages
            console.log('Playing voice message:', messageId);
        }
        
        // Handle File Upload
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const message = {
                        id: 'img_' + Date.now(),
                        sender: currentUser.uid,
                        content: e.target.result,
                        timestamp: Date.now(),
                        type: 'image'
                    };
                    addMessageToChat(currentChat.uid, message);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Switch View
        function switchView(view) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            // Hide all views
            document.querySelectorAll('#viewContainer > div').forEach(div => {
                div.classList.add('hidden');
            });
            
            // Show selected view
            currentView = view;
            
            switch(view) {
                case 'home':
                    document.getElementById('homeView').classList.remove('hidden');
                    break;
                case 'stories':
                    document.getElementById('storiesView').classList.remove('hidden');
                    loadStories();
                    break;
                case 'profile':
                    document.getElementById('profileView').classList.remove('hidden');
                    loadProfile();
                    break;
                case 'settings':
                    document.getElementById('settingsView').classList.remove('hidden');
                    loadSettings();
                    break;
            }
        }
        
        // Load Stories
        function loadStories() {
            const storiesGrid = document.getElementById('storiesGrid');
            storiesGrid.innerHTML = `
                <div class="bg-gray-800 rounded-xl p-4 cursor-pointer hover:bg-gray-700 transition-colors">
                    <div class="story-ring mb-3">
                        <div class="story-inner">
                            <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-plus text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="text-sm font-medium">Add Story</div>
                </div>
            `;
            
            // Add sample stories
            Object.values(predefinedUsers).forEach(user => {
                if (user.uid !== currentUser?.uid) {
                    const storyElement = document.createElement('div');
                    storyElement.className = 'bg-gray-800 rounded-xl p-4 cursor-pointer hover:bg-gray-700 transition-colors';
                    storyElement.onclick = () => viewStory(user);
                    
                    const profileClass = user.isOfficial ? 'pulse-official' : 
                                        user.isPremium ? 'premium-gradient' : 
                                        'bg-gradient-to-r from-blue-500 to-purple-600';
                    
                    storyElement.innerHTML = `
                        <div class="story-ring mb-3">
                            <div class="story-inner">
                                <div class="w-16 h-16 ${profileClass} rounded-full flex items-center justify-center text-white font-bold">
                                    ${user.name.charAt(0)}
                                </div>
                            </div>
                        </div>
                        <div class="text-sm font-medium">${user.name}</div>
                        <div class="text-xs text-gray-400">2h ago</div>
                    `;
                    
                    storiesGrid.appendChild(storyElement);
                }
            });
        }
        
        // View Story
        function viewStory(user) {
            document.getElementById('storyViewer').style.display = 'block';
            document.getElementById('storyUserName').textContent = user.name;
            document.getElementById('storyTime').textContent = '2 hours ago';
            
            // Sample story content
            document.getElementById('storyContent').innerHTML = `
                <div class="bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl p-8 text-center text-white">
                    <h3 class="text-2xl font-bold mb-4">Welcome to Pulse!</h3>
                    <p>Experience the future of communication</p>
                </div>
            `;
            
            // Story viewers
            document.getElementById('storyViewers').innerHTML = `
                <div class="text-sm">👁️ Viewed by 127 people</div>
                <div class="text-xs text-gray-400">❤️ 45 likes</div>
            `;
            
            // Auto-close after 5 seconds
            setTimeout(() => {
                document.getElementById('storyViewer').style.display = 'none';
            }, 5000);
        }
        
        // Load Profile
        function loadProfile() {
            if (!currentUser) return;
            
            const profileContent = document.getElementById('profileContent');
            const profileClass = currentUser.isOfficial ? 'pulse-official' : 
                                currentUser.isPremium ? 'premium-gradient' : 
                                'bg-gradient-to-r from-blue-500 to-purple-600';
            
            profileContent.innerHTML = `
                <div class="relative">
                    <div class="h-48 bg-gradient-to-r from-blue-600 to-purple-700"></div>
                    <div class="absolute -bottom-16 left-6">
                        <div class="w-32 h-32 ${profileClass} rounded-full border-4 border-gray-900 flex items-center justify-center text-white text-4xl font-bold">
                            ${currentUser.profilePic ? `<img src="${currentUser.profilePic}" class="w-full h-full rounded-full object-cover">` : currentUser.name.charAt(0)}
                        </div>
                    </div>
                </div>
                
                <div class="pt-20 p-6">
                    <div class="flex items-center mb-2">
                        <h1 class="text-2xl font-bold">${currentUser.name}</h1>
                        ${currentUser.verified ? '<div class="verified-badge ml-2"><i class="fas fa-check"></i></div>' : ''}
                        ${currentUser.premium ? '<div class="premium-badge ml-2"><i class="fas fa-crown"></i></div>' : ''}
                    </div>
                    
                    ${currentUser.company ? `
                        <div class="text-blue-400 font-medium mb-2">${currentUser.company}</div>
                    ` : ''}
                    
                    <div class="flex items-center text-gray-400 mb-4">
                        <img src="https://flagcdn.com/w20/${currentUser.countryCode.toLowerCase()}.png" class="country-flag" alt="${currentUser.country}">
                        <span>${currentUser.country}</span>
                    </div>
                    
                    <p class="text-gray-300 mb-6">${currentUser.bio || 'No bio available'}</p>
                    
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="text-center">
                            <div class="text-2xl font-bold">127</div>
                            <div class="text-sm text-gray-400">Followers</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold">89</div>
                            <div class="text-sm text-gray-400">Following</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold">45</div>
                            <div class="text-sm text-gray-400">Posts</div>
                        </div>
                    </div>
                    
                    ${!currentUser.premium && currentUser.email === 'sgursharn076@gmail.com' ? `
                        <button onclick="showPremiumModal()" class="w-full premium-gradient text-white py-3 px-4 rounded-xl font-medium mb-4">
                            <i class="fas fa-crown mr-2"></i>Upgrade to Premium - $130
                        </button>
                    ` : ''}
                    
                    <div class="space-y-3">
                        <button class="w-full bg-gray-800 hover:bg-gray-700 py-3 px-4 rounded-xl text-left transition-colors">
                            <i class="fas fa-edit mr-3"></i>Edit Profile
                        </button>
                        <button class="w-full bg-gray-800 hover:bg-gray-700 py-3 px-4 rounded-xl text-left transition-colors">
                            <i class="fas fa-share mr-3"></i>Share Profile
                        </button>
                        <button onclick="logout()" class="w-full bg-red-600 hover:bg-red-700 py-3 px-4 rounded-xl text-left transition-colors">
                            <i class="fas fa-sign-out-alt mr-3"></i>Logout
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Load Settings
        function loadSettings() {
            const settingsContent = document.getElementById('settingsContent');
            settingsContent.innerHTML = `
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-blue-400">Account</h3>
                        <div class="space-y-3">
                            <button class="w-full text-left p-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition-colors">
                                <i class="fas fa-user mr-3"></i>Profile Settings
                            </button>
                            <button class="w-full text-left p-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition-colors">
                                <i class="fas fa-lock mr-3"></i>Privacy & Security
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-blue-400">Premium</h3>
                        <div class="space-y-3">
                            ${currentUser?.email === 'sgursharn076@gmail.com' && !currentUser.premium ? `
                                <button onclick="showPremiumModal()" class="w-full text-left p-3 rounded-xl premium-gradient text-white transition-colors">
                                    <i class="fas fa-crown mr-3"></i>Upgrade to Premium - $130
                                </button>
                            ` : currentUser?.premium ? `
                                <div class="p-3 rounded-xl bg-gradient-to-r from-yellow-600 to-yellow-500 text-black">
                                    <i class="fas fa-crown mr-3"></i>Premium Active
                                </div>
                            ` : `
                                <div class="p-3 rounded-xl bg-gray-800 text-gray-400">
                                    <i class="fas fa-crown mr-3"></i>Premium not available
                                </div>
                            `}
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-blue-400">App</h3>
                        <div class="space-y-3">
                            <button class="w-full text-left p-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition-colors">
                                <i class="fas fa-bell mr-3"></i>Notifications
                            </button>
                            <button class="w-full text-left p-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition-colors">
                                <i class="fas fa-palette mr-3"></i>Appearance
                            </button>
                            <button class="w-full text-left p-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition-colors">
                                <i class="fas fa-info-circle mr-3"></i>About Pulse
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Show Premium Modal
        function showPremiumModal() {
            document.getElementById('premiumModal').classList.remove('hidden');
        }
        
        // Logout
        function logout() {
            localStorage.removeItem('pulseUser');
            currentUser = null;
            currentChat = null;
            location.reload();
        }
        
        // Utility Functions
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }
        
        function getCountryCode(country) {
            const countryCodes = {
                'United States': 'US',
                'India': 'IN',
                'United Kingdom': 'GB',
                'Canada': 'CA',
                'Australia': 'AU',
                'Germany': 'DE',
                'France': 'FR',
                'Japan': 'JP',
                'Brazil': 'BR',
                'Mexico': 'MX'
            };
            return countryCodes[country] || 'UN';
        }
        
        // Close story viewer
        document.getElementById('closeStory').addEventListener('click', () => {
            document.getElementById('storyViewer').style.display = 'none';
        });
        
        // Premium upgrade
        document.getElementById('upgradePremium').addEventListener('click', () => {
            if (currentUser?.email === 'sgursharn076@gmail.com') {
                currentUser.premium = true;
                localStorage.setItem('pulseUser', JSON.stringify(currentUser));
                document.getElementById('premiumModal').classList.add('hidden');
                alert('Premium activated! 🎉');
                loadProfile();
                loadSettings();
            } else {
                alert('Premium is only available for eligible users.');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9717f365650b54a4',t:'MTc1NTU4ODY4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
