<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Oriontec Verification Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    h1, h2 { color: #1a73e8; }
    input, select, textarea { width: 100%; padding: 10px; margin: 8px 0 16px; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #1a73e8; color: #fff; padding: 12px 18px; border: none; border-radius: 5px; cursor: pointer; }
    .hidden { display: none; }
    .success-message, .error-message {
      padding: 1rem; margin-top: 1rem; border-radius: 5px;
    }
    .success-message { background: #e6f4ea; color: #0c6b2c; border: 1px solid #34a853; }
    .error-message { background: #fce8e6; color: #b00020; border: 1px solid #ea4335; }
  </style>
</head>
<body>

<div class="container" id="authSection">
  <h1>Email Sign-In</h1>
  <p>Please enter your email and password to begin the verification process.</p>
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />
  <button onclick="register()">Register & Verify Email</button>
  <div id="authMessage" class="success-message hidden"></div>
</div>

<div class="container hidden" id="formSection">
  <h2>Verification Form</h2>
  <label>Full Name:</label>
  <input type="text" id="name" required>

  <label>Date of Birth:</label>
  <input type="date" id="dob" required>

  <label>Country:</label>
  <select id="country">
    <option value="">Select Country</option>
    <option>India</option>
    <option>United States</option>
    <option>Canada</option>
    <option>United Kingdom</option>
    <option>Australia</option>
    <option>Other</option>
  </select>

  <label>National ID Type:</label>
  <select id="idType">
    <option value="">Choose one</option>
    <option>Passport</option>
    <option>Driver's License</option>
    <option>Other</option>
  </select>

  <label>Upload ID Image:</label>
  <input type="file" id="idImage" accept="image/*">

  <label>Article URL proving Notability:</label>
  <input type="url" id="articleUrl">

  <label>Why do you want to get verified?</label>
  <textarea id="reason" rows="4" placeholder="Write your reason here..."></textarea>

  <button onclick="submitForm()">Submit Form</button>
  <div id="formMsg" class="success-message hidden"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAl8eI-_8Ew9va0KPV8p4D2hc9WUTGiwuI",
    authDomain: "chat-d647c.firebaseapp.com",
    databaseURL: "https://chat-d647c-default-rtdb.firebaseio.com",
    projectId: "chat-d647c",
    storageBucket: "chat-d647c.appspot.com",
    messagingSenderId: "1001806177737",
    appId: "1:1001806177737:web:7248a0983dcf0d45a87418"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  function register() {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();

    if (!email || !password) {
      alert("Please fill out both email and password.");
      return;
    }

    auth.createUserWithEmailAndPassword(email, password)
      .then(userCredential => {
        userCredential.user.sendEmailVerification().then(() => {
          document.getElementById('authMessage').innerText = "Verification email sent. Please verify and refresh the page.";
          document.getElementById('authMessage').classList.remove("hidden");
        });
      })
      .catch(error => {
        if (error.code === 'auth/email-already-in-use') {
          auth.signInWithEmailAndPassword(email, password)
            .then(userCredential => {
              if (userCredential.user.emailVerified) {
                document.getElementById('authSection').classList.add("hidden");
                document.getElementById('formSection').classList.remove("hidden");
              } else {
                alert("Please verify your email before proceeding.");
              }
            });
        } else {
          alert("Error: " + error.message);
        }
      });
  }

  async function submitForm() {
    const name = document.getElementById('name').value;
    const dob = document.getElementById('dob').value;
    const country = document.getElementById('country').value;
    const idType = document.getElementById('idType').value;
    const articleUrl = document.getElementById('articleUrl').value;
    const reason = document.getElementById('reason').value;
    const file = document.getElementById('idImage').files[0];

    if (!name || !dob || !country || !idType || !file || !articleUrl || !reason) {
      alert("Please fill out all fields and upload an ID image.");
      return;
    }

    const allowedTypes = ['image/png', 'image/jpeg'];
    if (!allowedTypes.includes(file.type)) {
      alert("Please upload a valid PNG or JPEG image.");
      return;
    }

    const storageRef = storage.ref("verifications/" + file.name);
    await storageRef.put(file);
    const fileUrl = await storageRef.getDownloadURL();

    await db.collection("verifications").add({
      email: auth.currentUser.email,
      name, dob, country, idType, articleUrl, reason,
      idImageUrl: fileUrl,
      status: "pending", // For admin to update later
      submittedAt: new Date().toISOString()
    });

    document.getElementById('formMsg').innerText = "Thanks! Your application has been submitted and will be reviewed within 48 hours.";
    document.getElementById('formMsg').classList.remove("hidden");
  }
</script>

</body>
</html>
