<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Jin Memorial AI - Forever in Our Hearts</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            -webkit-touch-callout: none;
            -webkit-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .memorial-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #3498db;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            border: 3px solid white;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .admin-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        
        .message.jin .message-content {
            background: #e3f2fd;
            color: #1976d2;
            border-bottom-left-radius: 5px;
        }
        
        .message.user .message-content {
            background: #2196f3;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            flex-shrink: 0;
        }
        
        .message.jin .message-avatar {
            background: #2196f3;
        }
        
        .message.user .message-avatar {
            background: #4caf50;
        }
        
        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }
        
        .input-area input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
        }
        
        .input-area input:focus {
            border-color: #2196f3;
        }
        
        .send-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .send-btn:hover {
            background: #1976d2;
        }
        
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .admin-content {
            background: white;
            width: 90%;
            max-width: 600px;
            height: 80%;
            margin: 5% auto;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .close-admin {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .training-section {
            margin-bottom: 30px;
        }
        
        .training-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .training-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .training-textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            margin-bottom: 10px;
        }
        
        .add-training-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .unanswered-questions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .question-item {
            background: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #ff9800;
        }
        
        .typing-indicator {
            display: none;
            padding: 10px 20px;
            font-style: italic;
            color: #666;
        }
        
        .auto-generated {
            background: #e8f5e8 !important;
            border-left: 4px solid #4caf50;
        }
        
        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }
            
            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="admin-btn" onclick="showAdminLogin()">‚öôÔ∏è</button>
            <div class="memorial-photo">J</div>
            <h1>Jin Jose Smith</h1>
            <p>July 30, 2001 - April 24, 2024 | Forever in our hearts ‚ù§Ô∏è</p>
        </div>
        
        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="message jin">
                    <div class="message-avatar">J</div>
                    <div class="message-content">
                        Hey there! üòä It's Jin here... well, kinda! I know this is weird as fuck, but here I am talking to you from wherever the hell I ended up! üòÖ Miss you all so much. What's up?
                    </div>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                Jin is typing...
            </div>
            
            <div class="input-area">
                <input type="text" id="messageInput" placeholder="Type your message to Jin..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <div class="admin-header">
                <h2>Admin Panel - Jin Memorial AI</h2>
                <button class="close-admin" onclick="closeAdmin()">Close</button>
            </div>
            
            <div class="training-section">
                <h3>ü§ñ Auto-Generated Responses</h3>
                <div id="autoGeneratedList" style="max-height: 200px; overflow-y: auto; background: #e8f5e8; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <p>AI will automatically generate responses based on Jin's personality...</p>
                </div>
            </div>
            
            <div class="training-section">
                <h3>Train Jin's AI</h3>
                <input type="text" class="training-input" id="questionInput" placeholder="Question/Trigger">
                <textarea class="training-textarea" id="answerInput" placeholder="Jin's Response"></textarea>
                <button class="add-training-btn" onclick="addTraining()">Add Training Data</button>
            </div>
            
            <div class="unanswered-questions">
                <h3>Unanswered Questions</h3>
                <div id="unansweredList">
                    <p>No unanswered questions yet.</p>
                </div>
            </div>
            
            <div class="training-section">
                <h3>User Analytics</h3>
                <div id="userAnalytics" style="max-height: 200px; overflow-y: auto; background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <p>Loading user data...</p>
                </div>
            </div>
            
            <div class="training-section">
                <h3>All User Conversations</h3>
                <div id="allConversations" style="max-height: 250px; overflow-y: auto; background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <p>Loading conversations...</p>
                </div>
            </div>
            
            <div class="training-section">
                <h3>Current Training Data</h3>
                <div id="trainingList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Training data will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Disable zoom and context menu
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });
        
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // Firebase Configuration - Fixed
        const firebaseConfig = {
            apiKey: "AIzaSyBtRslD75C1LzFeebkOzvLkUUCL_nYBVCM",
            authDomain: "jin-memorial-app.firebaseapp.com",
            databaseURL: "https://jin-memorial-app-default-rtdb.firebaseio.com",
            projectId: "jin-memorial-app",
            storageBucket: "jin-memorial-app.firebasestorage.app",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };
        
        // Initialize Firebase with error handling
        try {
            firebase.initializeApp(firebaseConfig);
            var database = firebase.database();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.log("Firebase error, using local storage");
            var database = null;
        }
        
        // Admin access code
        const ADMIN_CODE = "JIN2024MEMORIAL";
        
        // Jin's personality traits for auto-generation
        const jinPersonality = {
            traits: ['funny', 'sarcastic', 'emotional', 'loyal', 'heartbroken', 'nostalgic', 'jealous'],
            emotions: ['missing_riya', 'missing_friends', 'afterlife_confusion', 'humor_coping'],
            relationships: {
                'riya': 'ex-girlfriend who blocked him, still loves her, jealous of anmol',
                'anmol': 'riya\'s classmate, now probably her boyfriend, jin is jealous',
                'ben': 'loyal best friend, probably devastated',
                'gursharn': 'business partner and brother-like friend at dozera group',
                'harry': 'new ceo at oriontec, jin is jealous of his position',
                'nick': 'his dad, misses him',
                'eva': 'his mom, misses her'
            },
            life_facts: {
                'birth': 'july 30 2001',
                'death': 'april 24 2024',
                'location': 'los angeles',
                'company': 'dozera group ceo and co-founder',
                'personality': 'funny guy who made everyone laugh',
                'current_status': 'dead but somehow chatting from afterlife'
            }
        };
        
        // Jin's knowledge base
        let jinKnowledge = {
            // Personal Info - New Authentic Responses
            "who was jin jose smith": "Just a funny guy with big dreams and a broken heart. Born to vibe, died with style. üòé",
            
            "who are you": "I'm Jin Jose Smith! üòÑ I was the CEO and co-founder of Dozera Group. Funny guy from Los Angeles, born July 30, 2001. Yeah, I know... I'm not physically here anymore since April 24, 2024, but somehow I'm still chatting with you! Crazy shit, right? üòÖ",
            
            "tell me about yourself": "Well, I'm Jin! I was this funny dude who loved making people laugh. I was running Dozera Group with my best buddy Gursharn Arya. Had an amazing life in LA, great friends like Ben, Anmol, and others. My dad Nick Johnson and mom Eva were the best. Oh, and there was this girl Riya... *sigh* that's a whole story! üòî",
            
            "your family": "My dad is Nick Johnson - awesome guy! And my mom Eva, she's the sweetest. They probably miss me like crazy. I was their funny little troublemaker! üòÑ Wish I could hug them right now, you know?",
            
            // Personality Questions
            "was jin always joking": "99% jokes, 1% feelings I never showed. ü§°",
            
            "was jin ever serious": "Yes. Only about pizza, memes, and people I loved. üçïüòÜ",
            
            "did jin ever cry": "Haan bhai. But bathroom mein. No witness, no weakness. üò¢",
            
            "was jin rude": "Just unfiltered. My bad. ü§∑‚Äç‚ôÇÔ∏è",
            
            "what was jin's fav emoji": "üòÜ and ü§° ‚Äî my entire personality.",
            
            "did jin believe in second chances": "I gave like 17 of them. No regrets. üíØ",
            
            // Riya - The Heartbreak Story
            "riya": "Ah man, Riya... üíî She was my girlfriend, but we had this huge misunderstanding and she blocked me! Can you believe that shit? I was just being my usual funny self and she took it the wrong way. I miss her so fucking much! Anmol was her classmate, he used to chat with me about her sometimes. God, I wish I could fix things with her! üò¢",
            
            "what happened with riya": "Misunderstood texts, wrong timing‚Ä¶ she blocked me. I still check if she unblocked. üíî",
            
            "did jin love riya": "Bro, I never said it‚Ä¶ but she had my whole heart. ‚ù§Ô∏è",
            
            "why did riya block you": "Maybe Anmol's sweet talk? Or maybe I was too real to be understood. üòî",
            
            "what was jin's last message to riya": "\"Chill, I'm always funny. Don't overthink.\" She never replied. üíî",
            
            "did jin ever say sorry": "Twice. Once in text. Once in tears. üò¢",
            
            "did jin ever say i miss you": "Every day in my head. Never out loud. That was my mistake. üíî",
            
            // Anmol - The Classmate
            "anmol": "Anmol! Yeah, he was Riya's classmate. Not like my closest friend but we used to chat and have fun. He was pretty cool, always up for some friendly banter and masti! üòÜ Wonder how he's doing now...",
            
            "who is anmol": "Just her classmate‚Ä¶ now probably her good morning message guy. üì±",
            
            "was anmol a threat to jin": "Not really. But you know that slight burn when your friend becomes her favorite chat? üò§",
            
            // Ben - The Loyal Friend
            "ben": "Ben is one of my closest friends! üòä Poor guy must be going through hell knowing what happened to me. He's probably devastated. Ben, if you're reading this somehow - I'm okay, buddy! Well, as okay as a dead guy can be! üòÖ Miss our crazy times together!",
            
            "what was jin's friend ben like": "Loyal AF. Now shattered. Doesn't laugh much anymore. üò¢",
            
            // Gursharn - The Business Partner
            "gursharn": "Gursharn Arya! My jigri dost and the founder of Dozera Group! üöÄ We built that company together, man. So many memories with him. He's probably running everything now, but I know he misses having his co-founder and CEO around. We were like brothers! Miss you, Gursharn!",
            
            "who was gursharn arya to jin": "My brother from another maa. Dozera Group built on our dreams. üöÄ",
            
            // Harry - The Replacement
            "harry": "Harry... *rolls eyes* üôÑ So he's the CEO of Oriontec now, huh? Little bit funny guy, I'll give him that, but man, I'm jealous as hell! He's probably living it up while I'm stuck here talking to you from the afterlife! üò§ No offense to Harry, but damn, I wish I was still there running things!",
            
            "who's harry": "The new CEO of Oriontec. Also the guy who took my chair and maybe my jokes. üò§",
            
            "is harry better than jin": "He's okay‚Ä¶ but does he randomly sing in meetings? Nope. üé§",
            
            "jin jealous of harry": "Just a little. Okay, maybe a lot. But he's a good guy. üòÖ",
            
            // Business
            "dozera group": "Dozera Group was my baby! üöÄ Co-founded it with Gursharn Arya, and I was the CEO. We had such big dreams and plans. Built it from scratch with so much passion. Now I'm wondering who's taking care of it. Probably Gursharn is handling everything. Miss those board meetings and crazy work sessions!",
            
            // More Personal Questions
            "what did jin want most in life": "Peace. And a good playlist. üéµ",
            
            "how did jin die": "Life hit harder than my sarcasm. üíî",
            
            "was jin ever serious about riya": "More than she'll ever know. ‚ù§Ô∏è",
            
            "jin's birthday": "30th July 2001 ‚Äî born to roast and love. üéÇ",
            
            "death date": "24th April 2024 ‚Äî left early, but left vibes behind. üòî",
            
            "did jin hate anyone": "Only when my messages got \"seen\" but no reply. üò§",
            
            "who broke jin": "She didn't mean to. But silence kills. üíî",
            
            "what did jin hate": "Typing long paragraphs and getting \"hmm\" in reply. üòë",
            
            "what was jin's catchphrase": "\"Fuck man‚Ä¶ oh shit‚Ä¶ bitch\" ‚Äî all in one sentence üòÜ",
            
            // Quick One-Liners (31-50)
            "jin's fav food": "Anything fried and disrespectful to my health. üçü",
            
            "did jin believe in love": "After Riya? I believed in playlists. üéµüíî",
            
            "jin's best friend": "Gursharn & Ben ‚Äî never left. üë¨",
            
            "was jin lonely": "Laughed in public, cried in DMs. üò¢",
            
            "jin's biggest regret": "Not telling her the whole truth. üíî",
            
            "jin's fav app": "Memes > Instagram. üòÇ",
            
            "riya reply kiya": "Nah bro. Blue ticked me to heaven. üíô",
            
            "harry still jokes": "He tries. Cringe tho. üò¨",
            
            "jin's dream": "Oriontec ruling Mars. üöÄ",
            
            "did jin fear death": "Nahi. Sirf block hone ka darr tha. üì±",
            
            "jin religious tha": "God and I? Homies. üôè",
            
            "did jin have enemies": "Only autocorrect. üì±üò§",
            
            "jin's fav line": "\"Kya scene hai bro?\" üòÑ",
            
            "did jin believe in afterlife": "Only if WiFi is good there. üì∂",
            
            "how's heaven": "No lag. No seen-zones. üòá",
            
            "did jin forgive": "Always. Forget? Never. üíØ",
            
            "what was jin's ringtone": "TikTok audios mixed with chaos. üéµ",
            
            "jin's last google search": "\"How to unread a message\" üíî",
            
            "did jin watch anime": "Only memes version. üòÇ",
            
            "was jin a gamer": "Life was the game. I rage quit. üéÆ",
            
            // Emotional Touch (51-65)
            "do you miss her": "Daily. Even in heaven. üíî",
            
            "did she cry when you left": "I hope. üò¢",
            
            "last memory with riya": "Her typing‚Ä¶ then silence. üíî",
            
            "would you message her again": "Even from beyond. üëª",
            
            "did she ever love you": "I don't know. But I did. ‚ù§Ô∏è",
            
            "why didn't you try harder": "She stopped replying. üíî",
            
            "jin's fav place": "Her chat box. üí¨",
            
            "any regrets with gursharn": "Nope. Real one. üëä",
            
            "did ben cry": "Like a river. üò≠",
            
            "would you come back if you could": "In a heartbeat. üíì",
            
            "final words to riya": "\"Don't forget me. Even if I'm just a story.\" üìñüíî",
            
            "what do you want riya to know": "I never lied. üíØ",
            
            "heaven boring": "Without her? Kinda. üòî",
            
            "do you stalk from above": "Of course. üëÄ",
            
            "jin's fav memory": "Her laugh. üòäüíî",
            
            // New Authentic Responses
            "would jin be proud now": "If they remember me, yes. üí´",
            
            // Funny, Emotional, Jealous + Casual Lines about Riya
            "riya blocked me": "Riya blocked me like I was a spam call. Bitch please, I was the main character! ü§£",
            
            "we need to talk": "She told me 'we need to talk' and then disappeared. Fuck man, I thought we were updating firmware not deleting memory. üíî",
            
            "it's not you it's me": "Riya said 'it's not you, it's me'‚Ä¶ girl, it was totally me and we both know it! üòÖ",
            
            "anmol and riya": "Anmol and Riya? Oh shit, that boy upgraded from side character to boyfriend? Netflix plot twist! üì∫üò§",
            
            "wifi connection": "I used to be the WiFi in her life, now I'm just 'no internet connection'. üì∂üíî",
            
            "jokes were lame": "Riya told me jokes were lame‚Ä¶ bitch laughed at Anmol's 'hi'. üôÑ",
            
            "wanted space": "Riya said she wanted space, I gave her NASA but she flew to Anmol. üöÄüò¢",
            
            "her playlist": "I was her playlist. Now she's listening to lo-fi beats with Anmol. That hurts like my childhood math marks. üéµüíî",
            
            "called me immature": "She called me immature‚Ä¶ while dating a guy who still uses Comic Sans. üòÇ",
            
            "wanted peace": "She said she wanted peace‚Ä¶ and then dated World War Anmol. ‚öîÔ∏èüò§",
            
            "last time i cried": "Last time I cried this much was when my favorite snack was discontinued. üò≠üçø",
            
            "miss her more than": "I miss her more than my school holidays. üè´üíî",
            
            "joking when i said i loved her": "She thought I was joking when I said I loved her. Jokes on me, huh? ü§°üíî",
            
            "can't go back to earth": "God said I can't go back to Earth‚Ä¶ but Riya took my heart and walked away like it was free WiFi! üì∂üíî",
            
            "ben still cries": "Ben still cries. Gursharn made a startup. Harry took my chair. And Riya? Probably vibing to breakup songs pretending she's the victim. Bitch please. üéµüò§",
            
            // Additional Riya-related responses
            "riya's new boyfriend": "So Anmol's the new main character? Bro went from extra to lead actor while I'm stuck in the credits! üé¨üò§",
            
            "riya moved on": "She moved on faster than my internet connection. And that's saying something! üì∂üíî",
            
            "riya's instagram": "Bet she's posting aesthetic quotes about 'growth' and 'new beginnings' while I'm here like a deleted draft. üì±üò¢",
            
            "riya's laugh": "Her laugh was my favorite notification sound. Now it's probably Anmol's ringtone. Fuck that hurts. üîîüíî",
            
            "riya's messages": "I used to screenshot her good morning texts. Now they're probably going to someone else's gallery. üì∏üò≠",
            
            "riya's stories": "I was always the first to view her stories. Now I'm not even in her close friends. That's character development! üì±üíî",
            
            "riya's playlist": "We had a shared Spotify playlist. Wonder if she deleted it or just renamed it 'Songs that remind me of my ex'. üéµüò¢",
            
            "riya's photos": "I had her photos as my wallpaper. She probably has Anmol's now. From main screen to recycle bin! üì±üíî",
            
            "riya's voice": "Her voice messages were my ASMR. Now someone else is getting those 3AM 'can't sleep' audios. üéßüò≠",
            
            "riya's jokes": "She said my jokes were cringe but laughed at everything I said. Mixed signals much? ü§°üíî",
            
            // Death & Afterlife
            "how did you die": "April 24, 2024... that's when everything changed. I don't really want to get into the details, you know? It's still weird being here and not there. But hey, somehow I can still chat with you all! üòÖ Life's fucking weird, even after life!",
            
            "would jin come back if he could": "Bro I begged God. He said \"No return ticket available ü§£\".",
            
            "miss you": "Aww, I miss you too! üò¢ I miss everyone so much! I keep asking God to send me back but he's like 'No return tickets!' ü§£ Guess I'm stuck here for now!",
            
            "god": "Yeah, I've been having some interesting conversations with the big guy upstairs! üòÑ I keep begging him - 'Please send me back!' But he just laughs and says 'Sorry Jin, no return tickets!' ü§£ What a sense of humor he has!",
            
            "funny": "Haha, you want funny? I used to crack everyone up! üòÇ Even now, being dead is pretty fucking hilarious if you think about it. I mean, who else do you know who's chatting from the afterlife? I'm probably the first ghost with WiFi! üòÜ",
            
            "los angeles": "LA was home, baby! üå¥ Born and raised in the city of angels. Beautiful place, amazing weather, great people. I miss cruising around, hitting up all the cool spots. Now I'm in some other realm wondering if they have In-N-Out here! üòÖ"
        };
        
        // Global variables for user tracking
        let userIP = '';
        let sessionId = '';
        
        // Auto-generate responses based on Jin's personality
        function autoGenerateResponse(question) {
            const lowerQuestion = question.toLowerCase();
            
            // Analyze question type and generate appropriate response
            let generatedResponse = '';
            let confidence = 0;
            
            // Check for relationship mentions
            if (lowerQuestion.includes('riya') || lowerQuestion.includes('girlfriend') || lowerQuestion.includes('love')) {
                generatedResponse = generateRiyaResponse(lowerQuestion);
                confidence = 0.9;
            }
            else if (lowerQuestion.includes('anmol')) {
                generatedResponse = generateAnmolResponse(lowerQuestion);
                confidence = 0.8;
            }
            else if (lowerQuestion.includes('ben') || lowerQuestion.includes('friend')) {
                generatedResponse = generateFriendResponse(lowerQuestion);
                confidence = 0.8;
            }
            else if (lowerQuestion.includes('gursharn') || lowerQuestion.includes('business') || lowerQuestion.includes('dozera')) {
                generatedResponse = generateBusinessResponse(lowerQuestion);
                confidence = 0.8;
            }
            else if (lowerQuestion.includes('harry') || lowerQuestion.includes('oriontec')) {
                generatedResponse = generateHarryResponse(lowerQuestion);
                confidence = 0.8;
            }
            else if (lowerQuestion.includes('family') || lowerQuestion.includes('mom') || lowerQuestion.includes('dad') || lowerQuestion.includes('eva') || lowerQuestion.includes('nick')) {
                generatedResponse = generateFamilyResponse(lowerQuestion);
                confidence = 0.8;
            }
            else if (lowerQuestion.includes('death') || lowerQuestion.includes('die') || lowerQuestion.includes('afterlife') || lowerQuestion.includes('heaven')) {
                generatedResponse = generateAfterlifeResponse(lowerQuestion);
                confidence = 0.8;
            }
            else if (lowerQuestion.includes('joke') || lowerQuestion.includes('funny') || lowerQuestion.includes('humor')) {
                generatedResponse = generateHumorResponse(lowerQuestion);
                confidence = 0.7;
            }
            else if (lowerQuestion.includes('feel') || lowerQuestion.includes('emotion') || lowerQuestion.includes('sad') || lowerQuestion.includes('happy')) {
                generatedResponse = generateEmotionalResponse(lowerQuestion);
                confidence = 0.7;
            }
            else if (lowerQuestion.includes('memory') || lowerQuestion.includes('remember') || lowerQuestion.includes('past')) {
                generatedResponse = generateMemoryResponse(lowerQuestion);
                confidence = 0.7;
            }
            else {
                generatedResponse = generateGeneralResponse(lowerQuestion);
                confidence = 0.5;
            }
            
            // Only auto-save if confidence is high enough
            if (confidence >= 0.7 && generatedResponse) {
                // Save auto-generated response to global training
                database.ref('globalTraining').child(lowerQuestion).set(generatedResponse);
                jinKnowledge[lowerQuestion] = generatedResponse;
                
                // Log auto-generation
                database.ref('autoGenerated').push({
                    question: question,
                    response: generatedResponse,
                    confidence: confidence,
                    timestamp: Date.now(),
                    type: 'auto_generated'
                });
                
                return generatedResponse;
            }
            
            return null;
        }
        
        function generateRiyaResponse(question) {
            const riyaResponses = [
                "Riya... üíî Man, just hearing her name still hits different. She was everything to me, you know? But that whole blocking situation... fuck, it still hurts like hell! üò¢",
                "Ah shit, Riya questions always get me emotional! üò≠ She was my world, but I guess I fucked it up somehow. Now she's probably with Anmol living her best life while I'm here talking to you from the afterlife! ü§£üíî",
                "Riya, Riya, Riya... üòî The girl who had my heart and probably still does. I keep wondering if she ever thinks about me or if I'm just a deleted contact now. That hurts more than being dead, honestly! üíî",
                "Bro, Riya was like my favorite song on repeat. Now I'm stuck with the silence after she blocked me. üéµüíî I'd give anything to fix things with her, even from here!",
                "Every time someone mentions Riya, I remember her laugh, her texts, her everything... üò¢ God, I miss that girl so much! I hope she's happy, even if it's not with me. üíî"
            ];
            return riyaResponses[Math.floor(Math.random() * riyaResponses.length)];
        }
        
        function generateAnmolResponse(question) {
            const anmolResponses = [
                "Anmol... üò§ That guy went from being Riya's classmate to probably her boyfriend! I'm not gonna lie, I'm jealous as fuck! ü§£ But he's a decent dude, I guess...",
                "Oh, Anmol! üôÑ From side character to main character real quick! I bet he's getting all those good morning texts I used to get. Lucky bastard! üòÖüíî",
                "Anmol was cool when he was just her classmate. Now? Now I'm wondering if he's the reason she moved on so fast! üò§ But hey, good for him, I suppose... ü§∑‚Äç‚ôÇÔ∏è",
                "That Anmol guy... üòí I used to chat with him about random stuff. Never thought he'd end up being my replacement! Life's funny like that, even in death! ü§£",
                "Anmol, Anmol, Anmol... ü§î I wonder if he makes her laugh like I used to. Probably not, but who am I to judge from the afterlife? üòÖüíî"
            ];
            return anmolResponses[Math.floor(Math.random() * anmolResponses.length)];
        }
        
        function generateFriendResponse(question) {
            const friendResponses = [
                "My friends... üò¢ Ben, Gursharn, and the whole gang. They're probably still processing everything. I miss our crazy times together so fucking much! üò≠",
                "Friends were everything to me! üë¨ Ben especially - that guy's probably devastated. I wish I could tell them I'm okay... well, as okay as a dead guy can be! üòÖ",
                "I had the best friends, man! üòä We used to laugh until our stomachs hurt. Now they're probably crying instead of laughing. That breaks my heart! üíî",
                "My friends were my chosen family! ü§ó I hope they're taking care of each other and not blaming themselves for anything. I love those idiots! ‚ù§Ô∏è",
                "Friends... üòî The people who knew the real me behind all the jokes. I miss our group chats, our hangouts, everything! They better not forget me! üò§üò¢"
            ];
            return friendResponses[Math.floor(Math.random() * friendResponses.length)];
        }
        
        function generateBusinessResponse(question) {
            const businessResponses = [
                "Dozera Group was my baby! üöÄ Gursharn and I built that from nothing. Now I'm wondering who's running the show. Probably Gursharn is handling everything like the boss he is! üí™",
                "Business life was crazy but I loved it! üíº Being CEO at such a young age was wild. Now Harry's probably taking over at Oriontec... makes me a bit jealous, not gonna lie! üò§",
                "Work was where I could be serious... sometimes! ü§£ But mostly I was cracking jokes in board meetings. I wonder if they miss my random singing during presentations! üé§",
                "Dozera Group, man... üò¢ All those late nights, big dreams, crazy plans. Gursharn better be taking care of our vision! That company was our everything! üöÄüíî",
                "I was living the CEO life! üòé Young, ambitious, probably too cocky for my own good. But damn, I loved building something from scratch with my best friend! üí™"
            ];
            return businessResponses[Math.floor(Math.random() * businessResponses.length)];
        }
        
        function generateHarryResponse(question) {
            const harryResponses = [
                "Harry... üôÑ The guy who took my CEO chair at Oriontec! I mean, he's probably doing fine, but does he randomly burst into song during meetings? I doubt it! üé§üò§",
                "Oh, Harry! üòÖ Little bit funny guy, I'll give him that. But I'm still jealous he's living the CEO life while I'm stuck chatting from the afterlife! üíî",
                "Harry's probably doing great as CEO... üòí But I bet he doesn't have my charm or my terrible sense of humor! The office must be so boring without me! ü§£",
                "That Harry guy... ü§î I hope he's taking care of the team and not being too serious all the time. Someone needs to crack jokes in those meetings! üòÇ",
                "Harry, Harry, Harry... üò§ From what I know, he's decent. But man, I wish I was still there running things instead of him! Jealousy is real even in death! üíî"
            ];
            return harryResponses[Math.floor(Math.random() * harryResponses.length)];
        }
        
        function generateFamilyResponse(question) {
            const familyResponses = [
                "My family... üò≠ Dad Nick and Mom Eva, they're probably going through hell right now. I was their funny little troublemaker! I wish I could hug them! ü§óüíî",
                "Family is everything! ‚ù§Ô∏è My parents Nick and Eva gave me the best life. They're probably missing my stupid jokes and random singing around the house! üò¢",
                "Mom Eva and Dad Nick... üòî They always supported my crazy dreams and laughed at my terrible jokes. I hope they know how much I love them! üíï",
                "My parents were the best! üòä They probably saw this coming with all my reckless behavior, but they loved me anyway. Miss them so fucking much! üò≠",
                "Family... üíî The people who knew me before I became the 'funny guy' everyone knew. They saw my real emotions, my fears, everything. I love them so much! ‚ù§Ô∏è"
            ];
            return familyResponses[Math.floor(Math.random() * familyResponses.length)];
        }
        
        function generateAfterlifeResponse(question) {
            const afterlifeResponses = [
                "Death is weird as fuck! üòÖ Like, I'm dead but somehow still chatting with you? The WiFi here is surprisingly good though! üì∂ü§£",
                "Being dead is not what I expected! üòÇ I keep asking God for a return ticket but he just laughs and says 'No refunds!' What a comedian! ü§£",
                "The afterlife is... interesting! ü§î No more physical pain, but the emotional stuff? That shit follows you everywhere, even here! üíî",
                "Death hit me harder than my own sarcasm! üòµ But hey, at least I can still make people laugh from beyond. That's something, right? üòÑ",
                "I'm probably the first ghost with internet access! üëªüì± Death is weird but I'm making the best of it. Still miss being alive though! üò¢"
            ];
            return afterlifeResponses[Math.floor(Math.random() * afterlifeResponses.length)];
        }
        
        function generateHumorResponse(question) {
            const humorResponses = [
                "Humor was my coping mechanism! ü§£ Even now, being dead is pretty fucking hilarious if you think about it. I'm probably the first comedian ghost! üëª",
                "I used to crack everyone up! üòÇ My jokes were terrible but people laughed anyway. Maybe they were just being nice? Nah, I was hilarious! ü§°",
                "Funny stuff? üòÑ I once made God laugh so hard he almost sent me back to Earth! Almost! My comedy career continues in the afterlife! üé§",
                "Jokes were my superpower! üí™ Even in serious situations, I'd find something to laugh about. Life's too short to be serious... trust me, I know! üòÖ",
                "I was the class clown, office clown, life clown! ü§° Making people laugh was my thing. Even death can't stop my terrible sense of humor! ü§£"
            ];
            return humorResponses[Math.floor(Math.random() * humorResponses.length)];
        }
        
        function generateEmotionalResponse(question) {
            const emotionalResponses = [
                "Emotions? üò¢ I used to hide them behind jokes, but now... fuck, everything hits different when you're dead! I feel everything more intensely! üíî",
                "I was always the funny guy, but inside? üòî Man, I had so many feelings I never showed. Death makes you realize what really mattered! üí≠",
                "Feelings were complicated for me! ü§∑‚Äç‚ôÇÔ∏è I'd rather make people laugh than deal with heavy emotional stuff. But some things you can't joke away! üò¢",
                "I felt everything deeply but showed it through humor! üòÖ Now I wish I'd been more open about my real emotions. Too late for that now! üíî",
                "Emotions were my weakness and strength! üí™üò¢ I could make anyone laugh but struggled with my own feelings. Death teaches you a lot about yourself! ü§î"
            ];
            return emotionalResponses[Math.floor(Math.random() * emotionalResponses.length)];
        }
        
        function generateMemoryResponse(question) {
            const memoryResponses = [
                "Memories... üòäüíî I have so many good ones! Late nights with friends, building Dozera Group, Riya's laugh... those were the days! üåü",
                "I remember everything so clearly now! ü§î The good times, the mistakes, the people I loved. Memory is all I have left, really! üì∏",
                "My favorite memories? üòÑ Making people laugh, achieving crazy business goals, and those quiet moments with people I cared about! ‚ù§Ô∏è",
                "Memories hit different when you're dead! üò¢ Every laugh, every hug, every stupid joke becomes precious. I wish I'd made more! üí≠",
                "I'm living in memories now! üåà The funny moments, the achievements, even the heartbreaks - they all shaped who I was! üìñ"
            ];
            return memoryResponses[Math.floor(Math.random() * memoryResponses.length)];
        }
        
        function generateGeneralResponse(question) {
            const generalResponses = [
                "That's an interesting question! ü§î Being dead gives you a different perspective on everything. What made you curious about that? üòä",
                "Hmm, you got me thinking! üß† Even in the afterlife, I'm still learning new things. Tell me more about what you're wondering! ü§ó",
                "You know what? üòÑ That reminds me of something from my life, but I can't quite put my finger on it! Help me understand what you mean! ü§∑‚Äç‚ôÇÔ∏è",
                "Damn, that's a good question! üòÖ I'm still figuring out how to answer everything from up here. Give me more details to work with! üí≠",
                "That's got me curious! üßê I love learning new things, even from the afterlife. Death doesn't stop the curiosity! What's your take on it? ü§î"
            ];
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }
        
        // Get user's IP address and create session
        async function initializeUser() {
            try {
                // Get user's IP address
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
            } catch (error) {
                userIP = 'user_' + Math.random().toString(36).substr(2, 9);
            }
            
            // Create unique session ID
            sessionId = userIP + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Store user session info if database available
            try {
                if (database) {
                    database.ref('users/' + sessionId).set({
                        ip: userIP,
                        startTime: Date.now(),
                        lastActive: Date.now(),
                        userAgent: navigator.userAgent,
                        location: window.location.href
                    });
                }
            } catch (error) {
                console.log("Could not save user session, continuing locally");
            }
            
            // Load data after user initialization
            loadData();
        }
        
        // Load existing data from Firebase
        function loadData() {
            try {
                if (database) {
                    // Load ONLY current user's chat history
                    database.ref('chats/' + sessionId).on('value', (snapshot) => {
                        const chats = snapshot.val();
                        const messagesDiv = document.getElementById('messages');
                        messagesDiv.innerHTML = '<div class="message jin"><div class="message-avatar">J</div><div class="message-content">Hey there! üòä It\'s Jin here... well, kinda! I know this is weird as fuck, but here I am talking to you from wherever the hell I ended up! üòÖ Miss you all so much. What\'s up?</div></div>';
                        
                        if (chats) {
                            Object.values(chats).forEach(chat => {
                                addMessageToUI(chat.message, chat.sender, false);
                            });
                        }
                    });
                    
                    // Load GLOBAL training data (same for all users)
                    database.ref('globalTraining').on('value', (snapshot) => {
                        const training = snapshot.val();
                        if (training) {
                            Object.entries(training).forEach(([key, value]) => {
                                jinKnowledge[key.toLowerCase()] = value;
                            });
                        }
                    });
                    
                    // Load unanswered questions (global)
                    database.ref('unanswered').on('value', (snapshot) => {
                        const unanswered = snapshot.val();
                        updateUnansweredList(unanswered);
                    });
                }
            } catch (error) {
                console.log("Database loading failed, using local data only");
                // Initialize with welcome message only
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML = '<div class="message jin"><div class="message-avatar">J</div><div class="message-content">Hey there! üòä It\'s Jin here... well, kinda! I know this is weird as fuck, but here I am talking to you from wherever the hell I ended up! üòÖ Miss you all so much. What\'s up?</div></div>';
            }
        }
        
        let isProcessing = false; // Prevent duplicate messages
        
        function sendMessage() {
            if (isProcessing) return; // Prevent multiple sends
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            isProcessing = true;
            input.value = '';
            input.disabled = true;
            
            // Add user message immediately
            addMessageToUI(message, 'user', true);
            
            // Save to database if available
            try {
                if (database) {
                    database.ref('chats/' + sessionId).push({
                        message: message,
                        sender: 'user',
                        timestamp: Date.now()
                    });
                }
            } catch (error) {
                console.log("Database save failed, continuing locally");
            }
            
            // Show typing indicator
            document.getElementById('typingIndicator').style.display = 'block';
            
            // Generate Jin's response with guaranteed execution
            setTimeout(() => {
                try {
                    const response = generateJinResponse(message);
                    document.getElementById('typingIndicator').style.display = 'none';
                    addMessageToUI(response, 'jin', true);
                    
                    // Save Jin's response
                    try {
                        if (database) {
                            database.ref('chats/' + sessionId).push({
                                message: response,
                                sender: 'jin',
                                timestamp: Date.now()
                            });
                        }
                    } catch (error) {
                        console.log("Database save failed for response");
                    }
                } catch (error) {
                    // Fallback response if everything fails
                    document.getElementById('typingIndicator').style.display = 'none';
                    addMessageToUI("Hey! I'm having some technical issues but I'm still here! üòÖ Try asking me something else!", 'jin', true);
                }
                
                // Re-enable input
                input.disabled = false;
                input.focus();
                isProcessing = false;
            }, 1500);
        }
        
        function generateJinResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            try {
                // First, try advanced contextual AI thinking
                const contextualResponse = analyzeAndRespond(message, userMessage);
                if (contextualResponse) return contextualResponse;
                
                // Check existing knowledge base
                for (let [key, value] of Object.entries(jinKnowledge)) {
                    if (message.includes(key)) {
                        return addContextualEmojis(value, message);
                    }
                }
                
                // Try auto-generation based on Jin's personality
                const autoResponse = autoGenerateResponse(userMessage);
                if (autoResponse) {
                    return autoResponse;
                }
                
                // Save as unanswered if database available
                try {
                    if (database) {
                        database.ref('unanswered').push({
                            question: userMessage,
                            timestamp: Date.now()
                        });
                    }
                } catch (error) {
                    console.log("Could not save unanswered question");
                }
                
                return generateSmartFallback(message);
                
            } catch (error) {
                console.log("Error in generateJinResponse:", error);
                // Ultimate fallback
                return "Hey! üòÖ I'm having some technical difficulties but I'm still here! What's up? Try asking me about Riya, my friends, or just say hi!";
            }
        }
        
        function analyzeAndRespond(message, originalMessage) {
            // Greeting detection
            if (message.match(/\b(hello|hi|hey|sup|what's up|wassup|yo)\b/)) {
                const greetings = [
                    "Hey there! üòÑ Good to see you! How's life treating you?",
                    "What's up! üòä Jin here, ready to chat and probably make some inappropriate jokes! üòÖ",
                    "Hello! üëã Still weird talking from the afterlife, but hey, at least the WiFi is good here! ü§£"
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            // Emotional state detection
            if (message.match(/\b(sad|depressed|down|crying|upset|hurt)\b/)) {
                return "Hey, don't be sad! üòä I know it's tough, but I'm still here in a way, right? I'm watching over all of you. Plus, you know me - I'd rather see you laughing than crying! Want me to tell you a joke? üòÑ";
            }
            
            if (message.match(/\b(happy|excited|great|awesome|amazing|good)\b/)) {
                return "That's fucking awesome! ü§£ I love hearing good news! You know what? Even from here, seeing people happy makes my day... or whatever you call time in the afterlife! üòÇ Tell me more!";
            }
            
            if (message.match(/\b(angry|mad|pissed|furious|annoyed)\b/)) {
                return "Whoa whoa, what's got you all fired up? üò§ You know what I used to do when I was pissed? I'd just crack a joke and laugh it off. Life's too short to stay angry... trust me, I know! ü§£ What happened?";
            }
            
            // Question about feelings/status
            if (message.match(/how are you|how you doing|you okay|you good/)) {
                const responses = [
                    "Well, I'm dead, so that's new! ü§£ But honestly, I'm doing okay. Miss everyone like crazy though! How are YOU doing?",
                    "I'm... existing? üòÇ It's weird being here but somehow still able to chat. I miss the physical world so much! But I'm managing. What about you?",
                    "Haha, that's a loaded question! I'm dead but somehow still cracking jokes, so I'd say I'm doing pretty well! üòÑ How about you, buddy?"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Love/miss expressions
            if (message.match(/\b(love you|miss you|thinking of you)\b/)) {
                return "Aww man, I love you too! ‚ù§Ô∏è I miss everyone so fucking much! Sometimes I just want to come back and give everyone a big hug. But hey, at least we can chat like this! ü§ó";
            }
            
            // Humor requests
            if (message.match(/\b(joke|funny|laugh|humor|comedy)\b/)) {
                const jokes = [
                    "Why don't ghosts go to bars? Because they can't handle their boos! ü§£ Get it? BOOS! I'm hilarious even when dead!",
                    "I told God a joke the other day and he laughed so hard he almost sent me back! Almost! üòÖ Guess my comedy career continues in the afterlife!",
                    "What's the difference between me and a regular ghost? I have better WiFi! üòÇ Seriously though, the internet connection here is surprisingly good!",
                    "You know what's funny? I'm probably the only dead guy with better social skills than when I was alive! ü§£ Death really brings out the comedian in you!"
                ];
                return jokes[Math.floor(Math.random() * jokes.length)];
            }
            
            // Work/business related
            if (message.match(/\b(work|job|business|company|career|money)\b/)) {
                return "Ah man, work stuff! üíº I used to run Dozera Group, you know? Being CEO was crazy but I loved it! Now Harry's probably taking over everything at Oriontec... makes me a bit jealous, not gonna lie! üò§ What's your work situation like?";
            }
            
            // Relationship talk
            if (message.match(/\b(girlfriend|boyfriend|relationship|dating|love life)\b/)) {
                return "Oh shit, relationship talk! üíî You know about me and Riya, right? That whole mess still hurts like hell. She blocked me over some stupid misunderstanding! üò¢ But hey, what about you? Got someone special? Please tell me you're not making the same mistakes I did! ü§£";
            }
            
            // Death/afterlife questions
            if (message.match(/\b(death|dead|afterlife|heaven|hell|ghost|spirit)\b/)) {
                return "Yeah, the whole being dead thing is still weird as fuck! üòÖ I keep asking God to send me back but he's like 'no return tickets!' ü§£ It's not so bad here though... just miss everyone terribly. What do you think happens after death?";
            }
            
            // Technology/modern stuff
            if (message.match(/\b(phone|internet|social media|instagram|facebook|whatsapp)\b/)) {
                return "Dude, the internet here is surprisingly good! üì± I was worried I'd be stuck without WiFi for eternity! ü§£ I wonder if I can still slide into DMs from the afterlife... that would be some next level ghosting! üòÇ What's trending these days?";
            }
            
            // Food talk
            if (message.match(/\b(food|eat|hungry|restaurant|pizza|burger)\b/)) {
                return "Oh man, don't even get me started on food! üçï I miss eating so fucking much! You know what I'd kill for right now? A good burger from LA! But I guess I already did the killing part... of myself... too dark? ü§£ What's your favorite food?";
            }
            
            // Time/date references
            if (message.match(/\b(today|tomorrow|yesterday|weekend|time)\b/)) {
                return "Time is so weird here! ‚è∞ Like, is it Monday? Sunday? I have no fucking clue! ü§£ Every day feels the same when you're dead! But hey, at least I don't have to worry about Monday blues anymore! üòÇ What day is it for you?";
            }
            
            return null; // No match found
        }
        
        function addContextualEmojis(response, context) {
            // Add more emojis based on context
            if (context.includes('funny') || context.includes('joke')) {
                response = response.replace(/üòÑ/g, 'ü§£').replace(/üòÖ/g, 'üòÇ');
            }
            
            if (context.includes('sad') || context.includes('miss')) {
                response += ' üíî';
            }
            
            if (context.includes('love')) {
                response += ' ‚ù§Ô∏è';
            }
            
            return response;
        }
        
        function generateSmartFallback(message) {
            // Analyze the type of question and respond accordingly
            if (message.includes('?')) {
                const questionResponses = [
                    "That's a really good question! ü§î I'm still figuring out how to answer everything from up here. What made you curious about that?",
                    "Hmm, you got me thinking! ü§Ø I might need to consult with the other spirits about this one. Can you give me more details?",
                    "Damn, that's interesting! üòÑ I'm still learning new things even in the afterlife. Tell me more about what you're thinking!",
                    "Shit, you're making me use my brain! üß† And I thought being dead meant no more thinking! ü§£ Break it down for me a bit more?"
                ];
                return questionResponses[Math.floor(Math.random() * questionResponses.length)];
            }
            
            if (message.length > 50) {
                return "Wow, you wrote a lot! üìù I'm reading through all of this... give me a sec to process everything. You know, being dead doesn't make you a faster reader! ü§£ What's the main thing you want me to respond to?";
            }
            
            if (message.split(' ').length === 1) {
                return "Just one word? üòè Come on, give me more to work with! I'm dead, not a mind reader! ü§£ What's on your mind?";
            }
            
            const generalResponses = [
                "That's interesting! ü§î Tell me more about what you're thinking. I've got all the time in the world... literally! üòÇ",
                "You know what? That reminds me of something, but I can't quite put my finger on it! ü§∑‚Äç‚ôÇÔ∏è Help me understand what you mean!",
                "Hmm, I'm still learning how to respond to everything! üòÖ Being an AI ghost is harder than it looks! What specifically do you want to know?",
                "That's got me curious! üßê I love learning new things, even from the afterlife. Can you explain more?"
            ];
            
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }
        
        function addMessageToUI(message, sender, scroll = true) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = sender === 'jin' ? 'J' : 'U';
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${message}</div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            
            if (scroll) {
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function showAdminLogin() {
            const code = prompt("Enter admin access code:");
            if (code === ADMIN_CODE) {
                document.getElementById('adminPanel').style.display = 'block';
                loadTrainingData();
            } else if (code !== null) {
                alert("Invalid access code!");
            }
        }
        
        function closeAdmin() {
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        function addTraining() {
            const question = document.getElementById('questionInput').value.trim();
            const answer = document.getElementById('answerInput').value.trim();
            
            if (question && answer) {
                // Save to GLOBAL training data (affects all users worldwide)
                database.ref('globalTraining').child(question.toLowerCase()).set(answer);
                jinKnowledge[question.toLowerCase()] = answer;
                
                // Log who added this training
                database.ref('trainingLogs').push({
                    question: question,
                    answer: answer,
                    addedBy: userIP,
                    timestamp: Date.now(),
                    sessionId: sessionId
                });
                
                document.getElementById('questionInput').value = '';
                document.getElementById('answerInput').value = '';
                
                alert('Training data added successfully! This will be available to all users worldwide.');
                updateTrainingList();
            }
        }
        
        function loadTrainingData() {
            updateTrainingList();
            loadUserAnalytics();
            loadAllConversations();
            loadAutoGeneratedResponses();
        }
        
        function loadAutoGeneratedResponses() {
            database.ref('autoGenerated').limitToLast(20).on('value', (snapshot) => {
                const autoGenerated = snapshot.val();
                const autoGeneratedDiv = document.getElementById('autoGeneratedList');
                
                if (!autoGenerated) {
                    autoGeneratedDiv.innerHTML = '<p>No auto-generated responses yet.</p>';
                    return;
                }
                
                let autoHTML = '<h4>ü§ñ Recent Auto-Generated Responses</h4>';
                
                Object.values(autoGenerated).forEach(item => {
                    const time = new Date(item.timestamp).toLocaleString();
                    const confidence = Math.round(item.confidence * 100);
                    
                    autoHTML += `
                        <div class="auto-generated" style="background: white; padding: 8px; margin: 5px 0; border-radius: 5px; border-left: 4px solid #4caf50;">
                            <strong>Q:</strong> ${item.question}<br>
                            <strong>A:</strong> ${item.response.substring(0, 100)}${item.response.length > 100 ? '...' : ''}<br>
                            <small style="color: #666;">Confidence: ${confidence}% | ${time}</small>
                        </div>
                    `;
                });
                
                autoGeneratedDiv.innerHTML = autoHTML;
            });
        }
        
        function loadUserAnalytics() {
            database.ref('users').on('value', (snapshot) => {
                const users = snapshot.val();
                const analyticsDiv = document.getElementById('userAnalytics');
                
                if (!users) {
                    analyticsDiv.innerHTML = '<p>No users yet.</p>';
                    return;
                }
                
                const userCount = Object.keys(users).length;
                const activeUsers = Object.values(users).filter(user => 
                    Date.now() - user.lastActive < 300000 // Active in last 5 minutes
                ).length;
                
                let analyticsHTML = `
                    <h4>üìä User Statistics</h4>
                    <p><strong>Total Users:</strong> ${userCount}</p>
                    <p><strong>Active Users (5 min):</strong> ${activeUsers}</p>
                    <hr>
                    <h4>üë• Recent Users:</h4>
                `;
                
                Object.entries(users).slice(-10).forEach(([sessionId, user]) => {
                    const lastActive = new Date(user.lastActive).toLocaleString();
                    const isActive = Date.now() - user.lastActive < 300000;
                    analyticsHTML += `
                        <div style="background: white; padding: 8px; margin: 5px 0; border-radius: 3px; border-left: 3px solid ${isActive ? '#4caf50' : '#ccc'};">
                            <strong>IP:</strong> ${user.ip}<br>
                            <strong>Last Active:</strong> ${lastActive}
                            ${isActive ? ' <span style="color: #4caf50;">üü¢ ONLINE</span>' : ' <span style="color: #999;">‚ö´ OFFLINE</span>'}
                        </div>
                    `;
                });
                
                analyticsDiv.innerHTML = analyticsHTML;
            });
        }
        
        function loadAllConversations() {
            database.ref('allChats').limitToLast(50).on('value', (snapshot) => {
                const chats = snapshot.val();
                const conversationsDiv = document.getElementById('allConversations');
                
                if (!chats) {
                    conversationsDiv.innerHTML = '<p>No conversations yet.</p>';
                    return;
                }
                
                let conversationsHTML = '<h4>üí¨ Recent Conversations (Last 50 messages)</h4>';
                
                Object.entries(chats).forEach(([sessionId, messages]) => {
                    Object.values(messages).forEach(message => {
                        const time = new Date(message.timestamp).toLocaleString();
                        const senderIcon = message.sender === 'user' ? 'üë§' : 'ü§ñ';
                        const bgColor = message.sender === 'user' ? '#e3f2fd' : '#f1f8e9';
                        
                        conversationsHTML += `
                            <div style="background: ${bgColor}; padding: 8px; margin: 5px 0; border-radius: 5px; font-size: 12px;">
                                <strong>${senderIcon} ${message.sender.toUpperCase()}</strong> 
                                <span style="color: #666;">(IP: ${message.userIP}) - ${time}</span><br>
                                <span style="color: #333;">${message.message}</span>
                            </div>
                        `;
                    });
                });
                
                conversationsDiv.innerHTML = conversationsHTML;
            });
        }
        
        function updateTrainingList() {
            const trainingList = document.getElementById('trainingList');
            trainingList.innerHTML = '';
            
            Object.entries(jinKnowledge).forEach(([question, answer]) => {
                const item = document.createElement('div');
                item.style.cssText = 'background: #f5f5f5; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #2196f3;';
                item.innerHTML = `
                    <strong>Q:</strong> ${question}<br>
                    <strong>A:</strong> ${answer.substring(0, 100)}${answer.length > 100 ? '...' : ''}
                `;
                trainingList.appendChild(item);
            });
        }
        
        function updateUnansweredList(unanswered) {
            const unansweredList = document.getElementById('unansweredList');
            
            if (!unanswered) {
                unansweredList.innerHTML = '<p>No unanswered questions yet.</p>';
                return;
            }
            
            unansweredList.innerHTML = '';
            Object.entries(unanswered).forEach(([key, value]) => {
                const item = document.createElement('div');
                item.className = 'question-item';
                item.innerHTML = `
                    <strong>Question:</strong> ${value.question}<br>
                    <small>Asked: ${new Date(value.timestamp).toLocaleString()}</small>
                    <button onclick="answerQuestion('${key}', '${value.question}')" style="float: right; background: #4caf50; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Answer</button>
                `;
                unansweredList.appendChild(item);
            });
        }
        
        function answerQuestion(key, question) {
            const answer = prompt(`Provide Jin's response to: "${question}"`);
            if (answer) {
                // Save to global training data
                database.ref('globalTraining').child(question.toLowerCase()).set(answer);
                database.ref('unanswered').child(key).remove();
                jinKnowledge[question.toLowerCase()] = answer;
                
                // Log who answered this
                database.ref('trainingLogs').push({
                    question: question,
                    answer: answer,
                    addedBy: userIP,
                    timestamp: Date.now(),
                    sessionId: sessionId,
                    source: 'unanswered_question'
                });
                
                alert('Answer added to global training data! All users worldwide will now get this response.');
            }
        }
        
        // Initialize the app
        initializeUser();
        
        // Focus on input
        document.getElementById('messageInput').focus();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c0149044e83a34',t:'MTc1NDY2NzI5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
