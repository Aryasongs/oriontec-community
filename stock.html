<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stocks - Apple Style Trading Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', Helvetica, Arial, sans-serif;
            background: #000000;
            color: #ffffff;
            overflow-x: hidden;
            font-size: 17px;
            line-height: 1.47059;
            font-weight: 400;
            letter-spacing: -0.022em;
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 0;
            min-height: 100vh;
        }

        /* Apple-style Navigation Bar */
        .nav-bar {
            background: rgba(28, 28, 30, 0.72);
            backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 0.5px solid rgba(84, 84, 88, 0.65);
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 22px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-title {
            font-size: 17px;
            font-weight: 600;
            color: #ffffff;
            letter-spacing: -0.41px;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-button {
            background: none;
            border: none;
            color: #007aff;
            font-size: 17px;
            font-weight: 400;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .nav-button:hover {
            background: rgba(0, 122, 255, 0.1);
        }

        /* Main Layout - Apple's 3-column desktop design */
        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr 380px;
            height: calc(100vh - 52px);
            background: #000000;
        }

        /* Left Sidebar - Watchlist */
        .watchlist-sidebar {
            background: #1c1c1e;
            border-right: 0.5px solid rgba(84, 84, 88, 0.65);
            overflow-y: auto;
            padding: 0;
        }

        .watchlist-header {
            padding: 20px 20px 12px 20px;
            border-bottom: 0.5px solid rgba(84, 84, 88, 0.65);
            background: #1c1c1e;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .watchlist-title {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 0.007em;
            margin-bottom: 8px;
        }

        .market-status {
            font-size: 13px;
            color: #30d158;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #30d158;
        }

        .stock-list {
            padding: 8px 0;
        }

        .stock-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .stock-item:hover {
            background: rgba(255, 255, 255, 0.04);
        }

        .stock-item.active {
            background: rgba(0, 122, 255, 0.15);
            border-right: 3px solid #007aff;
        }

        .stock-info-left {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .stock-symbol {
            font-size: 17px;
            font-weight: 600;
            color: #ffffff;
            letter-spacing: -0.41px;
        }

        .stock-name {
            font-size: 13px;
            color: #8e8e93;
            font-weight: 400;
        }

        .stock-info-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .stock-price {
            font-size: 17px;
            font-weight: 600;
            color: #ffffff;
        }

        .stock-change {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .price-up {
            color: #30d158;
        }

        .price-down {
            color: #ff453a;
        }

        /* Center - Chart Area */
        .chart-area {
            background: #000000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chart-header {
            padding: 24px 32px 0 32px;
            background: #000000;
        }

        .current-stock-info {
            margin-bottom: 24px;
        }

        .current-symbol {
            font-size: 32px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 0.004em;
            margin-bottom: 4px;
        }

        .current-price {
            font-size: 48px;
            font-weight: 600;
            color: #ffffff;
            letter-spacing: -0.003em;
            margin-bottom: 8px;
            line-height: 1.08349;
        }

        .current-change {
            font-size: 17px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .change-arrow {
            font-size: 14px;
        }

        /* Chart Controls - Apple Style */
        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 32px 20px 32px;
        }

        .timeframe-selector {
            display: flex;
            background: rgba(118, 118, 128, 0.12);
            border-radius: 8px;
            padding: 2px;
        }

        .timeframe-btn {
            background: none;
            border: none;
            color: #8e8e93;
            font-size: 13px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 32px;
        }

        .timeframe-btn.active {
            background: rgba(255, 255, 255, 0.16);
            color: #ffffff;
        }

        .chart-options {
            display: flex;
            gap: 12px;
        }

        .chart-option-btn {
            background: none;
            border: none;
            color: #007aff;
            font-size: 15px;
            font-weight: 400;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .chart-option-btn:hover {
            background: rgba(0, 122, 255, 0.1);
        }

        /* Main Chart Container */
        .chart-container {
            flex: 1;
            margin: 0 32px 24px 32px;
            background: #000000;
            border-radius: 12px;
            position: relative;
            min-height: 400px;
            overflow: hidden;
        }

        .price-chart {
            width: 100%;
            height: 100%;
            position: relative;
            padding: 20px;
        }

        .candlestick-chart {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 80px;
            bottom: 60px;
            display: flex;
            align-items: flex-end;
            gap: 1px;
        }

        .candle {
            flex: 1;
            position: relative;
            cursor: crosshair;
            min-width: 2px;
        }

        .candle-body {
            width: 100%;
            border-radius: 1px;
            position: relative;
            min-height: 1px;
        }

        .candle-wick {
            width: 1px;
            background: #48484a;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .green-candle {
            background: #30d158;
        }

        .red-candle {
            background: #ff453a;
        }

        .blue-candle {
            background: #007aff;
        }

        /* Price Grid - Apple Style */
        .price-grid {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            bottom: 60px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 0;
        }

        .price-label {
            font-size: 11px;
            color: #8e8e93;
            text-align: right;
            font-weight: 400;
            font-variant-numeric: tabular-nums;
        }

        /* Time Grid */
        .time-grid {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 80px;
            height: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-label {
            font-size: 11px;
            color: #8e8e93;
            font-weight: 400;
        }

        /* Volume Chart */
        .volume-section {
            margin: 0 32px 24px 32px;
            height: 80px;
            background: #000000;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .volume-header {
            position: absolute;
            top: 12px;
            left: 20px;
            font-size: 13px;
            color: #8e8e93;
            font-weight: 500;
        }

        .volume-chart {
            position: absolute;
            bottom: 12px;
            left: 20px;
            right: 20px;
            height: 40px;
            display: flex;
            align-items: flex-end;
            gap: 1px;
        }

        .volume-bar {
            flex: 1;
            border-radius: 1px 1px 0 0;
            opacity: 0.6;
            min-width: 1px;
        }

        /* Right Sidebar - Details */
        .details-sidebar {
            background: #1c1c1e;
            border-left: 0.5px solid rgba(84, 84, 88, 0.65);
            overflow-y: auto;
            padding: 24px 20px;
        }

        .details-section {
            margin-bottom: 32px;
        }

        .details-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 16px;
            letter-spacing: 0.009em;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 0.5px solid rgba(84, 84, 88, 0.65);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 15px;
            color: #8e8e93;
            font-weight: 400;
        }

        .stat-value {
            font-size: 15px;
            color: #ffffff;
            font-weight: 500;
            font-variant-numeric: tabular-nums;
        }

        /* News Section */
        .news-section {
            background: #1c1c1e;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .news-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 0.5px solid rgba(84, 84, 88, 0.65);
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .news-content {
            flex: 1;
        }

        .news-title {
            font-size: 15px;
            font-weight: 500;
            color: #ffffff;
            margin-bottom: 4px;
            line-height: 1.33337;
        }

        .news-description {
            font-size: 13px;
            color: #8e8e93;
            line-height: 1.38462;
        }

        .news-time {
            font-size: 11px;
            color: #8e8e93;
            margin-top: 4px;
        }

        /* Analyst Ratings - Apple Style */
        .analyst-section {
            background: #1c1c1e;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .rating-distribution {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .rating-bar {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            position: relative;
        }

        .rating-buy {
            background: #30d158;
        }

        .rating-hold {
            background: #ff9f0a;
        }

        .rating-sell {
            background: #ff453a;
        }

        .rating-labels {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #8e8e93;
        }

        /* Tooltip - Apple Style */
        .tooltip {
            position: absolute;
            background: rgba(28, 28, 30, 0.9);
            backdrop-filter: saturate(180%) blur(20px);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            border: 0.5px solid rgba(84, 84, 88, 0.65);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            min-width: 200px;
        }

        .tooltip-header {
            font-weight: 600;
            margin-bottom: 8px;
            color: #ffffff;
            font-size: 15px;
        }

        .tooltip-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .tooltip-row:last-child {
            margin-bottom: 0;
        }

        .tooltip-label {
            color: #8e8e93;
        }

        .tooltip-value {
            color: #ffffff;
            font-weight: 500;
            font-variant-numeric: tabular-nums;
        }

        /* Technical Indicators Panel */
        .indicators-panel {
            background: #1c1c1e;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .indicator-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 0.5px solid rgba(84, 84, 88, 0.65);
        }

        .indicator-toggle:last-child {
            border-bottom: none;
        }

        .indicator-name {
            font-size: 15px;
            color: #ffffff;
            font-weight: 400;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 26px;
            background: rgba(120, 120, 128, 0.32);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #30d158;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: #ffffff;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(18px);
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 280px 1fr 320px;
            }
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .watchlist-sidebar {
                display: none;
            }
            
            .details-sidebar {
                display: none;
            }
            
            .chart-area {
                border: none;
            }
        }

        @media (max-width: 768px) {
            .nav-bar {
                padding: 0 16px;
            }
            
            .chart-header {
                padding: 16px 20px 0 20px;
            }
            
            .chart-controls {
                padding: 0 20px 16px 20px;
            }
            
            .chart-container {
                margin: 0 20px 16px 20px;
            }
            
            .volume-section {
                margin: 0 20px 16px 20px;
            }
            
            .current-symbol {
                font-size: 24px;
            }
            
            .current-price {
                font-size: 36px;
            }
        }

        /* Admin Panel Styles */
        .admin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .admin-panel {
            background: #1c1c1e;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
        }

        .admin-input {
            width: 100%;
            background: rgba(118, 118, 128, 0.12);
            border: none;
            color: #ffffff;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 17px;
            margin-bottom: 16px;
            text-align: center;
        }

        .admin-input::placeholder {
            color: #8e8e93;
        }

        .admin-buttons {
            display: flex;
            gap: 12px;
        }

        .admin-btn {
            flex: 1;
            background: #007aff;
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .admin-btn:hover {
            background: #0056cc;
        }

        .admin-btn.cancel {
            background: rgba(255, 69, 58, 0.8);
        }

        .admin-btn.cancel:hover {
            background: #ff453a;
        }

        /* Branding */
        .branding {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 11px;
            color: #8e8e93;
            cursor: pointer;
            user-select: none;
            opacity: 0.6;
            transition: opacity 0.2s ease;
        }

        .branding:hover {
            opacity: 1;
        }

        /* Market Status Indicator */
        .market-hours {
            font-size: 11px;
            color: #8e8e93;
            margin-top: 2px;
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Smooth Animations */
        * {
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        /* Focus States */
        button:focus,
        .stock-item:focus {
            outline: 2px solid #007aff;
            outline-offset: 2px;
        }

        /* Selection States */
        ::selection {
            background: rgba(0, 122, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Apple-style Navigation Bar -->
        <nav class="nav-bar">
            <div class="nav-title">Stocks</div>
            <div class="nav-controls">
                <button class="nav-button" onclick="toggleTheme()">☀️</button>
                <button class="nav-button">Search</button>
            </div>
        </nav>

        <!-- Main 3-Column Layout -->
        <div class="main-layout">
            <!-- Left Sidebar - Watchlist -->
            <div class="watchlist-sidebar">
                <div class="watchlist-header">
                    <h1 class="watchlist-title">My Stocks</h1>
                    <div class="market-status">
                        <span class="status-dot"></span>
                        Market Open
                        <div class="market-hours">9:30 AM - 4:00 PM EST</div>
                    </div>
                </div>
                
                <div class="stock-list">
                    <button class="stock-item active" data-stock="DZRA">
                        <div class="stock-info-left">
                            <div class="stock-symbol">DZRA</div>
                            <div class="stock-name">Dozera Group</div>
                        </div>
                        <div class="stock-info-right">
                            <div class="stock-price">$24.10</div>
                            <div class="stock-change price-down">
                                <span class="change-arrow">▼</span>
                                $0.90 (3.60%)
                            </div>
                        </div>
                    </button>
                    
                    <button class="stock-item" data-stock="ORIN">
                        <div class="stock-info-left">
                            <div class="stock-symbol">ORIN</div>
                            <div class="stock-name">Oriontec</div>
                        </div>
                        <div class="stock-info-right">
                            <div class="stock-price">$19.50</div>
                            <div class="stock-change price-down">
                                <span class="change-arrow">▼</span>
                                $0.25 (1.27%)
                            </div>
                        </div>
                    </button>
                    
                    <button class="stock-item" data-stock="VRZO">
                        <div class="stock-info-left">
                            <div class="stock-symbol">VRZO</div>
                            <div class="stock-name">Vorzo</div>
                        </div>
                        <div class="stock-info-right">
                            <div class="stock-price">$22.00</div>
                            <div class="stock-change price-down">
                                <span class="change-arrow">▼</span>
                                $1.50 (6.38%)
                            </div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Center - Chart Area -->
            <div class="chart-area">
                <div class="chart-header">
                    <div class="current-stock-info">
                        <div class="current-symbol" id="currentSymbol">Dozera Group</div>
                        <div class="current-price price-down" id="currentPrice">$24.10</div>
                        <div class="current-change price-down" id="currentChange">
                            <span class="change-arrow">▼</span>
                            $0.90 (3.60%) Today
                        </div>
                    </div>
                </div>

                <div class="chart-controls">
                    <div class="timeframe-selector">
                        <button class="timeframe-btn active">1D</button>
                        <button class="timeframe-btn">5D</button>
                        <button class="timeframe-btn">1M</button>
                        <button class="timeframe-btn">6M</button>
                        <button class="timeframe-btn">1Y</button>
                        <button class="timeframe-btn">5Y</button>
                    </div>
                    <div class="chart-options">
                        <button class="chart-option-btn">Line</button>
                        <button class="chart-option-btn">Candlestick</button>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="price-chart">
                        <div class="candlestick-chart" id="candlestickChart"></div>
                        <div class="price-grid" id="priceGrid">
                            <div class="price-label">$45.00</div>
                            <div class="price-label">$40.00</div>
                            <div class="price-label">$35.00</div>
                            <div class="price-label">$30.00</div>
                            <div class="price-label">$25.00</div>
                            <div class="price-label">$20.00</div>
                            <div class="price-label">$15.00</div>
                        </div>
                        <div class="time-grid">
                            <div class="time-label">9:30</div>
                            <div class="time-label">11:00</div>
                            <div class="time-label">12:30</div>
                            <div class="time-label">2:00</div>
                            <div class="time-label">4:00</div>
                        </div>
                    </div>
                </div>

                <div class="volume-section">
                    <div class="volume-header">Volume</div>
                    <div class="volume-chart" id="volumeChart"></div>
                </div>
            </div>

            <!-- Right Sidebar - Details -->
            <div class="details-sidebar">
                <div class="details-section">
                    <h2 class="details-title">Statistics</h2>
                    <div class="stat-row">
                        <span class="stat-label">Market Cap</span>
                        <span class="stat-value" id="marketCap">$1.71B</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">P/E Ratio</span>
                        <span class="stat-value" id="peRatio">18.45</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Volume</span>
                        <span class="stat-value" id="volume">2.1M</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Volume</span>
                        <span class="stat-value" id="avgVolume">2.1M</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">52W High</span>
                        <span class="stat-value" id="weekHigh">$25.00</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">52W Low</span>
                        <span class="stat-value" id="weekLow">$12.50</span>
                    </div>
                </div>

                <div class="analyst-section">
                    <h2 class="details-title">Analyst Ratings</h2>
                    <div class="rating-distribution">
                        <div class="rating-bar rating-buy" style="flex: 0.65;"></div>
                        <div class="rating-bar rating-hold" style="flex: 0.28;"></div>
                        <div class="rating-bar rating-sell" style="flex: 0.07;"></div>
                    </div>
                    <div class="rating-labels">
                        <span>65% Buy</span>
                        <span>28% Hold</span>
                        <span>7% Sell</span>
                    </div>
                </div>

                <div class="indicators-panel">
                    <h2 class="details-title">Indicators</h2>
                    <div class="indicator-toggle">
                        <span class="indicator-name">RSI</span>
                        <div class="toggle-switch active" data-indicator="rsi">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="indicator-toggle">
                        <span class="indicator-name">MACD</span>
                        <div class="toggle-switch" data-indicator="macd">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="indicator-toggle">
                        <span class="indicator-name">Bollinger Bands</span>
                        <div class="toggle-switch" data-indicator="bollinger">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>

                <div class="news-section">
                    <h2 class="details-title">News</h2>
                    <div class="news-item">
                        <div class="news-icon" style="background: #30d158;">📈</div>
                        <div class="news-content">
                            <div class="news-title">Q4 Earnings Beat Expectations</div>
                            <div class="news-description">Revenue up 15% year-over-year with strong infrastructure demand</div>
                            <div class="news-time">2 hours ago</div>
                        </div>
                    </div>
                    <div class="news-item">
                        <div class="news-icon" style="background: #007aff;">🏗️</div>
                        <div class="news-content">
                            <div class="news-title">New Mumbai Facility Announced</div>
                            <div class="news-description">$50M investment in advanced manufacturing capabilities</div>
                            <div class="news-time">5 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tooltip -->
        <div class="tooltip" id="tooltip"></div>

        <!-- Admin Panel -->
        <div class="admin-overlay" id="adminOverlay">
            <div class="admin-panel">
                <div class="admin-title">🔐 Admin Access</div>
                <input type="password" class="admin-input" id="adminCode" placeholder="Enter Access Code" maxlength="10">
                <div class="admin-buttons">
                    <button class="admin-btn" onclick="verifyAdmin()">Login</button>
                    <button class="admin-btn cancel" onclick="closeAdminPanel()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Branding -->
        <div class="branding" id="brandingText">Powered by Apple-Style Charts</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCCWB4adPUSrSW2cSd9I3oqYIw65ZnStj4",
            authDomain: "twitter-1903a.firebaseapp.com",
            databaseURL: "https://twitter-1903a-default-rtdb.firebaseio.com",
            projectId: "twitter-1903a",
            storageBucket: "twitter-1903a.firebasestorage.app",
            messagingSenderId: "37758914989",
            appId: "1:37758914989:web:6c364d74288a8b08f8d124"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Global state for synchronized price updates
        let globalPriceState = {
            lastUpdate: Date.now(),
            dailyTrend: 'neutral', // 'up', 'down', 'neutral'
            weeklyPattern: 'normal', // 'crash', 'surge', 'normal'
            marketSession: 'open' // 'open', 'closed'
        };
        
        // News events system
        let globalNewsEvents = [];
        
        // Technical indicators state
        const indicatorStates = {
            rsi: true,
            macd: false,
            bollinger: false,
            vwap: false,
            fibonacci: false
        };

        // Stock data with complete Apple-style structure
        const stockData = {
            DZRA: {
                name: "Dozera Group",
                symbol: "DZRA",
                currentPrice: 24.10,
                change: -0.90,
                changePercent: -3.60,
                marketCap: "$1.71B",
                peRatio: "18.45",
                volume: "2.1M",
                avgVolume: "2.1M",
                weekHigh: "$25.00",
                weekLow: "$12.50",
                earningsDate: "Feb 15, 2024",
                exDividend: "Jan 28, 2024",
                priceTarget: "$28.00",
                rating: "Hold",
                analystRatings: { buy: 65, hold: 28, sell: 7 },
                supportLevel: 18.00,
                resistanceLevel: 27.00,
                timeframes: {
                    '1D': generateCandleData(24.10, 'current', 50),
                    '5D': generateCandleData(24.10, 'current', 120),
                    '1M': generateCandleData(40.00, 'surge', 30),
                    '6M': generateCandleData(24.10, 'recovery', 180),
                    '1Y': generateCandleData(24.10, 'yearly', 365),
                    '5Y': generateCandleData(24.10, 'longterm', 1825)
                }
            },
            ORIN: {
                name: "Oriontec",
                symbol: "ORIN",
                currentPrice: 19.50,
                change: -0.25,
                changePercent: -1.27,
                marketCap: "$1.30B",
                peRatio: "22.10",
                volume: "1.2M",
                avgVolume: "1.5M",
                weekHigh: "$24.50",
                weekLow: "$11.20",
                earningsDate: "Feb 22, 2024",
                exDividend: "Feb 05, 2024",
                priceTarget: "$23.00",
                rating: "Buy",
                analystRatings: { buy: 78, hold: 18, sell: 4 },
                supportLevel: 16.50,
                resistanceLevel: 23.00,
                timeframes: {
                    '1D': generateCandleData(19.50, 'current', 50),
                    '5D': generateCandleData(19.50, 'current', 120),
                    '1M': generateCandleData(22.75, 'gradual', 30),
                    '6M': generateCandleData(19.50, 'slow_recovery', 180),
                    '1Y': generateCandleData(19.50, 'yearly', 365),
                    '5Y': generateCandleData(19.50, 'longterm', 1825)
                }
            },
            VRZO: {
                name: "Vorzo",
                symbol: "VRZO",
                currentPrice: 22.00,
                change: -1.50,
                changePercent: -6.38,
                marketCap: "$1.78B",
                peRatio: "N/A",
                volume: "3.5M",
                avgVolume: "2.8M",
                weekHigh: "$38.50",
                weekLow: "$15.80",
                earningsDate: "Mar 01, 2024",
                exDividend: "N/A",
                priceTarget: "$26.00",
                rating: "Hold",
                analystRatings: { buy: 45, hold: 40, sell: 15 },
                supportLevel: 19.00,
                resistanceLevel: 28.50,
                timeframes: {
                    '1D': generateCandleData(22.00, 'current', 50),
                    '5D': generateCandleData(22.00, 'current', 120),
                    '1M': generateCandleData(38.50, 'surge', 30),
                    '6M': generateCandleData(22.00, 'recovery', 180),
                    '1Y': generateCandleData(22.00, 'yearly', 365),
                    '5Y': generateCandleData(22.00, 'longterm', 1825)
                }
            }
        };

        let currentStock = 'DZRA';
        let currentTimeframe = '1D';
        let brandingClickCount = 0;
        let brandingClickTimer = null;
        const ADMIN_CODE = "7973804008";
        let firebaseConnected = false;

        // Generate comprehensive candlestick data with patterns
        function generateCandleData(finalPrice, pattern, periods) {
            const candles = [];
            let basePrice = finalPrice;
            
            for (let i = 0; i < periods; i++) {
                let price;
                let volume;
                let candleType;
                
                if (pattern === 'current') {
                    // Current day/5day - mostly flat with small movements
                    price = basePrice + (Math.random() - 0.5) * 0.5;
                    volume = Math.random() * 0.3 + 0.2;
                    candleType = Math.random() > 0.6 ? 'red' : 'green';
                } else if (pattern === 'surge' && i > periods * 0.7) {
                    // Surge pattern for 1M view
                    const surgeStart = periods * 0.7;
                    const surgeProgress = (i - surgeStart) / (periods - surgeStart);
                    price = basePrice * 0.6 + (finalPrice - basePrice * 0.6) * Math.pow(surgeProgress, 0.5);
                    volume = Math.random() * 0.8 + 0.6;
                    candleType = surgeProgress > 0.3 ? 'blue' : 'green';
                } else if (pattern === 'gradual' && i > periods * 0.5) {
                    // Gradual rise for ORIN 1M
                    const gradualStart = periods * 0.5;
                    const gradualProgress = (i - gradualStart) / (periods - gradualStart);
                    price = basePrice * 0.85 + (finalPrice - basePrice * 0.85) * gradualProgress;
                    volume = Math.random() * 0.4 + 0.2;
                    candleType = 'green';
                } else if (pattern === 'recovery') {
                    // 6M recovery pattern
                    if (i < periods * 0.3) {
                        price = basePrice * (1.1 - i * 0.002); // Initial decline
                        candleType = 'red';
                    } else if (i < periods * 0.8) {
                        price = basePrice * 0.7 + Math.random() * basePrice * 0.1; // Consolidation
                        candleType = Math.random() > 0.5 ? 'green' : 'red';
                    } else {
                        const recoveryProgress = (i - periods * 0.8) / (periods * 0.2);
                        price = basePrice * 0.75 + (basePrice * 0.25) * recoveryProgress;
                        candleType = 'green';
                    }
                    volume = Math.random() * 0.5 + 0.3;
                } else if (pattern === 'yearly') {
                    // 1Y pattern with major volatility
                    if (i < periods * 0.2) {
                        price = basePrice * (1.3 - i * 0.001); // Early high
                        candleType = i < periods * 0.1 ? 'green' : 'red';
                    } else if (i < periods * 0.7) {
                        price = basePrice * (0.5 + Math.sin(i * 0.1) * 0.1); // Volatile middle
                        candleType = Math.random() > 0.5 ? 'green' : 'red';
                    } else {
                        const lateProgress = (i - periods * 0.7) / (periods * 0.3);
                        price = basePrice * 0.6 + (basePrice * 0.4) * lateProgress;
                        candleType = 'green';
                    }
                    volume = Math.random() * 0.6 + 0.4;
                } else if (pattern === 'longterm') {
                    // 5Y long-term growth with cycles
                    const cyclePosition = (i / periods) * 4 * Math.PI;
                    const trendGrowth = Math.pow(i / periods, 0.3);
                    price = basePrice * (0.3 + 0.7 * trendGrowth + 0.2 * Math.sin(cyclePosition));
                    volume = Math.random() * 0.5 + 0.3;
                    candleType = Math.sin(cyclePosition) > 0 ? 'green' : 'red';
                } else {
                    // Default flat/declining
                    price = basePrice * (1 - i * 0.001) + (Math.random() - 0.5) * basePrice * 0.02;
                    volume = Math.random() * 0.4 + 0.2;
                    candleType = Math.random() > 0.4 ? 'red' : 'green';
                }
                
                const open = price + (Math.random() - 0.5) * price * 0.02;
                const close = price + (Math.random() - 0.5) * price * 0.02;
                const high = Math.max(open, close) + Math.random() * price * 0.015;
                const low = Math.min(open, close) - Math.random() * price * 0.015;
                
                candles.push({
                    open: Math.max(0, open),
                    high: Math.max(0, high),
                    low: Math.max(0, low),
                    close: Math.max(0, close),
                    volume: volume,
                    type: candleType
                });
            }
            
            return candles;
        }

        // Generate Apple-style candlestick data (fallback)
        function generateCandleDataSimple(basePrice, periods = 50) {
            const candles = [];
            let price = basePrice;
            
            for (let i = 0; i < periods; i++) {
                const volatility = (Math.random() - 0.5) * 0.04;
                const newPrice = price * (1 + volatility);
                
                const open = price;
                const close = newPrice;
                const high = Math.max(open, close) * (1 + Math.random() * 0.02);
                const low = Math.min(open, close) * (1 - Math.random() * 0.02);
                const volume = Math.random() * 0.8 + 0.2;
                
                candles.push({
                    open: Math.max(0, open),
                    high: Math.max(0, high),
                    low: Math.max(0, low),
                    close: Math.max(0, close),
                    volume: volume,
                    type: close >= open ? 'green' : 'red'
                });
                
                price = newPrice;
            }
            
            return candles;
        }

        // Render Apple-style candlesticks
        function renderCandlesticks(data) {
            const chart = document.getElementById('candlestickChart');
            chart.innerHTML = '';
            
            const maxPrice = Math.max(...data.map(d => d.high));
            const minPrice = Math.min(...data.map(d => d.low));
            const priceRange = maxPrice - minPrice;
            
            data.forEach((candle, index) => {
                const candleElement = document.createElement('div');
                candleElement.className = 'candle';
                
                const bodyHeight = Math.abs(candle.close - candle.open) / priceRange * 300;
                const bodyBottom = (Math.min(candle.close, candle.open) - minPrice) / priceRange * 300;
                const wickTop = (maxPrice - candle.high) / priceRange * 300;
                const wickHeight = (candle.high - candle.low) / priceRange * 300;
                
                candleElement.innerHTML = `
                    <div class="candle-wick" style="top: ${wickTop}px; height: ${wickHeight}px;"></div>
                    <div class="candle-body ${candle.type}-candle" style="height: ${Math.max(1, bodyHeight)}px; bottom: ${bodyBottom}px;"></div>
                `;
                
                candleElement.addEventListener('mouseenter', (e) => {
                    showTooltip(e, candle, index);
                });
                
                candleElement.addEventListener('mouseleave', hideTooltip);
                
                chart.appendChild(candleElement);
            });
        }

        // Render Apple-style volume chart
        function renderVolume(data) {
            const volumeChart = document.getElementById('volumeChart');
            volumeChart.innerHTML = '';
            
            const maxVolume = Math.max(...data.map(d => d.volume));
            
            data.forEach(candle => {
                const bar = document.createElement('div');
                bar.className = 'volume-bar';
                bar.style.height = `${(candle.volume / maxVolume) * 40}px`;
                bar.style.background = candle.type === 'red' ? '#ff453a' : '#30d158';
                volumeChart.appendChild(bar);
            });
        }

        // Firebase connection monitoring
        const connectedRef = database.ref(".info/connected");
        connectedRef.on("value", (snap) => {
            firebaseConnected = snap.val() === true;
            console.log(firebaseConnected ? '🟢 Firebase connected' : '🔴 Firebase disconnected');
        });
        
        // Firebase data management
        function updateFirebaseData() {
            if (!firebaseConnected) return;
            
            const updates = {};
            Object.keys(stockData).forEach(symbol => {
                const stock = stockData[symbol];
                updates[`stocks/${symbol}/currentPrice`] = stock.currentPrice;
                updates[`stocks/${symbol}/change`] = stock.change;
                updates[`stocks/${symbol}/changePercent`] = stock.changePercent;
                updates[`stocks/${symbol}/analystRatings`] = stock.analystRatings;
                updates[`stocks/${symbol}/lastUpdate`] = Date.now();
            });
            
            updates['globalState'] = globalPriceState;
            
            database.ref().update(updates).catch(error => {
                console.error('Firebase update error:', error);
            });
        }
        
        // Listen for real-time Firebase updates
        database.ref('stocks').on('value', (snapshot) => {
            const firebaseData = snapshot.val() || {};
            let hasUpdates = false;
            
            Object.keys(firebaseData).forEach(symbol => {
                if (stockData[symbol] && firebaseData[symbol].lastUpdate > (stockData[symbol].lastUpdate || 0)) {
                    const oldPrice = stockData[symbol].currentPrice;
                    Object.assign(stockData[symbol], firebaseData[symbol]);
                    if (oldPrice !== stockData[symbol].currentPrice) {
                        hasUpdates = true;
                    }
                }
            });
            
            if (hasUpdates) {
                updateStockDisplay(currentStock);
                updateWatchlistPrices();
            }
        });
        
        // Dynamic news generation system
        function generateRandomNews() {
            const newsTemplates = {
                DZRA: [
                    { type: 'earnings', icon: '📈', title: 'Q{quarter} Earnings Report', description: 'Dozera Group reports {result} earnings - Revenue: ${revenue}M vs ${expected}M expected' },
                    { type: 'product', icon: '🏗️', title: 'Infrastructure Investment', description: 'New ${amount}M investment in {location} manufacturing facility announced' },
                    { type: 'deal', icon: '💼', title: 'Government Contract', description: 'Secured ${value}M infrastructure contract with {country} government' },
                    { type: 'factory', icon: '🏭', title: 'Production Update', description: 'Factory production increased by {percent}% this quarter' }
                ],
                ORIN: [
                    { type: 'product', icon: '💻', title: 'AI Platform Launch', description: 'Oriontec launches new {tech} analytics platform for {industry} sector' },
                    { type: 'deal', icon: '🤝', title: 'Strategic Partnership', description: 'Partnership with {company} to develop {technology} solutions' },
                    { type: 'earnings', icon: '📈', title: 'Tech Earnings Beat', description: 'Software revenue up {percent}% - Cloud services driving growth' }
                ],
                VRZO: [
                    { type: 'product', icon: '🚗', title: 'EV Technology', description: 'New {tech} technology partnership with {company} announced' },
                    { type: 'factory', icon: '⚡', title: 'Battery Innovation', description: 'Revolutionary {type} battery technology increases range by {percent}%' },
                    { type: 'deal', icon: '🌍', title: 'Global Expansion', description: 'Expanding operations to {region} with ${investment}M investment' }
                ]
            };

            const companies = ['Tesla', 'Apple', 'Microsoft', 'Google', 'Amazon'];
            const countries = ['India', 'USA', 'Germany', 'Japan', 'UK'];
            const locations = ['Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Pune'];
            const technologies = ['AI-powered', 'blockchain-based', 'quantum', 'neural network'];
            const industries = ['automotive', 'healthcare', 'finance', 'manufacturing'];

            Object.keys(newsTemplates).forEach(stock => {
                if (Math.random() < 0.1) { // 10% chance per update
                    const templates = newsTemplates[stock];
                    const template = templates[Math.floor(Math.random() * templates.length)];
                    
                    let description = template.description
                        .replace('{result}', Math.random() > 0.5 ? 'strong' : 'mixed')
                        .replace('{quarter}', ['Q1', 'Q2', 'Q3', 'Q4'][Math.floor(Math.random() * 4)])
                        .replace('{revenue}', (200 + Math.random() * 300).toFixed(0))
                        .replace('{expected}', (180 + Math.random() * 250).toFixed(0))
                        .replace('{amount}', (20 + Math.random() * 80).toFixed(0))
                        .replace('{value}', (100 + Math.random() * 400).toFixed(0))
                        .replace('{percent}', (5 + Math.random() * 25).toFixed(0))
                        .replace('{location}', locations[Math.floor(Math.random() * locations.length)])
                        .replace('{country}', countries[Math.floor(Math.random() * countries.length)])
                        .replace('{company}', companies[Math.floor(Math.random() * companies.length)])
                        .replace('{tech}', technologies[Math.floor(Math.random() * technologies.length)])
                        .replace('{technology}', technologies[Math.floor(Math.random() * technologies.length)])
                        .replace('{industry}', industries[Math.floor(Math.random() * industries.length)])
                        .replace('{type}', ['lithium-ion', 'solid-state', 'graphene'][Math.floor(Math.random() * 3)])
                        .replace('{region}', ['Southeast Asia', 'Europe', 'Middle East'][Math.floor(Math.random() * 3)])
                        .replace('{investment}', (50 + Math.random() * 200).toFixed(0));

                    const newsEvent = {
                        id: Date.now() + Math.random(),
                        stock: stock,
                        type: template.type,
                        icon: template.icon,
                        title: template.title.replace('{quarter}', ['Q1', 'Q2', 'Q3', 'Q4'][Math.floor(Math.random() * 4)]),
                        description: description,
                        timestamp: Date.now()
                    };

                    globalNewsEvents.push(newsEvent);
                    
                    // Keep only last 10 news events
                    if (globalNewsEvents.length > 10) {
                        globalNewsEvents = globalNewsEvents.slice(-10);
                    }

                    // Update news display if current stock
                    if (stock === currentStock) {
                        updateNewsDisplay();
                    }

                    console.log(`📰 New ${stock} news: ${newsEvent.title}`);
                }
            });
        }
        
        function updateNewsDisplay() {
            const newsSection = document.querySelector('.news-section');
            if (!newsSection) return;
            
            const currentStockNews = globalNewsEvents.filter(news => 
                news.stock === currentStock && 
                Date.now() - news.timestamp < 24 * 60 * 60 * 1000 // Last 24 hours
            ).slice(0, 3); // Show only latest 3
            
            const newsContainer = newsSection.querySelector('.news-item')?.parentElement || newsSection;
            
            // Clear existing news items except title
            const existingItems = newsContainer.querySelectorAll('.news-item');
            existingItems.forEach(item => item.remove());
            
            currentStockNews.forEach(news => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                
                const timeAgo = Math.floor((Date.now() - news.timestamp) / (1000 * 60));
                const timeText = timeAgo < 60 ? `${timeAgo} minutes ago` : `${Math.floor(timeAgo / 60)} hours ago`;
                
                newsItem.innerHTML = `
                    <div class="news-icon" style="background: ${news.type === 'earnings' ? '#30d158' : news.type === 'product' ? '#007aff' : '#ff9f0a'};">${news.icon}</div>
                    <div class="news-content">
                        <div class="news-title">${news.title}</div>
                        <div class="news-description">${news.description}</div>
                        <div class="news-time">${timeText}</div>
                    </div>
                `;
                
                newsContainer.appendChild(newsItem);
            });
        }
        
        // Load persistent data on page load
        function loadPersistentData() {
            const savedGlobalState = localStorage.getItem('globalPriceState');
            const savedStockData = localStorage.getItem('stockData');
            
            if (savedGlobalState) {
                globalPriceState = JSON.parse(savedGlobalState);
                console.log('📊 Loaded persistent global state');
            }
            
            if (savedStockData) {
                const saved = JSON.parse(savedStockData);
                Object.keys(saved).forEach(symbol => {
                    if (stockData[symbol]) {
                        stockData[symbol].currentPrice = saved[symbol].currentPrice;
                        stockData[symbol].change = saved[symbol].change;
                        stockData[symbol].changePercent = saved[symbol].changePercent;
                        stockData[symbol].analystRatings = saved[symbol].analystRatings || stockData[symbol].analystRatings;
                    }
                });
                console.log('💾 Loaded persistent stock prices');
            }
        }

        // Apple-style tooltip with Indian time and dual currency
        function showTooltip(event, candle, index) {
            const tooltip = document.getElementById('tooltip');
            const currentDate = new Date();
            currentDate.setHours(9, 30 + index * 5, 0, 0);
            
            // Convert to Indian Standard Time
            const istDate = new Date(currentDate.toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
            
            tooltip.style.display = 'block';
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
            tooltip.innerHTML = `
                <div class="tooltip-header">${istDate.toLocaleString('en-IN', { 
                    month: 'short', 
                    day: 'numeric', 
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: 'Asia/Kolkata'
                })} IST</div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Open</span>
                    <span class="tooltip-value">₹${(candle.open * 83.12).toFixed(2)} | $${candle.open.toFixed(2)}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">High</span>
                    <span class="tooltip-value">₹${(candle.high * 83.12).toFixed(2)} | $${candle.high.toFixed(2)}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Low</span>
                    <span class="tooltip-value">₹${(candle.low * 83.12).toFixed(2)} | $${candle.low.toFixed(2)}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Close</span>
                    <span class="tooltip-value">₹${(candle.close * 83.12).toFixed(2)} | $${candle.close.toFixed(2)}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Volume</span>
                    <span class="tooltip-value">${(candle.volume * 1000000).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</span>
                </div>
            `;
        }

        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        // Update stock display with Apple styling and timeframes
        function updateStockDisplay(stockSymbol, timeframe = currentTimeframe) {
            const stock = stockData[stockSymbol];
            
            document.getElementById('currentSymbol').textContent = stock.name;
            document.getElementById('currentPrice').textContent = `$${stock.currentPrice.toFixed(2)}`;
            
            const changeElement = document.getElementById('currentChange');
            const changeClass = stock.change >= 0 ? 'price-up' : 'price-down';
            const changeSign = stock.change >= 0 ? '+' : '';
            const arrow = stock.change >= 0 ? '▲' : '▼';
            
            changeElement.innerHTML = `
                <span class="change-arrow">${arrow}</span>
                ${changeSign}$${Math.abs(stock.change).toFixed(2)} (${changeSign}${Math.abs(stock.changePercent).toFixed(2)}%) Today
            `;
            changeElement.className = `current-change ${changeClass}`;
            document.getElementById('currentPrice').className = `current-price ${changeClass}`;
            
            // Update sidebar statistics
            document.getElementById('marketCap').textContent = stock.marketCap;
            document.getElementById('peRatio').textContent = stock.peRatio;
            document.getElementById('volume').textContent = stock.volume;
            document.getElementById('avgVolume').textContent = stock.avgVolume;
            document.getElementById('weekHigh').textContent = stock.weekHigh;
            document.getElementById('weekLow').textContent = stock.weekLow;
            
            // Update analyst ratings display
            const ratingBars = document.querySelectorAll('.rating-bar');
            const ratingLabels = document.querySelector('.rating-labels');
            if (ratingBars.length >= 3 && ratingLabels) {
                ratingBars[0].style.flex = `0.${stock.analystRatings.buy}`;
                ratingBars[1].style.flex = `0.${stock.analystRatings.hold}`;
                ratingBars[2].style.flex = `0.${stock.analystRatings.sell}`;
                
                ratingLabels.innerHTML = `
                    <span>${stock.analystRatings.buy}% Buy</span>
                    <span>${stock.analystRatings.hold}% Hold</span>
                    <span>${stock.analystRatings.sell}% Sell</span>
                `;
            }
            
            // Render charts with current timeframe data
            const chartData = stock.timeframes[timeframe] || generateCandleData(stock.currentPrice, 'current', 50);
            renderCandlesticks(chartData);
            renderVolume(chartData);
            
            // Update news display
            updateNewsDisplay();
        }

        // Global synchronized price system
        function simulateGlobalPriceSync() {
            const now = Date.now();
            const timeSinceUpdate = now - globalPriceState.lastUpdate;
            
            // Determine market session (9 AM to 4 PM EST simulation)
            const hour = new Date().getHours();
            globalPriceState.marketSession = (hour >= 9 && hour <= 16) ? 'open' : 'closed';
            
            // Weekly pattern changes (every 7 days simulation = 2 minutes)
            if (Math.random() < 0.001) { // Very rare crash
                globalPriceState.weeklyPattern = 'crash';
                console.log('📉 Market crash triggered globally!');
            } else if (Math.random() < 0.002) { // Rare surge
                globalPriceState.weeklyPattern = 'surge';
                console.log('📈 Market surge triggered globally!');
            } else if (Math.random() < 0.01) { // Return to normal
                globalPriceState.weeklyPattern = 'normal';
            }
            
            // Daily trend changes
            if (Math.random() < 0.05) {
                const trends = ['up', 'down', 'neutral'];
                globalPriceState.dailyTrend = trends[Math.floor(Math.random() * trends.length)];
            }
            
            // Apply synchronized changes to all stocks
            Object.keys(stockData).forEach(symbol => {
                updateStockPrice(symbol, globalPriceState);
            });
            
            globalPriceState.lastUpdate = now;
            updateStockDisplay(currentStock);
            updateWatchlistPrices();
            updateMarketIndices();
            
            // Save state to localStorage for persistence
            localStorage.setItem('globalPriceState', JSON.stringify(globalPriceState));
            localStorage.setItem('stockData', JSON.stringify(stockData));
            
            // Update Firebase
            updateFirebaseData();
        }

        function updateStockPrice(symbol, globalState) {
            const stock = stockData[symbol];
            let volatilityMultiplier = 1;
            let trendBias = 0;
            
            // Apply weekly pattern
            switch (globalState.weeklyPattern) {
                case 'crash':
                    volatilityMultiplier = 2.5;
                    trendBias = -0.08; // Strong downward bias
                    break;
                case 'surge':
                    volatilityMultiplier = 2.0;
                    trendBias = 0.06; // Strong upward bias
                    break;
                default:
                    volatilityMultiplier = 1;
                    trendBias = 0;
            }
            
            // Apply daily trend
            switch (globalState.dailyTrend) {
                case 'up':
                    trendBias += 0.02;
                    break;
                case 'down':
                    trendBias -= 0.02;
                    break;
            }
            
            // Market session affects volatility
            if (globalState.marketSession === 'closed') {
                volatilityMultiplier *= 0.3; // Much less movement after hours
            }
            
            // Calculate price change
            const baseVolatility = (Math.random() - 0.5) * 0.04; // -2% to +2%
            const finalChange = (baseVolatility + trendBias) * volatilityMultiplier;
            
            const newPrice = stock.currentPrice * (1 + finalChange);
            const change = newPrice - stock.currentPrice;
            const changePercent = (change / stock.currentPrice) * 100;
            
            stock.currentPrice = Math.max(0.01, newPrice);
            stock.change = change;
            stock.changePercent = changePercent;
            
            // Update analyst ratings based on performance
            updateAnalystRatings(symbol, changePercent);
        }
        
        function updateAnalystRatings(symbol, changePercent) {
            const stock = stockData[symbol];
            
            if (changePercent > 5) {
                // Strong positive performance - more buy ratings
                stock.analystRatings.buy = Math.min(90, stock.analystRatings.buy + 5);
                stock.analystRatings.sell = Math.max(2, stock.analystRatings.sell - 3);
                stock.analystRatings.hold = 100 - stock.analystRatings.buy - stock.analystRatings.sell;
            } else if (changePercent < -5) {
                // Poor performance - more sell/hold ratings
                stock.analystRatings.sell = Math.min(25, stock.analystRatings.sell + 4);
                stock.analystRatings.buy = Math.max(30, stock.analystRatings.buy - 5);
                stock.analystRatings.hold = 100 - stock.analystRatings.buy - stock.analystRatings.sell;
            } else {
                // Gradual adjustment towards neutral
                const targetBuy = 60 + Math.random() * 20;
                const targetSell = 5 + Math.random() * 10;
                const targetHold = 100 - targetBuy - targetSell;
                
                stock.analystRatings.buy += (targetBuy - stock.analystRatings.buy) * 0.1;
                stock.analystRatings.sell += (targetSell - stock.analystRatings.sell) * 0.1;
                stock.analystRatings.hold = 100 - stock.analystRatings.buy - stock.analystRatings.sell;
            }
            
            // Round to integers
            stock.analystRatings.buy = Math.round(stock.analystRatings.buy);
            stock.analystRatings.sell = Math.round(stock.analystRatings.sell);
            stock.analystRatings.hold = 100 - stock.analystRatings.buy - stock.analystRatings.sell;
        }
        
        function updateMarketIndices() {
            // Update market comparison indices
            const sp500Change = (Math.random() - 0.5) * 2; // -1% to +1%
            const nasdaqChange = (Math.random() - 0.5) * 2.5; // -1.25% to +1.25%
            const niftyChange = (Math.random() - 0.5) * 1.5; // -0.75% to +0.75%
            
            // Update market status display
            const marketStatus = document.querySelector('.market-status');
            if (marketStatus) {
                const statusDot = marketStatus.querySelector('.status-dot');
                const statusText = marketStatus.childNodes[1];
                
                if (globalPriceState.marketSession === 'open') {
                    statusDot.style.background = '#30d158';
                    statusText.textContent = 'Market Open';
                } else {
                    statusDot.style.background = '#ff9f0a';
                    statusText.textContent = 'After Hours';
                }
            }
        }
        
        function updateWatchlistPrices() {
            Object.keys(stockData).forEach(symbol => {
                const stock = stockData[symbol];
                const stockItem = document.querySelector(`[data-stock="${symbol}"]`);
                if (stockItem) {
                    const priceEl = stockItem.querySelector('.stock-price');
                    const changeEl = stockItem.querySelector('.stock-change');
                    const arrow = stockItem.querySelector('.change-arrow');
                    
                    priceEl.textContent = `$${stock.currentPrice.toFixed(2)}`;
                    changeEl.className = `stock-change ${stock.change >= 0 ? 'price-up' : 'price-down'}`;
                    arrow.textContent = stock.change >= 0 ? '▲' : '▼';
                    changeEl.innerHTML = `
                        <span class="change-arrow">${stock.change >= 0 ? '▲' : '▼'}</span>
                        $${Math.abs(stock.change).toFixed(2)} (${Math.abs(stock.changePercent).toFixed(2)}%)
                    `;
                }
            });
        }

        // Complete Admin Panel System
        let isAdminLoggedIn = false;
        
        function handleBrandingClick() {
            brandingClickCount++;
            
            if (brandingClickTimer) {
                clearTimeout(brandingClickTimer);
            }
            
            if (brandingClickCount >= 5) {
                showAdminPanel();
                brandingClickCount = 0;
                return;
            }
            
            brandingClickTimer = setTimeout(() => {
                brandingClickCount = 0;
            }, 3000);
        }

        function showAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'flex';
            document.getElementById('adminCode').focus();
        }

        function closeAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'none';
            document.getElementById('adminCode').value = '';
            isAdminLoggedIn = false;
        }

        function verifyAdmin() {
            const code = document.getElementById('adminCode').value;
            if (code === ADMIN_CODE) {
                isAdminLoggedIn = true;
                showFullAdminPanel();
                closeAdminPanel();
            } else {
                alert('❌ Invalid access code!');
                document.getElementById('adminCode').value = '';
            }
        }
        
        function showFullAdminPanel() {
            // Create comprehensive admin panel
            const adminPanel = document.createElement('div');
            adminPanel.id = 'fullAdminPanel';
            adminPanel.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                backdrop-filter: blur(10px);
                z-index: 15000;
                overflow-y: auto;
                padding: 20px;
            `;
            
            adminPanel.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto; background: #1c1c1e; border-radius: 12px; padding: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; border-bottom: 1px solid #3a3a3c; padding-bottom: 16px;">
                        <h2 style="color: #007aff; font-size: 24px; font-weight: 600;">📊 Apple Stocks Admin Panel</h2>
                        <button onclick="closeFullAdminPanel()" style="background: #ff453a; border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer;">Close</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <!-- Stock Price Control -->
                        <div style="background: #2c2c2e; padding: 20px; border-radius: 12px;">
                            <h3 style="color: #ffffff; margin-bottom: 16px;">📈 Stock Price Control</h3>
                            <select id="adminStockSelect" style="width: 100%; background: #1c1c1e; border: 1px solid #3a3a3c; color: #ffffff; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                <option value="DZRA">Dozera Group (DZRA)</option>
                                <option value="ORIN">Oriontec (ORIN)</option>
                                <option value="VRZO">Vorzo (VRZO)</option>
                            </select>
                            <input type="number" id="adminNewPrice" placeholder="New Price ($)" step="0.01" style="width: 100%; background: #1c1c1e; border: 1px solid #3a3a3c; color: #ffffff; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <input type="number" id="adminPriceChange" placeholder="Change Amount ($)" step="0.01" style="width: 100%; background: #1c1c1e; border: 1px solid #3a3a3c; color: #ffffff; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <button onclick="adminUpdatePrice()" style="width: 100%; background: #007aff; border: none; color: white; padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 8px;">Update Price</button>
                            <button onclick="adminMarketCrash()" style="width: 100%; background: #ff453a; border: none; color: white; padding: 12px; border-radius: 8px; cursor: pointer;">Simulate Market Crash</button>
                        </div>
                        
                        <!-- News Management -->
                        <div style="background: #2c2c2e; padding: 20px; border-radius: 12px;">
                            <h3 style="color: #ffffff; margin-bottom: 16px;">📰 News Management</h3>
                            <select id="adminNewsStock" style="width: 100%; background: #1c1c1e; border: 1px solid #3a3a3c; color: #ffffff; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                                <option value="DZRA">Dozera Group</option>
                                <option value="ORIN">Oriontec</option>
                                <option value="VRZO">Vorzo</option>
                            </select>
                            <input type="text" id="adminNewsTitle" placeholder="News Title" style="width: 100%; background: #1c1c1e; border: 1px solid #3a3a3c; color: #ffffff; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <textarea id="adminNewsDesc" placeholder="News Description" style="width: 100%; background: #1c1c1e; border: 1px solid #3a3a3c; color: #ffffff; padding: 12px; border-radius: 8px; margin-bottom: 12px; min-height: 80px; resize: vertical;"></textarea>
                            <button onclick="adminAddNews()" style="width: 100%; background: #30d158; border: none; color: white; padding: 12px; border-radius: 8px; cursor: pointer;">Add News Event</button>
                        </div>
                        
                        <!-- Market Controls -->
                        <div style="background: #2c2c2e; padding: 20px; border-radius: 12px;">
                            <h3 style="color: #ffffff; margin-bottom: 16px;">⚙️ Market Controls</h3>
                            <button onclick="adminRefreshData()" style="width: 100%; background: #007aff; border: none; color: white; padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 8px;">🔄 Refresh All Data</button>
                            <button onclick="adminResetPrices()" style="width: 100%; background: #ff9f0a; border: none; color: white; padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 8px;">🔄 Reset to Defaults</button>
                            <button onclick="adminClearNews()" style="width: 100%; background: #ff453a; border: none; color: white; padding: 12px; border-radius: 8px; cursor: pointer;">🗑️ Clear All News</button>
                        </div>
                        
                        <!-- System Status -->
                        <div style="background: #2c2c2e; padding: 20px; border-radius: 12px;">
                            <h3 style="color: #ffffff; margin-bottom: 16px;">📊 System Status</h3>
                            <div style="margin-bottom: 12px;">
                                <span style="color: #8e8e93;">Firebase: </span>
                                <span id="adminFirebaseStatus" style="color: ${firebaseConnected ? '#30d158' : '#ff453a'};">${firebaseConnected ? '🟢 Connected' : '🔴 Disconnected'}</span>
                            </div>
                            <div style="margin-bottom: 12px;">
                                <span style="color: #8e8e93;">Market Session: </span>
                                <span style="color: #ffffff;">${globalPriceState.marketSession === 'open' ? '🟢 Open' : '🟡 After Hours'}</span>
                            </div>
                            <div style="margin-bottom: 12px;">
                                <span style="color: #8e8e93;">Daily Trend: </span>
                                <span style="color: #ffffff;">${globalPriceState.dailyTrend.toUpperCase()}</span>
                            </div>
                            <div>
                                <span style="color: #8e8e93;">Weekly Pattern: </span>
                                <span style="color: #ffffff;">${globalPriceState.weeklyPattern.toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(adminPanel);
        }
        
        function closeFullAdminPanel() {
            const panel = document.getElementById('fullAdminPanel');
            if (panel) {
                panel.remove();
            }
            isAdminLoggedIn = false;
        }
        
        function adminUpdatePrice() {
            if (!isAdminLoggedIn) return;
            
            const stock = document.getElementById('adminStockSelect').value;
            const newPrice = parseFloat(document.getElementById('adminNewPrice').value);
            const priceChange = parseFloat(document.getElementById('adminPriceChange').value);
            
            if (isNaN(newPrice)) {
                alert('Please enter a valid price');
                return;
            }
            
            stockData[stock].currentPrice = newPrice;
            if (!isNaN(priceChange)) {
                stockData[stock].change = priceChange;
                stockData[stock].changePercent = (priceChange / newPrice) * 100;
            }
            
            updateFirebaseData();
            updateStockDisplay(currentStock);
            updateWatchlistPrices();
            
            alert(`✅ ${stock} price updated to $${newPrice.toFixed(2)}`);
        }
        
        function adminMarketCrash() {
            if (!isAdminLoggedIn) return;
            
            if (!confirm('⚠️ This will simulate a market crash for all stocks. Continue?')) return;
            
            Object.keys(stockData).forEach(symbol => {
                const currentPrice = stockData[symbol].currentPrice;
                const crashPrice = currentPrice * (0.85 + Math.random() * 0.1); // 10-15% drop
                const change = crashPrice - currentPrice;
                const changePercent = (change / currentPrice) * 100;
                
                stockData[symbol].currentPrice = crashPrice;
                stockData[symbol].change = change;
                stockData[symbol].changePercent = changePercent;
            });
            
            globalPriceState.weeklyPattern = 'crash';
            updateFirebaseData();
            updateStockDisplay(currentStock);
            updateWatchlistPrices();
            
            alert('📉 Market crash simulated successfully!');
        }
        
        function adminAddNews() {
            if (!isAdminLoggedIn) return;
            
            const stock = document.getElementById('adminNewsStock').value;
            const title = document.getElementById('adminNewsTitle').value;
            const description = document.getElementById('adminNewsDesc').value;
            
            if (!title || !description) {
                alert('Please fill in all news fields');
                return;
            }
            
            const newsEvent = {
                id: Date.now() + Math.random(),
                stock: stock,
                type: 'admin',
                icon: '📢',
                title: title,
                description: description,
                timestamp: Date.now()
            };
            
            globalNewsEvents.push(newsEvent);
            
            if (stock === currentStock) {
                updateNewsDisplay();
            }
            
            document.getElementById('adminNewsTitle').value = '';
            document.getElementById('adminNewsDesc').value = '';
            
            alert(`📰 News added for ${stock}: ${title}`);
        }
        
        function adminRefreshData() {
            if (!isAdminLoggedIn) return;
            
            loadPersistentData();
            updateStockDisplay(currentStock);
            updateWatchlistPrices();
            updateMarketIndices();
            
            alert('🔄 All data refreshed successfully!');
        }
        
        function adminResetPrices() {
            if (!isAdminLoggedIn) return;
            
            if (!confirm('⚠️ This will reset all stock prices to default values. Continue?')) return;
            
            stockData.DZRA.currentPrice = 24.10;
            stockData.DZRA.change = -0.90;
            stockData.DZRA.changePercent = -3.60;
            
            stockData.ORIN.currentPrice = 19.50;
            stockData.ORIN.change = -0.25;
            stockData.ORIN.changePercent = -1.27;
            
            stockData.VRZO.currentPrice = 22.00;
            stockData.VRZO.change = -1.50;
            stockData.VRZO.changePercent = -6.38;
            
            globalPriceState.weeklyPattern = 'normal';
            globalPriceState.dailyTrend = 'neutral';
            
            updateFirebaseData();
            updateStockDisplay(currentStock);
            updateWatchlistPrices();
            
            alert('🔄 All prices reset to default values!');
        }
        
        function adminClearNews() {
            if (!isAdminLoggedIn) return;
            
            if (!confirm('⚠️ This will delete all news events. Continue?')) return;
            
            globalNewsEvents = [];
            updateNewsDisplay();
            
            alert('🗑️ All news events cleared!');
        }

        function toggleTheme() {
            // Theme toggle placeholder
            const themeBtn = document.querySelector('.nav-button');
            themeBtn.textContent = themeBtn.textContent === '☀️' ? '🌙' : '☀️';
        }

        // Event listeners
        document.querySelectorAll('.stock-item').forEach(item => {
            item.addEventListener('click', (e) => {
                document.querySelectorAll('.stock-item').forEach(i => i.classList.remove('active'));
                e.currentTarget.classList.add('active');
                currentStock = e.currentTarget.dataset.stock;
                updateStockDisplay(currentStock);
            });
        });

        document.querySelectorAll('.timeframe-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentTimeframe = e.target.textContent;
                updateStockDisplay(currentStock);
            });
        });

        document.querySelectorAll('.toggle-switch').forEach(toggle => {
            toggle.addEventListener('click', (e) => {
                e.target.classList.toggle('active');
            });
        });

        document.getElementById('brandingText').addEventListener('click', handleBrandingClick);

        document.getElementById('adminCode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                verifyAdmin();
            }
        });

        // Initialize all systems
        loadPersistentData();
        updateStockDisplay(currentStock);
        updateMarketIndices();
        
        // Start global synchronized price updates (every 15 seconds)
        setInterval(simulateGlobalPriceSync, 15000);
        
        // Start news generation (every 2 minutes)
        setInterval(generateRandomNews, 120000);
        
        // Generate initial news
        generateRandomNews();
        
        // Keyboard shortcut for admin access (Ctrl+Shift+A)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                showAdminPanel();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'969d6bd435a35460',t:'MTc1NDMwMzg2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
