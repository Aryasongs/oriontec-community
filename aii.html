<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice Interviewer - Animated</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: float 6s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
            padding: 50px;
            max-width: 900px;
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 10;
            animation: containerFloat 6s ease-in-out infinite;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes containerFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .ai-avatar {
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            border-radius: 50%;
            margin: 0 auto 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: white;
            animation: avatarPulse 3s infinite;
            position: relative;
            overflow: hidden;
        }

        @keyframes avatarPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(79, 172, 254, 0.7);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 20px rgba(79, 172, 254, 0);
            }
        }

        .ai-avatar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ai-avatar.speaking {
            animation: speaking 0.6s infinite alternate, colorWave 1.5s infinite, avatarPulse 3s infinite;
        }

        @keyframes speaking {
            0% { transform: scale(1.05); }
            100% { transform: scale(1.15); }
        }

        @keyframes colorWave {
            0% { background: linear-gradient(45deg, #4facfe, #00f2fe); }
            20% { background: linear-gradient(45deg, #fa709a, #fee140); }
            40% { background: linear-gradient(45deg, #a8edea, #fed6e3); }
            60% { background: linear-gradient(45deg, #ffecd2, #fcb69f); }
            80% { background: linear-gradient(45deg, #ff9a9e, #fecfef); }
            100% { background: linear-gradient(45deg, #4facfe, #00f2fe); }
        }

        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% { filter: brightness(1); }
            100% { filter: brightness(1.2); }
        }

        .subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.2em;
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 2px solid rgba(79, 172, 254, 0.3);
            animation: statusPulse 4s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        @keyframes statusPulse {
            0%, 100% { border-color: rgba(79, 172, 254, 0.3); }
            50% { border-color: rgba(79, 172, 254, 0.6); }
        }

        .status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: statusShine 3s infinite;
        }

        @keyframes statusShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .status h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
            position: relative;
            z-index: 2;
        }

        .status p {
            color: #666;
            line-height: 1.8;
            font-size: 1.1em;
            position: relative;
            z-index: 2;
        }

        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
            position: relative;
            overflow: hidden;
            animation: buttonFloat 3s ease-in-out infinite;
        }

        @keyframes buttonFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 35px rgba(79, 172, 254, 0.6);
        }

        button:disabled {
            background: linear-gradient(45deg, #ccc, #999);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            animation: none;
        }

        .transcript {
            background: rgba(248, 249, 250, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            max-height: 450px;
            overflow-y: auto;
            text-align: left;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: transcriptGlow 4s ease-in-out infinite;
        }

        @keyframes transcriptGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(79, 172, 254, 0.1); }
            50% { box-shadow: 0 0 30px rgba(79, 172, 254, 0.2); }
        }

        .transcript h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px 25px;
            border-radius: 25px;
            max-width: 85%;
            word-wrap: break-word;
            animation: messageSlide 0.5s ease-out;
            position: relative;
        }

        @keyframes messageSlide {
            0% {
                opacity: 0;
                transform: translateX(-20px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .ai-message {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            margin-right: auto;
            animation: messageSlide 0.5s ease-out, aiMessageGlow 2s ease-in-out infinite;
        }

        @keyframes aiMessageGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(79, 172, 254, 0.3); }
            50% { box-shadow: 0 0 20px rgba(79, 172, 254, 0.5); }
        }

        .user-message {
            background: linear-gradient(45deg, #e9ecef, #f8f9fa);
            color: #333;
            margin-left: auto;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .listening {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            display: inline-block;
            margin: 15px 0;
            animation: listeningPulse 1s infinite, listeningGlow 2s ease-in-out infinite;
            font-weight: 600;
        }

        @keyframes listeningPulse {
            0% { 
                transform: scale(1);
                background: linear-gradient(45deg, #28a745, #20c997);
            }
            50% { 
                transform: scale(1.08);
                background: linear-gradient(45deg, #20c997, #17a2b8);
            }
            100% { 
                transform: scale(1);
                background: linear-gradient(45deg, #28a745, #20c997);
            }
        }

        @keyframes listeningGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(40, 167, 69, 0.4); }
            50% { box-shadow: 0 0 25px rgba(40, 167, 69, 0.7); }
        }

        .progress {
            background: rgba(233, 236, 239, 0.8);
            border-radius: 15px;
            height: 12px;
            margin: 30px 0;
            overflow: hidden;
            position: relative;
            animation: progressGlow 3s ease-in-out infinite;
        }

        @keyframes progressGlow {
            0%, 100% { box-shadow: inset 0 0 10px rgba(79, 172, 254, 0.2); }
            50% { box-shadow: inset 0 0 20px rgba(79, 172, 254, 0.4); }
        }

        .progress-bar {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            height: 100%;
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: statusFloat 2s ease-in-out infinite;
        }

        @keyframes statusFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .connected {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .disconnected {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .ai-avatar {
                width: 120px;
                height: 120px;
                font-size: 48px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
        }

        /* Custom scrollbar */
        .transcript::-webkit-scrollbar {
            width: 8px;
        }

        .transcript::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        .transcript::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="floating-particles" id="particles"></div>

    <!-- Connection Status -->
    <div class="connection-status connected" id="connectionStatus">
        üîó Firebase Connected
    </div>

    <div class="container">
        <div class="ai-avatar" id="aiAvatar">ü§ñ</div>
        <h1>AI Voice Interviewer</h1>
        <p class="subtitle">Advanced AI-powered interview system with real-time data recording</p>
        
        <div class="status" id="statusPanel">
            <h3>üöÄ System Ready</h3>
            <p>Click "Start Listening" and say your badge number to begin your personalized interview experience</p>
        </div>

        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="controls">
            <button id="startBtn" onclick="startInterview()">üé§ Start Listening</button>
            <button id="stopBtn" onclick="stopListening()" disabled>‚èπÔ∏è Stop Listening</button>
            <button id="repeatBtn" onclick="repeatQuestion()" disabled>üîÑ Repeat Question</button>
            <button onclick="testSpeech()" style="background: linear-gradient(45deg, #28a745, #20c997);">üîä Test Voice</button>
        </div>

        <div class="transcript" id="transcript">
            <h3>üìù Live Interview Transcript</h3>
            <div id="messages"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration and initialization
        const firebaseConfig = {
            apiKey: "AIzaSyD5-7ODvVwWNeCEihvtHvPXmRecDaEsDJI",
            authDomain: "game-e12a6.firebaseapp.com",
            databaseURL: "https://game-e12a6-default-rtdb.firebaseio.com",
            projectId: "game-e12a6",
            storageBucket: "game-e12a6.firebasestorage.app",
            messagingSenderId: "907247974950",
            appId: "1:907247974950:web:bd79b4c4850ce9c33204e7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Interview system state
        let recognition;
        let synthesis = window.speechSynthesis;
        let currentUser = null;
        let currentQuestionIndex = 0;
        let isListening = false;
        let currentQuestion = '';
        let sessionId = null;
        let startTime = null;

        // User profiles and questions
        const userProfiles = {
            'BDG101086': {
                name: 'Jasmeen',
                status: 'processing',
                field: 'graphic-design',
                questions: [
                    { q: "Where are you from?", a: null, type: 'open' },
                    { q: "What is your age?", a: null, type: 'open' },
                    { q: "What are the primary colors in design?", a: "red blue yellow", type: 'technical' },
                    { q: "What does RGB stand for?", a: "red green blue", type: 'technical' },
                    { q: "What is the difference between serif and sans-serif fonts?", a: "serif has decorative strokes sans serif does not", type: 'technical' }
                ]
            },
            'BDG626316': {
                name: 'Anmol',
                status: 'review',
                field: 'web-development',
                questions: [
                    { q: "Where are you from?", a: null, type: 'open' },
                    { q: "What is your age?", a: null, type: 'open' },
                    { q: "What does HTML stand for?", a: "hypertext markup language", type: 'technical' },
                    { q: "What are the three main web technologies?", a: "html css javascript", type: 'technical' },
                    { q: "What is the difference between margin and padding in CSS?", a: "margin is outside padding is inside", type: 'technical' }
                ]
            }
        };

        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Firebase functions
        function initializeSession() {
            sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            startTime = new Date().toISOString();
            
            const sessionData = {
                sessionId: sessionId,
                startTime: startTime,
                status: 'started',
                userAgent: navigator.userAgent,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            database.ref('interviews/' + sessionId).set(sessionData)
                .then(() => {
                    console.log('Session initialized in Firebase');
                    updateConnectionStatus(true);
                })
                .catch((error) => {
                    console.error('Error initializing session:', error);
                    updateConnectionStatus(false);
                });
        }

        function saveUserData(userData) {
            if (!sessionId) return;
            
            database.ref('interviews/' + sessionId + '/user').set(userData)
                .then(() => {
                    console.log('User data saved to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving user data:', error);
                });
        }

        function saveQuestionAnswer(questionIndex, question, userAnswer, correctAnswer, isCorrect, responseTime) {
            if (!sessionId) return;
            
            const qaData = {
                questionIndex: questionIndex,
                question: question,
                userAnswer: userAnswer,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect,
                responseTime: responseTime,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            database.ref('interviews/' + sessionId + '/questions/' + questionIndex).set(qaData)
                .then(() => {
                    console.log('Q&A saved to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving Q&A:', error);
                });
        }

        function saveInterviewComplete(score, totalQuestions) {
            if (!sessionId) return;
            
            const completionData = {
                endTime: new Date().toISOString(),
                status: 'completed',
                score: score,
                totalQuestions: totalQuestions,
                duration: Date.now() - new Date(startTime).getTime(),
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            database.ref('interviews/' + sessionId + '/completion').set(completionData)
                .then(() => {
                    console.log('Interview completion saved to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving completion data:', error);
                });
        }

        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            if (connected) {
                statusElement.className = 'connection-status connected';
                statusElement.innerHTML = 'üîó Firebase Connected';
            } else {
                statusElement.className = 'connection-status disconnected';
                statusElement.innerHTML = '‚ùå Connection Error';
            }
        }

        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                alert('Speech recognition not supported in this browser. Please use Chrome or Edge.');
                return false;
            }

            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                isListening = true;
                updateUI();
                showListening();
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase().trim();
                addMessage(transcript, 'user');
                processUserInput(transcript);
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                hideListening();
                if (event.error === 'no-speech') {
                    speak("I couldn't hear you clearly. Could you please speak a bit louder?");
                } else if (event.error === 'network') {
                    speak("There seems to be a connection issue. Please try again.");
                } else {
                    speak("I'm having trouble understanding. Could you please repeat that?");
                }
            };

            recognition.onend = function() {
                isListening = false;
                updateUI();
                hideListening();
            };

            return true;
        }

        // Text-to-speech function
        function speak(text) {
            // Cancel any ongoing speech
            if (synthesis.speaking) {
                synthesis.cancel();
            }
            
            // Wait a moment before speaking
            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                utterance.volume = 1;
                utterance.lang = 'en-US';
                
                // Get available voices
                const voices = synthesis.getVoices();
                console.log('Available voices:', voices.length);
                
                if (voices.length > 0) {
                    // Try to find a good English voice
                    let selectedVoice = voices.find(voice => 
                        voice.lang === 'en-US' && voice.name.includes('Female')
                    ) || voices.find(voice => 
                        voice.lang === 'en-US'
                    ) || voices.find(voice => 
                        voice.lang.startsWith('en')
                    ) || voices[0];
                    
                    utterance.voice = selectedVoice;
                    console.log('Selected voice:', selectedVoice.name);
                }

                utterance.onstart = function() {
                    console.log('Speech started');
                    document.getElementById('aiAvatar').classList.add('speaking');
                };

                utterance.onend = function() {
                    console.log('Speech ended');
                    document.getElementById('aiAvatar').classList.remove('speaking');
                    if (currentUser && currentQuestionIndex < userProfiles[currentUser].questions.length) {
                        setTimeout(() => {
                            if (!isListening) {
                                startListening();
                            }
                        }, 500);
                    }
                };

                utterance.onerror = function(event) {
                    console.error('Speech error:', event.error);
                    document.getElementById('aiAvatar').classList.remove('speaking');
                };

                // Speak the text
                synthesis.speak(utterance);
                console.log('Speaking:', text);
                
            }, 100);
            
            addMessage(text, 'ai');
        }

        // Process user input
        function processUserInput(input) {
            if (!currentUser) {
                if (input.includes('101086') || input.includes('bdg101086')) {
                    currentUser = 'BDG101086';
                    initializeInterview();
                } else if (input.includes('626316') || input.includes('bdg626316')) {
                    currentUser = 'BDG626316';
                    initializeInterview();
                } else {
                    speak("I didn't recognize that badge number. Please say your badge number clearly.");
                    setTimeout(startListening, 2000);
                }
            } else {
                processAnswer(input);
            }
        }

        // Initialize interview for recognized user
        function initializeInterview() {
            const profile = userProfiles[currentUser];
            const greeting = `Hi ${profile.name}, I am checking... your application is in ${profile.status}. Let's start some questions.`;
            
            // Save user data to Firebase
            saveUserData({
                badgeNumber: currentUser,
                name: profile.name,
                status: profile.status,
                field: profile.field,
                interviewStarted: new Date().toISOString()
            });
            
            updateStatus(`üéØ Interview Started - ${profile.name}`, `Application status: ${profile.status} | Field: ${profile.field}`);
            updateProgress(0);
            
            speak(greeting);
            
            setTimeout(() => {
                askNextQuestion();
            }, 3000);
        }

        // Ask the next question
        function askNextQuestion() {
            if (currentQuestionIndex < userProfiles[currentUser].questions.length) {
                currentQuestion = userProfiles[currentUser].questions[currentQuestionIndex].q;
                speak(currentQuestion);
                updateProgress((currentQuestionIndex / userProfiles[currentUser].questions.length) * 100);
            } else {
                finishInterview();
            }
        }

        // Process user's answer
        function processAnswer(answer) {
            const question = userProfiles[currentUser].questions[currentQuestionIndex];
            const responseTime = Date.now();
            let isCorrect = null;
            let response = '';
            
            if (question.a === null) {
                response = "Thank you for your answer.";
                isCorrect = true; // Open-ended questions are always "correct"
            } else {
                const correctAnswer = question.a.toLowerCase();
                const userAnswer = answer.toLowerCase();
                
                if (userAnswer.includes(correctAnswer) || correctAnswer.includes(userAnswer)) {
                    response = "Correct.";
                    isCorrect = true;
                } else {
                    response = `Incorrect. The correct answer is ${question.a}.`;
                    isCorrect = false;
                }
            }
            
            // Save Q&A to Firebase
            saveQuestionAnswer(
                currentQuestionIndex,
                question.q,
                answer,
                question.a,
                isCorrect,
                responseTime
            );
            
            speak(response);
            currentQuestionIndex++;
            
            setTimeout(() => {
                askNextQuestion();
            }, 2000);
        }

        // Finish the interview
        function finishInterview() {
            const totalQuestions = userProfiles[currentUser].questions.length;
            const technicalQuestions = userProfiles[currentUser].questions.filter(q => q.type === 'technical').length;
            
            // Calculate score (this is a simple example)
            const score = Math.floor(Math.random() * 100) + 1; // In real app, calculate based on correct answers
            
            saveInterviewComplete(score, totalQuestions);
            
            const finalMessage = "Thanks for attending me. I am going to sleep now. Your report has been sent to the team.";
            speak(finalMessage);
            
            updateStatus("‚úÖ Interview Complete", "Thank you for participating! Your responses have been recorded.");
            updateProgress(100);
            
            setTimeout(() => {
                resetInterview();
            }, 5000);
        }

        // Reset interview state
        function resetInterview() {
            currentUser = null;
            currentQuestionIndex = 0;
            currentQuestion = '';
            sessionId = null;
            startTime = null;
            updateStatus("üöÄ Ready for Next Interview", "Click 'Start Listening' and say your badge number to begin");
            updateProgress(0);
            document.getElementById('startBtn').disabled = false;
        }

        // UI helper functions
        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = text;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function updateStatus(title, description) {
            document.getElementById('statusPanel').innerHTML = `
                <h3>${title}</h3>
                <p>${description}</p>
            `;
        }

        function updateProgress(percentage) {
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        function showListening() {
            const statusPanel = document.getElementById('statusPanel');
            statusPanel.innerHTML = `
                <h3>üëÇ Listening...</h3>
                <p class="listening">üé§ Speak now - I'm all ears!</p>
            `;
        }

        function hideListening() {
            if (!currentUser) {
                updateStatus("üöÄ Ready to Start", "Click 'Start Listening' and say your badge number");
            } else {
                updateStatus(`üéØ Interview in Progress`, `Question ${currentQuestionIndex + 1} of ${userProfiles[currentUser].questions.length}`);
            }
        }

        function updateUI() {
            document.getElementById('startBtn').disabled = isListening || currentUser !== null;
            document.getElementById('stopBtn').disabled = !isListening;
            document.getElementById('repeatBtn').disabled = !currentUser || currentQuestion === '';
        }

        // Control functions
        function startInterview() {
            initializeSession();
            if (initSpeechRecognition()) {
                startListening();
            }
        }

        function startListening() {
            if (recognition && !isListening) {
                recognition.start();
            }
        }

        function stopListening() {
            if (recognition && isListening) {
                recognition.stop();
            }
        }

        function repeatQuestion() {
            if (currentQuestion) {
                speak(currentQuestion);
            }
        }

        // Initialize voices
        function initializeVoices() {
            const voices = synthesis.getVoices();
            console.log('Voices loaded:', voices.length);
            if (voices.length > 0) {
                console.log('First voice:', voices[0].name, voices[0].lang);
            }
        }

        // Test speech function
        function testSpeech() {
            console.log('Testing speech...');
            const testUtterance = new SpeechSynthesisUtterance('Testing voice');
            testUtterance.volume = 1;
            testUtterance.rate = 1;
            testUtterance.pitch = 1;
            
            testUtterance.onstart = () => console.log('Test speech started');
            testUtterance.onend = () => console.log('Test speech ended');
            testUtterance.onerror = (e) => console.error('Test speech error:', e);
            
            synthesis.speak(testUtterance);
        }

        // Initialize on page load
        window.onload = function() {
            createParticles();
            
            // Test Firebase connection
            database.ref('.info/connected').on('value', function(snapshot) {
                updateConnectionStatus(snapshot.val() === true);
            });
            
            // Initialize voices
            if (synthesis.onvoiceschanged !== undefined) {
                synthesis.onvoiceschanged = initializeVoices;
            }
            
            // Load voices immediately if available
            setTimeout(initializeVoices, 100);
            
            updateUI();
            
            // Add a test speech button temporarily
            console.log('Speech synthesis supported:', 'speechSynthesis' in window);
            console.log('Synthesis object:', synthesis);
            
            // Delayed welcome message to ensure voices are loaded
            setTimeout(() => {
                console.log('Attempting welcome message...');
                speak("Welcome to the advanced AI Voice Interviewer. I'm ready to conduct your personalized interview with real-time data recording. Please click Start Listening and say your badge number to begin.");
            }, 2000);
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96e75f2d908754e9',t:'MTc1NTA3OTI5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
